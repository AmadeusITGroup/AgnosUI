import{n as R,w as x,b as i,m as U,a as h,f as V,z as W,r as u}from"./dom-gfxqXJpK-BAcWixjJ.js";import{c as j}from"./navManager-ei2lbsPX.js";import{w as B,s as G,t as J}from"./stores-DrD8dowx.js";import{b as f,a as K,t as Q}from"./writables-CgpOQ4hA-BeXDOspc.js";import{c as X}from"./widget-zFin9FlD.js";const Y={className:"",nodes:[],onExpandToggle:R,navSelector:o=>o.querySelectorAll("button"),ariaLabelToggleFn:o=>`Toggle ${o}`},Z={className:Q,nodes:K,onExpandToggle:f,navSelector:f,ariaLabelToggleFn:f},se=X("tree",o=>{const[{nodes$:w,onExpandToggle$:T,navSelector$:D,ariaLabelToggleFn$:y,...A},I]=B(Y,o,Z),p=new Map,L={get(e){return e.isExpanded}},c=x({}),N=i(()=>(m(),c(),L)),{elementsInDomOrder$:_,directive:$,refreshElements:k,focusIndex:F,focusPrevious:S,focusNext:M,focusFirst:P,focusLast:z}=j(),H=i(()=>({keys:{ArrowUp:S,ArrowDown:M,Home:P,End:z},selector:D()})),g=(e,t,r)=>{var a;const s={...e,ariaLabel:e.ariaLabel??e.label,level:t,children:[],isExpanded:(a=e.children)!=null&&a.length?e.isExpanded??!1:void 0};return p.set(s,{parent:r}),e.children&&(s.children=e.children.map(n=>g(n,t+1,s))),s},m=i(()=>(p.clear(),w().map(e=>g(e,0,void 0)))),v=x(m().find(e=>e.isExpanded!==void 0)),l=e=>{const t=p.get(e);return t||console.error(`Node ${e.label} doesn't exist in the map`),t},O=V((e,t)=>{let r;const a=()=>{r&&r.htmlElement===e&&(r.htmlElement=void 0),r=void 0},s=n=>{a(),r=l(n.item),r&&(r.htmlElement&&console.warn("The tree item directive should be used once per element"),r.htmlElement=e)};return s(t),{update:s,destroy:a}}),b=e=>{var t;if(e){const r=(t=l(e))==null?void 0:t.htmlElement;if(r){const a=_().indexOf(r);F(a,0)}}},q=h(e=>({events:{focus:()=>{const{item:t}=e();v.set(t)},click:()=>{const{item:t}=e();d(t)},keydown:t=>{var r,a;const{key:s}=t,{item:n}=e(),E=n.isExpanded;switch(k(),s){case"Enter":case" ":d(n);break;case"ArrowLeft":E?d(n):b((r=l(n))==null?void 0:r.parent);break;case"ArrowRight":E?b((a=n.children)==null?void 0:a[0]):d(n);break;default:return}t.preventDefault(),t.stopPropagation()}},attributes:{"aria-label":i(()=>{const{item:t}=e();return y()(t.ariaLabel)}),tabindex:i(()=>{const{item:t}=e();return t===v()?"0":"-1"}),type:u("button")},classNames:{"au-tree-expand-icon":J,"au-tree-expand-icon-expanded":i(()=>{c();const{item:t}=e();return t.isExpanded??!1})}})),d=e=>{l(e)===void 0||e.isExpanded===void 0||(e.isExpanded=!e.isExpanded,c.set({}),T()(e))};return{...G({normalizedNodes$:m,expandedMap$:N,...A}),patch:I,api:{},directives:{navigationDirective:W($,H),itemToggleDirective:U(O,q),itemAttributesDirective:h(e=>({attributes:{role:u("treeitem"),"aria-selected":u("false"),"aria-expanded":i(()=>{var t;const{item:r}=e();return c(),(t=r.isExpanded)==null?void 0:t.toString()})}}))}}});export{se as c};
