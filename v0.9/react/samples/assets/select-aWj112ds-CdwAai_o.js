import{r as ge,j as r}from"./App-D-jqKXBC.js";import{S as Q}from"./slot-Cj99MDpM.js";import{a as A,u as M}from"./directive-CEErjM5c-BORGxa0J.js";import{c as fe}from"./clsx-B-dksMZM.js";import{u as he}from"./config-DEneCstc.js";import{b as o,x as ve,w as be,d as J,m as xe,a as h,z as $e,r as l,e as De,n as N,c as P}from"./dom-gfxqXJpK-BAcWixjJ.js";import{c as we,o as Ce,a as Fe,b as Ie}from"./floatingUI-5nWVW6ns.js";import{c as je}from"./focustrack-Br9pYzI9.js";import{c as Se}from"./navManager-ei2lbsPX.js";import{w as ke,d as ye,c as Ne,s as Le,t as L}from"./stores-DrD8dowx.js";import{c as Ae}from"./widget-zFin9FlD.js";import{e as Pe}from"./extendWidget-BcmC0c8l.js";const Me={id:void 0,ariaLabel:"Select",open:!1,disabled:!1,items:[],filterText:"",loading:!1,selected:[],navSelector:s=>s.querySelectorAll(".au-select-badge,input"),itemIdFn:s=>""+s,onOpenChange:N,onFilterTextChange:N,onSelectedChange:N,allowedPlacements:["bottom-start","top-start","bottom-end","top-end"],className:"",menuClassName:"",menuItemClassName:"",badgeClassName:""},Te=Ae("select",s=>{const[{id$:a,open$:u,filterText$:v,items$:g,itemIdFn$:b,onOpenChange$:w,onFilterTextChange$:C,onSelectedChange$:F,allowedPlacements$:I,navSelector$:j,className$:S,badgeClassName$:T,ariaLabel$:E,menuClassName$:B,...O},V]=ke(Me,s),{selected$:k}=O,x=o(()=>a()??ve()),R=ye(v,C),{hasFocus$:X,directive:Y}=je(),d=Ne(w,[u,X],([e,t])=>e&&t),y=o(()=>{const e=new Map,t=b();for(const i of k()){const c=t(i);e.set(c,{item:i,id:t(i),selected:!0})}return e}),Z=o(()=>[...y().values()]),f=function(){const e=be(0);return J(e,t=>{const{length:i}=$();t!=null&&(i?t<0?t=i-1:t>=i&&(t=0):t=void 0),e.set(t)})}(),_=o(()=>{const e=new Map;if(d()){const t=y(),i=b();for(const c of g()){const p=i(c);e.set(p,{item:c,id:p,selected:t.has(p)})}}return e}),$=o(()=>d()?[..._().values()]:[]),H=o(()=>{const e=$(),t=f();return e.length&&t!=null?e[t]:void 0}),{directives:{floatingDirective:K,referenceDirective:ee},stores:{placement$:W}}=we({props:{computePositionOptions:J(o(()=>({middleware:[Ce(5),Fe({allowedPlacements:I()}),Ie()]})))}}),{directive:te,refreshElements:se,focusFirst:ie,focusLast:ae,focusLeft:z,focusRight:U}=Se(),re=o(()=>({keys:{Home:ie,End:ae,ArrowLeft:z,ArrowRight:U},selector:j()})),q=(e,t)=>{const i=e.target;se(),n.api.unselect(t),i instanceof HTMLElement&&setTimeout(()=>{z({event:e,referenceElement:i})||U({event:e,referenceElement:i})}),e.preventDefault()},ne=h(()=>({attributes:{role:l("combobox"),"aria-haspopup":l("listbox"),"aria-expanded":o(()=>`${d()}`),"aria-controls":o(()=>`${x()}-menu`)}})),oe=h(e=>({attributes:{tabindex:l(-1),class:T},classNames:{"au-select-badge":L},events:{keydown:t=>{let i=!1;switch(t.key){case"Backspace":case"Delete":{q(t,e().item),i=!0;break}}i&&t.preventDefault()}}})),ce=h(()=>({attributes:{role:l("listbox"),id:o(()=>`${x()}-menu`),"data-popper-placement":W,class:B},events:{mousedown:e=>e.preventDefault()}})),le=h(e=>({attributes:{role:l("option"),"aria-selected":o(()=>`${e().selected}`),style:l("cursor: pointer")},classNames:{"au-select-item":L,selected:o(()=>e().selected)},events:{click:()=>n.api.toggleItem(e().item)}})),ue=h(()=>({attributes:{id:x,type:l("text"),"aria-label":E,"aria-autocomplete":l("list"),autocorrect:l("off"),autocapitalize:l("none"),autocomplete:l("off")},classNames:{"au-select-input":L},events:{input:e=>{const t=e.target.value;De(()=>{d.set(t!=null&&t!==""),R.set(t)})},keydown:({ctrlKey:e,key:t,preventDefault:i})=>{let c=!0;switch(t){case"ArrowDown":{d()?e?n.api.highlightLast():n.api.highlightNext():(n.api.open(),n.api.highlightFirst());break}case"ArrowUp":e?n.api.highlightFirst():n.api.highlightPrevious();break;case"Enter":{const p=H();p&&n.api.toggleItem(p.item);break}case"Escape":d.set(!1);break;default:c=!1}c&&i()}}})),de=h(e=>({events:{click:t=>{q(t,e().item)}}})),n={...Le({id$:x,visibleItems$:$,highlighted$:H,open$:d,selectedContexts$:Z,filterText$:R,placement$:W,className$:S,badgeClassName$:T,ariaLabel$:E,menuClassName$:B,...O}),patch:V,api:{clear(){k.set([])},select(e){n.api.toggleItem(e,!0)},unselect(e){n.api.toggleItem(e,!1)},toggleItem(e,t){const i=b(),c=i(e),D=y().has(c);t==null&&(t=!D),!(t&&!_().has(c)||!t&&!D)&&k.update(m=>{var G;if(m=[...m],t&&!D)m.push(e);else if(!t&&D){const pe=m.findIndex(me=>i(me)===c);m.splice(pe,1)}return(G=F())==null||G(m),m})},clearText(){},highlight(e){const t=$().findIndex(i=>i.item===e);f.set(t===-1?void 0:t)},highlightFirst(){f.set(0)},highlightPrevious(){f.update(e=>e!=null?e-1:-1)},highlightNext(){f.update(e=>e!=null?e+1:1/0)},highlightLast(){f.set(-1)},open:()=>n.api.toggle(!0),close:()=>n.api.toggle(!1),toggle(e){d.update(t=>e??!t)}},directives:{hasFocusDirective:Y,floatingDirective:K,referenceDirective:ee,inputContainerDirective:xe($e(te,re),ne),badgeAttributesDirective:oe,menuAttributesDirective:ce,itemAttributesDirective:le,inputDirective:ue,badgeCloseButtonDirective:de}};return n}),Ee={badgeLabel:({itemContext:s})=>s.item,itemLabel:({itemContext:s})=>s.item},Be=Pe(Te,Ee),Oe=Be;function Re(s){return r.jsx(r.Fragment,{children:""+s.itemContext.item})}function _e(s){return r.jsx(r.Fragment,{children:""+s.itemContext.item})}function He({itemContext:s,slotContext:a}){return r.jsx("div",{...M(a.directives.badgeAttributesDirective,s),children:r.jsx(Q,{slotContent:a.state.badgeLabel,props:{...a,itemContext:s}})})}function We({slotContext:s}){const a=[];for(const u of s.state.selectedContexts)a.push(r.jsx(He,{itemContext:u,slotContext:s},u.id));return a.length?r.jsx(r.Fragment,{children:a}):null}function ze({itemContext:s,slotContext:a}){const u=fe("dropdown-item","position-relative",{"text-bg-primary":s===a.state.highlighted});return r.jsx("li",{className:u,...M(a.directives.itemAttributesDirective,s),children:r.jsx(Q,{slotContent:a.state.itemLabel,props:{...a,itemContext:s}})})}function Ue({slotContext:s}){const{directives:{hasFocusDirective:a,floatingDirective:u,menuAttributesDirective:v}}=s;return r.jsx("ul",{...A([P,"dropdown-menu show"],a,u,v),children:s.state.visibleItems.map(g=>r.jsx(ze,{slotContext:s,itemContext:g},g.id))})}function it(s){const a=he(Oe,s,{badgeLabel:Re,itemLabel:_e});ge.useImperativeHandle(s.ref,()=>a.api,[a.api]);const{state:{id:u,visibleItems:v,filterText:g,open:b,className:w},directives:{hasFocusDirective:C,referenceDirective:F,inputContainerDirective:I,inputDirective:j}}=a,S=`${u}-menu`;return r.jsxs("div",{...A([P,`au-select dropdown border border-1 p-1 mb-3 d-block ${w}`],F),children:[r.jsxs("div",{...A([P,"d-flex align-items-center flex-wrap gap-1"],C,I),children:[r.jsx(We,{slotContext:a}),r.jsx("input",{type:"text",value:g,...M(j),onChange:()=>{}})]}),b&&v.length>0&&r.jsx(Ue,{slotContext:a,menuId:S})]})}export{it as S};
