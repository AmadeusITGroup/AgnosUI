import{af as x,a0 as i,$ as u}from"./AppCommon-yGDLvh0E.js";import{c as R}from"./navManager-CMust_K9.js";import{n as U,m as V,a as h,b as W,o as j}from"./dom-gfxqXJpK-CL0tkJio.js";import{w as B,s as G,t as J}from"./stores-wS22gwlR.js";import{b as f,a as K,t as Q}from"./writables-CgpOQ4hA-Q9fMHnUi.js";import{c as X}from"./widget-CAXEMoJb.js";const Y={className:"",nodes:[],onExpandToggle:U,navSelector:o=>o.querySelectorAll("button"),ariaLabelToggleFn:o=>`Toggle ${o}`},Z={className:Q,nodes:K,onExpandToggle:f,navSelector:f,ariaLabelToggleFn:f},ie=X("tree",o=>{const[{nodes$:w,onExpandToggle$:T,navSelector$:D,ariaLabelToggleFn$:y,...A},I]=B(Y,o,Z),m=new Map,$={get(e){return e.isExpanded}},c=x({}),L=i(()=>(p(),c(),$)),{elementsInDomOrder$:N,directive:_,refreshElements:k,focusIndex:F,focusPrevious:S,focusNext:M,focusFirst:P,focusLast:H}=R(),O=i(()=>({keys:{ArrowUp:S,ArrowDown:M,Home:P,End:H},selector:D()})),g=(e,t,a)=>{var r;const s={...e,ariaLabel:e.ariaLabel??e.label,level:t,children:[],isExpanded:(r=e.children)!=null&&r.length?e.isExpanded??!1:void 0};return m.set(s,{parent:a}),e.children&&(s.children=e.children.map(n=>g(n,t+1,s))),s},p=i(()=>(m.clear(),w().map(e=>g(e,0,void 0)))),v=x(p().find(e=>e.isExpanded!==void 0)),l=e=>{const t=m.get(e);return t||console.error(`Node ${e.label} doesn't exist in the map`),t},q=W((e,t)=>{let a;const r=()=>{a&&a.htmlElement===e&&(a.htmlElement=void 0),a=void 0},s=n=>{r(),a=l(n.item),a&&(a.htmlElement&&console.warn("The tree item directive should be used once per element"),a.htmlElement=e)};return s(t),{update:s,destroy:r}}),b=e=>{var t;if(e){const a=(t=l(e))==null?void 0:t.htmlElement;if(a){const r=N().indexOf(a);F(r,0)}}},z=h(e=>({events:{focus:()=>{const{item:t}=e();v.set(t)},click:()=>{const{item:t}=e();d(t)},keydown:t=>{var a,r;const{key:s}=t,{item:n}=e(),E=n.isExpanded;switch(k(),s){case"Enter":case" ":d(n);break;case"ArrowLeft":E?d(n):b((a=l(n))==null?void 0:a.parent);break;case"ArrowRight":E?b((r=n.children)==null?void 0:r[0]):d(n);break;default:return}t.preventDefault(),t.stopPropagation()}},attributes:{"aria-label":i(()=>{const{item:t}=e();return y()(t.ariaLabel)}),tabindex:i(()=>{const{item:t}=e();return t===v()?"0":"-1"}),type:u("button")},classNames:{"au-tree-expand-icon":J,"au-tree-expand-icon-expanded":i(()=>{c();const{item:t}=e();return t.isExpanded??!1})}})),d=e=>{l(e)===void 0||e.isExpanded===void 0||(e.isExpanded=!e.isExpanded,c.set({}),T()(e))};return{...G({normalizedNodes$:p,expandedMap$:L,...A}),patch:I,api:{},directives:{navigationDirective:j(_,O),itemToggleDirective:V(q,z),itemAttributesDirective:h(e=>({attributes:{role:u("treeitem"),"aria-selected":u("false"),"aria-expanded":i(()=>{var t;const{item:a}=e();return c(),(t=a.isExpanded)==null?void 0:t.toString()})}}))}}});export{ie as c};
