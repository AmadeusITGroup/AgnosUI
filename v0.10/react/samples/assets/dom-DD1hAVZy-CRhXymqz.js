const te=(t,e)=>Object.is(t,e)&&(!t||typeof t!="object")&&typeof t!="function",T=[];let x=!1;const g=t=>{const e=!x;x=!0;let s=!0,r,n;try{r=t()}finally{if(e){for(;T.length>0;){const i=T.shift();try{i.notify()}catch(o){s&&(s=!1,n=o)}}x=!1}}if(s)return r;throw n},w=t=>{try{if(t.skipMarkDirty=!0,t.producer.updateValue(),t.producer.flags&16)throw new Error("assert failed: store still dirty after updating it")}finally{t.skipMarkDirty=!1}},h=()=>{},F=(t,e)=>{const s=t?t[e]:null;return typeof s=="function"?s.bind(t):h},E={next:h,pause:h,resume:h},se=t=>({next:typeof t=="function"?t.bind(null):F(t,"next"),pause:F(t,"pause"),resume:F(t,"resume")});class re{constructor(e,s){this.dirtyCount=1,this.subscriber=se(s),this.link=e.registerConsumer(e.newLink(this)),this.notify(!0)}unsubscribe(){this.subscriber!==E&&(this.subscriber=E,this.link.producer.unregisterConsumer(this.link))}markDirty(){this.dirtyCount++,T.push(this),this.dirtyCount===1&&this.subscriber.pause()}notify(e=!1){if(this.dirtyCount--,this.dirtyCount===0&&this.subscriber!==E){const s=this.link,r=s.producer;if(w(s),r.isLinkUpToDate(s)&&!e)this.subscriber.resume();else{const n=r.updateLink(s);this.subscriber.next(n)}}}}let l=null;const f=t=>{const e=l;return l=t,e},O=t=>{let e;const s=f(null);try{e=t()}finally{f(s)}return e};let m=!1;const d=()=>{if(m)throw new Error("Reading or writing a signal is forbidden during the notification phase.")};let U=0;class B{constructor(e){this.value=e,this.flags=0,this.version=0,this.equalFn=te,this.equalCache=null,this.consumerLinks=[]}newLink(e){return{version:-1,value:void 0,producer:this,indexInProducer:0,consumer:e,skipMarkDirty:!1}}isLinkUpToDate(e){if(e.version===this.version)return!0;if(e.version===this.version-1||e.version<0)return!1;let s=this.equalCache;s||(s={},this.equalCache=s);let r=s[e.version];return r===void 0&&(r=this.equal(e.value,this.value),s[e.version]=r),r}updateLink(e){return e.value=this.value,e.version=this.version,this.readValue()}registerConsumer(e){const s=this.consumerLinks,r=s.length;return e.indexInProducer=r,s[r]=e,e}unregisterConsumer(e){const s=this.consumerLinks,r=e.indexInProducer;if(s[r]!==e)throw new Error("assert failed: invalid indexInProducer");const n=s.pop();e===n?r===0&&this.checkUnused():(s[r]=n,n.indexInProducer=r)}checkUnused(){}updateValue(){}equal(e,s){const r=this.equalFn;return r(e,s)}increaseEpoch(){U++,this.markConsumersDirty()}set(e){d(),this.equal(this.value,e)||g(()=>{this.value=e,this.version++,this.equalCache=null,this.increaseEpoch()})}update(e){this.set(e(this.value))}markConsumersDirty(){const e=m;m=!0;try{const s=this.consumerLinks;for(let r=0,n=s.length;r<n;r++){const i=s[r];i.skipMarkDirty||i.consumer.markDirty()}}finally{m=e}}get(){return d(),l?l.addProducer(this):this.readValue()}readValue(){return this.value}subscribe(e){d();const s=new re(this,e),r=()=>s.unsubscribe();return r.unsubscribe=r,r}}let v=null,C=!1;const ne=()=>{if(C)throw new Error("assert failed: recursive flushUnused call");C=!0;try{const t=v;if(t){v=null;for(let e=0,s=t.length;e<s;e++){const r=t[e];r.flags&=-5,r.checkUnused()}}}finally{C=!1}};class A extends B{constructor(){super(...arguments),this.extraUsages=0}updateValue(){if(!(this.flags&2)){if(!this.extraUsages&&!this.consumerLinks.length)throw new Error("assert failed: untracked producer usage");this.flags|=2,O(()=>this.startUse())}}checkUnused(){const e=this.flags;e&2&&!this.extraUsages&&!this.consumerLinks.length&&(C||e&1?(this.flags&=-3,O(()=>this.endUse())):e&4||(this.flags|=4,v||(v=[],queueMicrotask(ne)),v.push(this)))}get(){if(d(),l)return l.addProducer(this);this.extraUsages++;try{if(this.updateValue(),this.flags&16)throw new Error("assert failed: store still dirty after updating it");return this.readValue()}finally{--this.extraUsages===0&&this.checkUnused()}}}const L=()=>{};L.unsubscribe=L;const I=t=>{if(!t)return L;if(t.unsubscribe===t)return t;const e=typeof t=="function"?()=>t():()=>t.unsubscribe();return e.unsubscribe=e,e};class ie extends A{constructor(e){super(void 0),this.subscribable=e,this.subscriber=this.createSubscriber(),this.unsubscribe=null,this.flags=1}createSubscriber(){const e=s=>this.set(s);return e.next=e,e.pause=()=>{this.markConsumersDirty()},e}startUse(){this.unsubscribe=I(this.subscribable.subscribe(this.subscriber))}endUse(){const e=this.unsubscribe;e&&(this.unsubscribe=null,e())}}const W=typeof Symbol=="function"&&Symbol.observable||"@@observable",oe=function(){return this},Q=Symbol(),M=new WeakMap,N=t=>{const e=t[Q];if(e)return e;let s=M.get(t);if(!s){let r=t;"subscribe"in r||(r=r[W]()),s=new ie(r),M.set(t,s)}return s},k=(t,e)=>{const s=t.get.bind(t);return e&&Object.assign(s,e),s.get=s,s.subscribe=t.subscribe.bind(t),s[W]=oe,s[Q]=t,s},V=1e3,p=Symbol("UNSET"),y=Symbol("ERRORED"),_=t=>t===p||t===y;class z extends A{constructor(){super(...arguments),this.flags=16}equal(e,s){return _(e)||_(s)?!1:super.equal(e,s)}markDirty(){this.flags&16||(this.flags|=16,this.markConsumersDirty())}readValue(){const e=this.value;if(e===y)throw this.error;if(e===p)throw new Error("assert failed: computed value is not set");return e}updateValue(){if(this.flags&8)throw new Error("recursive computed");if(super.updateValue(),!(this.flags&16))return;this.flags|=8;const e=f(null);try{let s=0;do{do if(s++,this.flags&=-17,this.areProducersUpToDate())return;while(this.flags&16&&s<V);this.recompute()}while(this.flags&16&&s<V);this.flags&16&&(this.flags&=-17,this.error=new Error("reached maximum number of store changes in one shot"),this.set(y))}finally{f(e),this.flags&=-9}}}class ue extends z{constructor(e){super(p),this.computeFn=e,this.producerIndex=0,this.producerLinks=[],this.epoch=-1}increaseEpoch(){}updateValue(){this.flags&2&&this.epoch===U||(super.updateValue(),this.epoch=U)}get(){return!l&&!m&&this.epoch===U&&(!(this.flags&1)||this.flags&2)?this.readValue():super.get()}addProducer(e){const s=this.producerLinks,r=this.producerIndex;let n=s[r];return n?.producer!==e&&(n&&s.push(n),n=e.registerConsumer(e.newLink(this))),s[r]=n,this.producerIndex=r+1,w(n),e.flags&1&&(this.flags|=1),e.updateLink(n)}startUse(){const e=this.producerLinks;for(let s=0,r=e.length;s<r;s++){const n=e[s];n.producer.registerConsumer(n)}this.flags|=16}endUse(){const e=this.producerLinks;for(let s=0,r=e.length;s<r;s++){const n=e[s];n.producer.unregisterConsumer(n)}}areProducersUpToDate(){if(this.value===p)return!1;const e=this.producerLinks;for(let s=0,r=e.length;s<r;s++){const n=e[s],i=n.producer;if(w(n),!i.isLinkUpToDate(n))return!1}return!0}recompute(){let e;const s=f(this);try{this.producerIndex=0,this.flags&=-2;const i=this.computeFn;e=i(),this.error=null}catch(i){e=y,this.error=i}finally{f(s)}const r=this.producerLinks,n=this.producerIndex;if(n<r.length)for(let i=0,o=r.length-n;i<o;i++){const a=r.pop();a.producer.unregisterConsumer(a)}this.set(e)}}class ce{constructor(e){this.value=e,this.flags=0}newLink(e){return{producer:this}}registerConsumer(e){return e}unregisterConsumer(e){}updateValue(){}isLinkUpToDate(e){return!0}updateLink(e){return this.value}get(){return d(),this.value}subscribe(e){return d(),typeof e=="function"?e(this.value):e?.next?.(this.value),L}}class H extends z{constructor(e,s){super(s),this.producerLinks=null,this.cleanUpFn=null,this.flags=17;const r=Array.isArray(e);this.arrayMode=r,this.producers=(r?e:[e]).map(N)}callCleanUpFn(){const e=this.cleanUpFn;e&&(this.cleanUpFn=null,e())}startUse(){this.producerLinks=this.producers.map(e=>e.registerConsumer(e.newLink(this))),this.flags|=16}endUse(){this.callCleanUpFn();const e=this.producerLinks;if(this.producerLinks=null,e)for(let s=0,r=e.length;s<r;s++){const n=e[s];n.producer.unregisterConsumer(n)}}areProducersUpToDate(){const e=this.producerLinks;let s=this.value!==p;for(let r=0,n=e.length;r<n;r++){const i=e[r],o=i.producer;w(i),o.isLinkUpToDate(i)||(s=!1)}return s}recompute(){try{this.callCleanUpFn();const e=this.producerLinks.map(s=>s.producer.updateLink(s));this.cleanUpFn=I(this.derive(this.arrayMode?e:e[0]))}catch(e){this.error=e,this.set(y)}}}class ae extends H{constructor(e,s,r){super(e,p),this.deriveFn=r}derive(e){const s=this.deriveFn;this.set(s(e))}}const G=t=>{const e=t.set.bind(t);return e.set=e,e.update=t.update.bind(t),e};class le extends H{constructor(e,s,r){super(e,s),this.deriveFn=r,this.setFn=G(this)}derive(e){const s=this.deriveFn;return s(e,this.setFn)}}class he extends A{constructor(e,s){super(e),this.onUseFn=s,this.cleanUpFn=null,this.flags=1}startUse(){this.cleanUpFn=I(this.onUseFn())}endUse(){const e=this.cleanUpFn;e&&(this.cleanUpFn=null,e())}}function D(t,e){return k(N(t),e)}const $=function(t){this.set(t(O(()=>this.get())))};function Oe(t,e){return D(t,typeof e=="function"?{set:e,update:$}:{...e,set:e?.set??h,update:e?.update??(e?.set?$:h)})}const Ae=t=>N(t).get(),X=(t,e)=>{const s=new he(t,()=>e(r)),r=G(s);return s},S=(t,e)=>{if(e){const{equal:s,notEqual:r}=e;s?t.equalFn=s:r&&(t.equalFn=(n,i)=>!r(n,i))}return t};function de(t,e){typeof e=="function"&&(e={onUse:e});const s=e?.onUse;return k(s?S(X(t,s),e):new ce(t))}function q(t,e){typeof e=="function"&&(e={onUse:e});const s=e?.onUse,r=S(s?X(t,s):new B(t),e),n=k(r);return n.set=r.set.bind(r),n.update=r.update.bind(r),n}function fe(t){return t.length<=1}function Ie(t,e,s){typeof e=="function"&&(e={derive:e});const{derive:r,...n}=e,i=fe(r)?ae:le;return k(S(new i(t,s,r),n))}function pe(t,e){return k(S(new ue(t),e))}const be=()=>{},Ne=t=>t;function Y(t){var e,s,r="";if(typeof t=="string"||typeof t=="number")r+=t;else if(typeof t=="object")if(Array.isArray(t)){var n=t.length;for(e=0;e<n;e++)t[e]&&(s=Y(t[e]))&&(r&&(r+=" "),r+=s)}else for(s in t)t[s]&&(r&&(r+=" "),r+=s);return r}function ge(){for(var t,e,s=0,r="",n=arguments.length;s<n;s++)(t=arguments[s])&&(e=Y(t))&&(r&&(r+=" "),r+=e);return r}const P=(t=>{const e=t?.ownerDocument?.defaultView??window;return t instanceof e.HTMLElement}),R=t=>(e,s)=>{if(P(e))return t(e,s)},me=(t,e)=>s=>{let r=!0,n;const i=e.subscribe(o=>{r?(r=!1,n=t(s,o)):n?.update?.(o)});return{destroy(){n?.destroy?.(),i()}}},ve=de(void 0),ye=t=>me(t,ve),qe=(t,e=!0)=>()=>{const s=t.subscribe(be);return{destroy:async()=>{e&&await Promise.resolve(),s()}}},J={equal:Object.is},ke=()=>{const t=q([],J);return D(t,{register:e=>{let s=!1;return t.update(r=>[...r,e]),()=>{s||(s=!0,t.update(r=>{const n=r.indexOf(e);if(n>-1){const i=[...r];return i.splice(n,1),i}return r}))}}})},K=()=>{const t=ke();return{elements$:D(t),directive:(e,s=!0)=>{let r;const n=(i=!0)=>{!!i!=!!r&&(i?r=t.register(e):(r?.(),r=void 0))};return n(s),{destroy:()=>n(!1),update:n}}}},Ue=()=>{const{directive:t,elements$:e}=K();return{directive:ye(t),elements$:e}},Pe=()=>{const{directive:t,elements$:e}=Ue();return{directive:R(t),elements$:e}},Re=()=>{const{directive:t,elements$:e}=K();return{directive:R(t),elements$:e}},Ce=()=>{const t=q(null,J);return{element$:D(t),directive:e=>{let s=!1;return t.update(r=>r?(console.error("The directive cannot be used on multiple elements.",r,e),r):(s=!0,e)),s?{destroy(){t.update(r=>e===r?null:r)}}:void 0}}},Me=()=>{const{directive:t,element$:e}=Ce();return{directive:R(t),element$:e}},Ve=(...t)=>(e,s)=>{const r=g(()=>t.map(n=>n(e,s)));return{update(n){g(()=>r.forEach(i=>i?.update?.(n)))},destroy(){g(()=>r.reverse().forEach(n=>n?.destroy?.()))}}},_e=(t,e)=>{const s=[],r=n=>g(()=>{n.forEach((o,a)=>{const[b,c]=Array.isArray(o)?o:[o,void 0],u=s[a];if(u){if(u.directive===b){u.arg!==c&&(u.instance?.update?.(c),u.arg=c);return}u.instance?.destroy?.()}const ee=b(t,c);s[a]={directive:b,instance:ee,arg:c}}),s.splice(n.length).reverse().forEach(({instance:o})=>o?.destroy?.())});return r(e),{update:r,destroy:()=>r([])}},we=t=>(e,s)=>{const r=[],n=q(s),{events:i,attributes:o,styles:a,classNames:b}=t(n);if(P(e))for(const[c,u]of Object.entries(i??{}))typeof u=="function"?r.push(j(e,c,u)):r.push(j(e,c,u.handler,u.options));for(const[c,u]of Object.entries(o??{}))u!=null&&r.push(xe(e,c,u));for(const[c,u]of Object.entries(a??{}))u&&r.push(Ee(e,c,u));for(const[c,u]of Object.entries(b??{}))r.push(Te(e,c,u));return{update:c=>n.set(c),destroy:()=>r.forEach(c=>c())}},$e=we(t=>({attributes:{class:pe(()=>ge(t()))}})),je=t=>{const e=t.length;if(e===0)return null;let s=t[0];for(let r=1;r<e&&s;r++){const n=t[r];for(;s&&s!==n;){const i=s.compareDocumentPosition(n);if(i&Node.DOCUMENT_POSITION_CONTAINED_BY)break;if(i&Node.DOCUMENT_POSITION_CONTAINS){s=n;break}else if(i&Node.DOCUMENT_POSITION_DISCONNECTED)return null;s=s.parentElement}}return s},Be=(t=document.body)=>{P(t)&&t.getBoundingClientRect()},We=(t,e)=>{e&&e.length>0&&t.classList.add(...e)},Qe=(t,e)=>{e&&e.length>0&&t.classList.remove(...e)};function j(t,e,s,r){return t.addEventListener(e,s,r),function(){t.removeEventListener(e,s,r)}}let Le=0;const ze=()=>`auId-${Le++}`,Z=t=>t!=null&&t!==!1;function De(t,e){let s=new Set;return e.subscribe(r=>{const n=new Set(`${r??""}`.split(" "));n.delete("");const i=t.classList;for(const o of s)n.has(o)||i.remove(o);n.size>0&&i.add(...n),s=n})}function Se(t,e,s){return s.subscribe(r=>{Z(r)?t.setAttribute(e,""+(r===!0?e:r)):t.removeAttribute(e)})}function xe(t,e,s){return e==="class"?De(t,s):Se(t,e,s)}const Fe=t=>t.startsWith("--");function Ee(t,e,s){return s.subscribe(r=>{const n=t.style;r=""+(Z(r)?r:""),Fe(e)?n.setProperty(e,r):n[e]=r})}function Te(t,e,s){const r=s.subscribe(n=>{t.classList.toggle(e,n)});return()=>{r(),t.classList.remove(e)}}export{ze as A,Ce as B,je as C,Re as D,Pe as E,ye as F,we as a,pe as b,$e as c,Oe as d,g as e,R as f,me as g,Me as h,P as i,qe as j,j as k,_e as l,Ve as m,be as n,Ne as o,ke as p,Qe as q,de as r,We as s,Be as t,O as u,D as v,q as w,Ae as x,Ie as y,te as z};
