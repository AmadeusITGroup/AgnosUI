import{Z as o,Y as v}from"./AppCommon-Wa4AmAan.js";import{c as a,b as i,t as $,e as K}from"./writables-Is1bF1Vt-BG3Pzxwh.js";import{w as Q,s as U}from"./stores-Cnqi-Xzl.js";import{c as T}from"./baseTransitions-COHS6YM7.js";import{d as X}from"./promise-Y53vc4Ia-CAui0smE.js";import{n,d as f,r as _,a as k,m as O,b as ee,f as te,u as oe}from"./dom-DD1hAVZy-DF7A35x4.js";import{p as A,f as se,s as ie,r as ne,a as ae}from"./focusElement-B1nSPubH.js";import{c as re}from"./widget-dYgkJFv4.js";const ce=Symbol(),le=Symbol(),de=Symbol(),be={animated:!0,ariaCloseButtonLabel:"Close",backdrop:!0,backdropClass:"",backdropTransition:n,closeButton:!0,closeOnOutsideClick:!0,container:typeof window<"u"?document.body:null,className:"",modalTransition:n,onBeforeClose:n,onVisibleChange:n,onHidden:n,onShown:n,visible:!1},me={animated:a,ariaCloseButtonLabel:$,backdrop:a,backdropClass:$,backdropTransition:i,closeButton:a,closeOnOutsideClick:a,container:K,className:$,modalTransition:i,onBeforeClose:i,onVisibleChange:i,onHidden:i,onShown:i,visible:a},E=_(),pe=o(()=>E().length>0),ue=o(()=>{pe()?ne():ae()}),ve=o(()=>{ue()}),De=re("modal",H=>{const[{animated$:r,backdrop$:C,backdropTransition$:P,closeOnOutsideClick$:V,container$:p,modalTransition$:M,onBeforeClose$:N,onVisibleChange$:F,onHidden$:I,onShown$:L,ariaCloseButtonLabel$:g,className$:h,backdropClass$:y,visible$:w,...x},c]=Q(be,H,me),s=T({props:{transition:M,visible:w,animated:r,animatedOnInit:r,onVisibleChange:F,onHidden:I,onShown:L}}),u=s.stores.visible$,D=T({props:{transition:P,visible:w,animated:r,animatedOnInit:r}}),S=o(()=>s.stores.transitioning$()||C()&&D.stores.transitioning$()),l=o(()=>!S()&&!u()),q=o(()=>!C()||l());let d;const b=e=>{d=e;const t={get result(){return d},set result(m){d=m},cancel:!1};N()(t),!t.cancel&&c({visible:!1})},R=f(A,o(()=>({container:p()}))),W=f(A,o(()=>{const e=p(),t=e?s.stores.element$():void 0;return{container:e,insertBefore:t?.parentElement===e?t:void 0}})),Y=v(void 0,()=>E.register(B)),Z=o(()=>{s.stores.elementPresent$()&&!l()&&Y(),ve()}),j=k(()=>({attributes:{type:v("button"),"aria-label":g},events:{click:()=>b(le)}})),z=k(()=>({attributes:{class:y}})),G=k(()=>({attributes:{class:h,tabIndex:v("-1")},events:{click:e=>{e.currentTarget===e.target&&V()&&b(ce)},keydown:e=>{const{key:t}=e;t==="Escape"&&(b(de),e.stopPropagation())}}})),B={...U({backdropHidden$:q,container$:p,hidden$:l,transitioning$:S,visible$:u,modalElement$:s.stores.element$,ariaCloseButtonLabel$:g,className$:h,backdropClass$:y,...x}),directives:{modalPortalDirective:R,backdropPortalDirective:W,backdropDirective:O(D.directives.directive,z),modalDirective:O(s.directives.directive,oe(ie),te(Z),G,se),closeButtonDirective:j,dialogDirective:f(ee((e,t)=>{const m=J=>{J?e.showModal():e.close()};return m(t),{update:m}}),u)},patch:c,api:{close:b,async open(){return c({visible:!0}),await X(l).promise,d},patch:c}};return B});export{ce as a,le as b,De as c,de as m};
