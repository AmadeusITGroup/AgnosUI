import{Z as c,a1 as q,af as Q,a0 as B}from"./AppCommon-CwgpheFC.js";import{g as U,b as m,c as A}from"./writables-Is1bF1Vt-DduVNjup.js";import{p as E}from"./promise-Y53vc4Ia-Otf9n1Ut.js";import{q as X,m as Y,g as _,n as b}from"./dom-iY0R3D7u-B4H-kIla.js";import{w as F,e as T,s as ee}from"./stores-Zo5ehpUA.js";const N=new Promise(b),ne=($,h)=>{$.style.display=h==="show"?"":"none"},te={animated:!0,animatedOnInit:!1,initDone:null,visible:!0,transition:ne,onShown:b,onHidden:b,onVisibleChange:b},ie={animated:A,animatedOnInit:A,visible:A,transition:m,onShown:m,onHidden:m,onVisibleChange:m,initDone:U},ce=$=>{const[{animated$:h,initDone$:v,visible$:d,transition$:R,onShown$:W,onHidden$:Z,onVisibleChange$:j,animatedOnInit$:k},z]=F(te,$,ie),{element$:w,directive:G}=X(),y=c(()=>!!w()),u=T(j,[d],([e])=>e),l=q(null),x=()=>{let e;return l.update(n=>(n?.abort.abort(),e=n?.context,null)),e},J=(e,n,o,t)=>B(()=>{const p=new AbortController,i=p.signal,a=x()??{},{promise:r,resolve:S}=E(),f={abort:p,animated:n,visible:e,context:a,element:o,transitionFn:t,promise:r};return l.set(f),S((async()=>{try{await t(o,e?"show":"hide",n,i,a)}finally{i.aborted?await N:(l.set(null),(e?W:Z)()?.())}})()),f}),O=c(()=>v()?h():k()),g=q(null);let P,H=d(),s=null;const D=Q([u,w,O,g,R,l],([e,n,o,t,p,i])=>{const a=P!==n;P=n;const r=H!==e;if(H=e,n){v()==null&&v.set(!0);const S=t!=null&&i&&i.animated!=t;if(a||r||S){(r||t!=null)&&(s=null);const f=t??s?.animated??(a&&!e?!1:o);i=J(e,f,n,p),s?.resolve(i.promise),s=null}}else a&&(x(),i=null),(r||e&&s?.animated!==t)&&(s=e&&t!=null?{animated:t,...E()}:null);return s?.promise??i?.promise});let I={};const V=async(e=!d(),n=O())=>{const o={};I=o;try{await B(()=>{try{return g.set(n),d.set(e),D()}finally{g.set(null)}})}finally{I!==o&&await N}},C=c(()=>(y()&&D(),!!l())),K=c(()=>!C()&&u()&&y()),L=c(()=>!C()&&!u()),M=Y(G,_(D));return{...ee({visible$:u,element$:w,elementPresent$:y,transitioning$:C,shown$:K,hidden$:L}),patch:z,directives:{directive:M},api:{show:V.bind(null,!0),hide:V.bind(null,!1),toggle:V}}};export{ce as c};
