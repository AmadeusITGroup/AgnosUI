import{a9 as d,a6 as E,ac as U,a8 as q}from"./AppCommon-DE0E2XGg.js";import{t as A,a as m,c as X}from"./writables-DCiBdIBK-BvUcp8gb.js";import{p as N}from"./promise-CBh_HbSK-wA-CYZai.js";import{n as $,l as Y,m as Z,e as F}from"./dom-BB9jLllr-DsL3TsuS.js";import{w as T,d as nn,s as en}from"./stores-UZEPS6vP.js";const R=new Promise($),tn=(b,h)=>{b.style.display=h==="show"?"":"none"},sn={animated:!0,animatedOnInit:!1,initDone:null,visible:!0,transition:tn,onShown:$,onHidden:$,onVisibleChange:$},on={animated:A,animatedOnInit:A,visible:A,transition:m,onShown:m,onHidden:m,onVisibleChange:m,initDone:X},un=b=>{const[{animated$:h,initDone$:v,visible$:c,transition$:W,onShown$:_,onHidden$:j,onVisibleChange$:k,animatedOnInit$:z},G]=T(sn,b,on),{element$:w,directive:J}=Y(),y=d(()=>!!w()),u=nn(k,[c],([n])=>n),a=E(null),x=()=>{let n;return a.update(e=>(e==null||e.abort.abort(),n=e==null?void 0:e.context,null)),n},K=(n,e,o,i)=>q(()=>{const f=new AbortController,s=f.signal,l=x()??{},{promise:r,resolve:S}=N(),p={abort:f,animated:e,visible:n,context:l,element:o,transitionFn:i,promise:r};return a.set(p),S((async()=>{var B;try{await i(o,n?"show":"hide",e,s,l)}finally{s.aborted?await R:(a.set(null),(B=(n?_:j)())==null||B())}})()),p}),O=d(()=>v()?h():z()),g=E(null);let P,H=c(),t=null;const D=U([u,w,O,g,W,a],([n,e,o,i,f,s])=>{const l=P!==e;P=e;const r=H!==n;if(H=n,e){v()==null&&v.set(!0);const S=i!=null&&s&&s.animated!=i;if(l||r||S){(r||i!=null)&&(t=null);const p=i??(t==null?void 0:t.animated)??(l&&!n?!1:o);s=K(n,p,e,f),t==null||t.resolve(s.promise),t=null}}else l&&(x(),s=null),(r||n&&(t==null?void 0:t.animated)!==i)&&(t=n&&i!=null?{animated:i,...N()}:null);return(t==null?void 0:t.promise)??(s==null?void 0:s.promise)});let I={};const V=async(n=!c(),e=O())=>{const o={};I=o;try{await q(()=>{try{return g.set(e),c.set(n),D()}finally{g.set(null)}})}finally{I!==o&&await R}},C=d(()=>(y()&&D(),!!a())),L=d(()=>!C()&&u()&&y()),M=d(()=>!C()&&!u()),Q=Z(J,F(D));return{...en({visible$:u,element$:w,elementPresent$:y,transitioning$:C,shown$:L,hidden$:M}),patch:G,directives:{directive:Q},api:{show:V.bind(null,!0),hide:V.bind(null,!1),toggle:V}}};export{un as c};
