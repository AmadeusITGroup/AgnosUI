import{a9 as u,a6 as Ce,ab as ue,a8 as Ie,p as ke,M as ce,P as me,c as ye,d as R,b as W,a as Fe,r as ve,t as oe,L as Se,s as ge,g as d,n as he,k as se,q as x,l as B}from"./AppCommon-CEfp6GOi.js";import{a as m}from"./actions-CBYbTGn1.js";import{S as fe}from"./Slot-C7JyPn3q.js";import{c as $e}from"./config-BVNYqkgi.js";import{c as Le,o as Ne,a as Te,b as Pe}from"./floatingUI-BTsucM4Z.js";import{c as De}from"./focustrack-DtGKviuS.js";import{c as Me}from"./navManager-BHVWTpnr.js";import{w as Ae,D as Ee,y as Oe,x as Be,s as He,m as Re,B as We,n as de,a as H,c as ie}from"./stores-DX-ADOKq-D9qbYGXJ.js";import{e as qe}from"./extendWidget-Cst5VrRh.js";const ze={id:void 0,ariaLabel:"Select",open:!1,disabled:!1,items:[],filterText:"",loading:!1,selected:[],navSelector:n=>n.querySelectorAll(".au-select-badge,input"),itemIdFn:n=>""+n,onOpenChange:de,onFilterTextChange:de,onSelectedChange:de,allowedPlacements:["bottom-start","top-start","bottom-end","top-end"],className:"",menuClassName:"",menuItemClassName:"",badgeClassName:""};function Ue(n){const[{id$:r,open$:w,filterText$:h,items$:X,itemIdFn$:q,onOpenChange$:C,onFilterTextChange$:ne,onSelectedChange$:p,allowedPlacements$:z,navSelector$:I,className$:U,badgeClassName$:$,ariaLabel$:L,menuClassName$:N,...T},j]=Ae(ze,n),{selected$:b}=T,P=u(()=>r()??Ee()),G=Oe(h,ne),{hasFocus$:k,directive:re}=De(),f=Be(C,[w,k],([e,t])=>e&&t),D=u(()=>{const e=new Map,t=q();for(const s of b()){const v=t(s);e.set(v,{item:s,id:t(s),selected:!0})}return e}),Y=u(()=>[...D().values()]),y=function(){const e=Ce(0);return ue(e,t=>{const{length:s}=M();t!=null&&(s?t<0?t=s-1:t>=s&&(t=0):t=void 0),e.set(t)})}(),J=u(()=>{const e=new Map;if(f()){const t=D(),s=q();for(const v of X()){const F=s(v);e.set(F,{item:v,id:F,selected:t.has(F)})}}return e}),M=u(()=>f()?[...J().values()]:[]),Z=u(()=>{const e=M(),t=y();return e.length&&t!=null?e[t]:void 0}),{directives:{floatingDirective:a,referenceDirective:i},stores:{placement$:l}}=Le({props:{computePositionOptions:ue(u(()=>({middleware:[Ne(5),Te({allowedPlacements:z()}),Pe()]})))}}),{directive:A,refreshElements:o,focusFirst:_,focusLast:g,focusLeft:E,focusRight:O}=Me(),K=u(()=>({keys:{Home:_,End:g,ArrowLeft:E,ArrowRight:O},selector:I()})),ee=(e,t)=>{const s=e.target;o(),c.api.unselect(t),s instanceof HTMLElement&&setTimeout(()=>{E({event:e,referenceElement:s})||O({event:e,referenceElement:s})}),e.preventDefault()},le=H(()=>({attributes:{role:"combobox","aria-haspopup":"listbox","aria-expanded":u(()=>`${f()}`),"aria-controls":u(()=>`${P()}-menu`)}})),Q=H(e=>({attributes:{tabindex:-1,class:$},classNames:{"au-select-badge":!0},events:{keydown:t=>{let s=!1;switch(t.key){case"Backspace":case"Delete":{ee(t,e().item),s=!0;break}}s&&t.preventDefault()}}})),V=H(()=>({attributes:{role:"listbox",id:u(()=>`${P()}-menu`),"data-popper-placement":l,class:N},events:{mousedown:e=>e.preventDefault()}})),te=H(e=>({attributes:{role:"option","aria-selected":u(()=>`${e().selected}`),style:"cursor: pointer"},classNames:{"au-select-item":!0,selected:u(()=>e().selected)},events:{click:()=>c.api.toggleItem(e().item)}})),be=H(()=>({attributes:{id:P(),type:"text","aria-label":L(),"aria-autocomplete":"list",autocorrect:"off",autocapitalize:"none",autocomplete:"off"},classNames:{"au-select-input":!0},events:{input:e=>{const t=e.target.value;Ie(()=>{f.set(t!=null&&t!==""),G.set(t)})},keydown:({ctrlKey:e,key:t,preventDefault:s})=>{let v=!0;switch(t){case"ArrowDown":{f()?e?c.api.highlightLast():c.api.highlightNext():(c.api.open(),c.api.highlightFirst());break}case"ArrowUp":e?c.api.highlightFirst():c.api.highlightPrevious();break;case"Enter":{const F=Z();F&&c.api.toggleItem(F.item);break}case"Escape":f.set(!1);break;default:v=!1}v&&s()}}})),_e=H(e=>({events:{click:t=>{ee(t,e().item)}}})),c={...He({id$:P,visibleItems$:M,highlighted$:Z,open$:f,selectedContexts$:Y,filterText$:G,placement$:l,className$:U,badgeClassName$:$,ariaLabel$:L,menuClassName$:N,...T}),patch:j,api:{clear(){b.set([])},select(e){c.api.toggleItem(e,!0)},unselect(e){c.api.toggleItem(e,!1)},toggleItem(e,t){const s=q(),v=s(e),ae=D().has(v);t==null&&(t=!ae),!(t&&!J().has(v)||!t&&!ae)&&b.update(S=>{var pe;if(S=[...S],t&&!ae)S.push(e);else if(!t&&ae){const xe=S.findIndex(we=>s(we)===v);S.splice(xe,1)}return(pe=p())==null||pe(S),S})},clearText(){},highlight(e){const t=M().findIndex(s=>s.item===e);y.set(t===-1?void 0:t)},highlightFirst(){y.set(0)},highlightPrevious(){y.update(e=>e!=null?e-1:-1)},highlightNext(){y.update(e=>e!=null?e+1:1/0)},highlightLast(){y.set(-1)},open:()=>c.api.toggle(!0),close:()=>c.api.toggle(!1),toggle(e){f.update(t=>e??!t)}},directives:{hasFocusDirective:re,floatingDirective:a,referenceDirective:i,inputContainerDirective:Re(We(A,K),le),badgeAttributesDirective:Q,menuAttributesDirective:V,itemAttributesDirective:te,inputDirective:be,badgeCloseButtonDirective:_e}};return c}const je={badgeLabel:({itemContext:n})=>n.item,itemLabel:({itemContext:n})=>n.item},Ge=qe(Ue,je),Je=Ge,Qe=(n,r)=>{let w=()=>r==null?void 0:r().itemContext;var h=ve();R(()=>he(h,w().item)),W(n,h)},Ve=(n,r)=>{let w=()=>r==null?void 0:r().itemContext;var h=ve();R(()=>he(h,w().item)),W(n,h)};var Xe=oe("<div><!></div>"),Ye=oe("<li><!></li>"),Ze=oe("<ul></ul>"),Ke=oe("<div><div><!> <input></div> <!></div>");function ct(n,r){ke(r,!0);let w=ce(r,"open",15,!1),h=ce(r,"filterText",15),X=ce(r,"selected",15),q=Se(r,["$$slots","$$events","$$legacy","open","filterText","selected"]);const C=$e({factory:Je,widgetName:"select",get props(){return{...q,open:w(),filterText:h(),selected:X()}},enablePatchChanged:!0,defaultConfig:{badgeLabel:Qe,itemLabel:Ve},events:{onOpenChange(a){w(a)},onSelectedChange:a=>{X(a)},onFilterTextChange:a=>{h(a)}}}),ne=C.api,{state:p,directives:{floatingDirective:z,hasFocusDirective:I,referenceDirective:U,inputContainerDirective:$,badgeAttributesDirective:L,menuAttributesDirective:N,itemAttributesDirective:T,inputDirective:j}}=C;var b=Ke();const P=x(()=>({}));let G;var k=se(b);const re=x(()=>({}));let f;var D=se(k);me(D,17,()=>p.selectedContexts,a=>a.id,(a,i)=>{var l=Xe();const A=x(()=>({}));let o;var _=se(l),g=x(()=>({state:p,directives:C.directives,api:C.api,itemContext:d(i)}));fe(_,{get content(){return p.badgeLabel},get props(){return d(g)}}),m(l,(E,O)=>L==null?void 0:L(E,O),()=>d(i)),R(()=>o=B(l,o,{...d(A)})),W(a,l)});var Y=ge(D,2);const y=x(()=>({}));let J;m(Y,a=>j==null?void 0:j(a)),m(k,a=>I==null?void 0:I(a)),m(k,a=>$==null?void 0:$(a)),m(k,(a,i)=>{var l;return(l=ie)==null?void 0:l(a,i)},()=>"d-flex align-items-center flex-wrap gap-1");var M=ge(k,2);{var Z=a=>{var i=Ze();const l=x(()=>({}));let A;me(i,21,()=>p.visibleItems,o=>o.id,(o,_)=>{var g=Ye();const E=x(()=>d(_)===p.highlighted),O=x(()=>({}));let K;var ee=se(g),le=x(()=>({state:p,directives:C.directives,api:C.api,itemContext:d(_)}));fe(ee,{get content(){return p.itemLabel},get props(){return d(le)}}),m(g,(Q,V)=>{var te;return(te=ie)==null?void 0:te(Q,V)},()=>["dropdown-item position-relative",{"text-bg-primary":d(E)}]),m(g,(Q,V)=>T==null?void 0:T(Q,V),()=>d(_)),R(()=>K=B(g,K,{...d(O)})),W(o,g)}),m(i,o=>I==null?void 0:I(o)),m(i,o=>z==null?void 0:z(o)),m(i,o=>N==null?void 0:N(o)),m(i,(o,_)=>{var g;return(g=ie)==null?void 0:g(o,_)},()=>"dropdown-menu show"),R(()=>A=B(i,A,{...d(l)})),W(a,i)};ye(M,a=>{p.open&&p.visibleItems.length>0&&a(Z)})}return m(b,a=>U==null?void 0:U(a)),m(b,(a,i)=>{var l;return(l=ie)==null?void 0:l(a,i)},()=>"au-select dropdown border border-1 p-1 mb-3 d-block "+p.className),R(()=>{G=B(b,G,{...d(P)}),f=B(k,f,{...d(re)}),J=B(Y,J,{value:p.filterText,...d(y)})}),W(n,b),Fe({api:ne})}export{ct as S};
