import{Z as l,a1 as we,$ as se,Y as g,a0 as Fe,a as _e,L as V,I as Ie,f as j,e as k,h as z,O as oe,g as _,d as S,s as re,j as ke,p as ye,J as X,q as ce,t as le,k as de}from"./AppCommon-CTA2S8Vh.js";import{a as d}from"./actions-DwmA-Vw0.js";import{S as ne}from"./Slot-ChGbuX9N.js";import{c as Se}from"./config-DLHLM7x0.js";import{c as Le,o as Te,a as Ne,b as Ae}from"./floatingUI-D1274LAO.js";import{c as Pe}from"./focustrack-CteNHcBF.js";import{c as Me}from"./navManager-BG8BwBoC.js";import{n as K,g as Ee,m as Oe,a as y,d as He,c as U}from"./dom-q8JF3QN8-C1xEaPzR.js";import{w as We,b as Be,e as Re,s as qe,t as ee}from"./stores-DC-t9M1A.js";import{c as ze}from"./widget-BOd7n8SM.js";import{e as Ue}from"./extendWidget-DSzDPIHA.js";const je={id:void 0,ariaLabel:"Select",open:!1,disabled:!1,items:[],filterText:"",loading:!1,selected:[],navSelector:r=>r.querySelectorAll(".au-select-badge,input"),itemIdFn:r=>""+r,onOpenChange:K,onFilterTextChange:K,onSelectedChange:K,allowedPlacements:["bottom-start","top-start","bottom-end","top-end"],className:"",menuClassName:"",menuItemClassName:"",badgeClassName:""},Je=ze("select",r=>{const[{id$:u,open$:D,filterText$:f,items$:P,itemIdFn$:L,onOpenChange$:w,onFilterTextChange$:J,onSelectedChange$:c,allowedPlacements$:Y,navSelector$:M,className$:Z,badgeClassName$:E,ariaLabel$:O,menuClassName$:H,...W},G]=We(je,r),{selected$:T}=W,v=l(()=>u()??Ee()),$=Be(f,J),{hasFocus$:B,directive:R}=Pe(),h=Re(w,[D,B],([e,t])=>e&&t),N=l(()=>{const e=new Map,t=L();for(const a of T()){const m=t(a);e.set(m,{item:a,id:t(a),selected:!0})}return e}),i=l(()=>[...N().values()]),s=(function(){const e=we(0);return se(e,t=>{const{length:a}=p();t!=null&&(a?t<0?t=a-1:t>=a&&(t=0):t=void 0),e.set(t)})})(),o=l(()=>{const e=new Map;if(h()){const t=N(),a=L();for(const m of P()){const F=a(m);e.set(F,{item:m,id:F,selected:t.has(F)})}}return e}),p=l(()=>h()?[...o().values()]:[]),b=l(()=>{const e=p(),t=s();return e.length&&t!=null?e[t]:void 0}),{directives:{floatingDirective:C,referenceDirective:Q},stores:{placement$:x}}=Le({props:{computePositionOptions:se(l(()=>({middleware:[Te(5),Ne({allowedPlacements:Y()}),Ae()]})))}}),{directive:A,refreshElements:pe,focusFirst:ue,focusLast:me,focusLeft:te,focusRight:ie}=Me(),ge=l(()=>({keys:{Home:ue,End:me,ArrowLeft:te,ArrowRight:ie},selector:M()})),ae=(e,t)=>{const a=e.target;pe(),n.api.unselect(t),a instanceof HTMLElement&&setTimeout(()=>{te({event:e,referenceElement:a})||ie({event:e,referenceElement:a})}),e.preventDefault()},fe=y(()=>({attributes:{role:g("combobox"),"aria-haspopup":g("listbox"),"aria-expanded":l(()=>`${h()}`),"aria-controls":l(()=>`${v()}-menu`)}})),ve=y(e=>({attributes:{tabindex:g(-1),class:E},classNames:{"au-select-badge":ee},events:{keydown:t=>{let a=!1;switch(t.key){case"Backspace":case"Delete":{ae(t,e().item),a=!0;break}}a&&t.preventDefault()}}})),he=y(()=>({attributes:{role:g("listbox"),id:l(()=>`${v()}-menu`),"data-popper-placement":x,class:H},events:{mousedown:e=>e.preventDefault()}})),be=y(e=>({attributes:{role:g("option"),"aria-selected":l(()=>`${e().selected}`),style:g("cursor: pointer")},classNames:{"au-select-item":ee,selected:l(()=>e().selected)},events:{click:()=>n.api.toggleItem(e().item)}})),xe=y(()=>({attributes:{id:v,type:g("text"),"aria-label":O,"aria-autocomplete":g("list"),autocorrect:g("off"),autocapitalize:g("none"),autocomplete:g("off")},classNames:{"au-select-input":ee},events:{input:e=>{const t=e.target.value;Fe(()=>{h.set(t!=null&&t!==""),$.set(t)})},keydown:({ctrlKey:e,key:t,preventDefault:a})=>{let m=!0;switch(t){case"ArrowDown":{h()?e?n.api.highlightLast():n.api.highlightNext():(n.api.open(),n.api.highlightFirst());break}case"ArrowUp":e?n.api.highlightFirst():n.api.highlightPrevious();break;case"Enter":{const F=b();F&&n.api.toggleItem(F.item);break}case"Escape":h.set(!1);break;default:m=!1}m&&a()}}})),$e=y(e=>({events:{click:t=>{ae(t,e().item)}}})),n={...qe({id$:v,visibleItems$:p,highlighted$:b,open$:h,selectedContexts$:i,filterText$:$,placement$:x,className$:Z,badgeClassName$:E,ariaLabel$:O,menuClassName$:H,...W}),patch:G,api:{clear(){T.set([])},select(e){n.api.toggleItem(e,!0)},unselect(e){n.api.toggleItem(e,!1)},toggleItem(e,t){const a=L(),m=a(e),q=N().has(m);t==null&&(t=!q),!(t&&!o().has(m)||!t&&!q)&&T.update(I=>{if(I=[...I],t&&!q)I.push(e);else if(!t&&q){const Ce=I.findIndex(De=>a(De)===m);I.splice(Ce,1)}return c()?.(I),I})},clearText(){},highlight(e){const t=p().findIndex(a=>a.item===e);s.set(t===-1?void 0:t)},highlightFirst(){s.set(0)},highlightPrevious(){s.update(e=>e!=null?e-1:-1)},highlightNext(){s.update(e=>e!=null?e+1:1/0)},highlightLast(){s.set(-1)},open:()=>n.api.toggle(!0),close:()=>n.api.toggle(!1),toggle(e){h.update(t=>e??!t)}},directives:{hasFocusDirective:R,floatingDirective:C,referenceDirective:Q,inputContainerDirective:Oe(He(A,ge),fe),badgeAttributesDirective:ve,menuAttributesDirective:he,itemAttributesDirective:be,inputDirective:xe,badgeCloseButtonDirective:$e}};return n}),Ye={badgeLabel:({itemContext:r})=>r.item,itemLabel:({itemContext:r})=>r.item},Ze=Ue(Je,Ye),Ge=Ze,Qe=(r,u)=>{let D=()=>u?.().itemContext;var f=ce();le(()=>de(f,D().item)),S(r,f)},Ve=(r,u)=>{let D=()=>u?.().itemContext;var f=ce();le(()=>de(f,D().item)),S(r,f)};var Xe=j("<div><!></div>"),Ke=j("<li><!></li>"),et=j("<ul></ul>"),tt=j("<div><div><!> <input/></div> <!></div>");function mt(r,u){_e(u,!0);let D=V(u,"open",15,!1),f=V(u,"filterText",15),P=V(u,"selected",15),L=Ie(u,["$$slots","$$events","$$legacy","open","filterText","selected"]);const w=Se(Ge,{get props(){return{...L,open:D(),filterText:f(),selected:P()}},defaultConfig:{badgeLabel:Qe,itemLabel:Ve},events:{onOpenChange(i){D(i)},onSelectedChange:i=>{P(i)},onFilterTextChange:i=>{f(i)}}}),J=w.api,{state:c,directives:{floatingDirective:Y,hasFocusDirective:M,referenceDirective:Z,inputContainerDirective:E,badgeAttributesDirective:O,menuAttributesDirective:H,itemAttributesDirective:W,inputDirective:G}}=w;var T={api:J},v=tt();k(v,i=>({...i}),[()=>({})]);var $=z(v);k($,i=>({...i}),[()=>({})]);var B=z($);oe(B,17,()=>c.selectedContexts,i=>i.id,(i,s)=>{var o=Xe();k(o,b=>({...b}),[()=>({})]);var p=z(o);{let b=X(()=>({state:c,directives:w.directives,api:w.api,itemContext:_(s)}));ne(p,{get content(){return c.badgeLabel},get props(){return _(b)}})}d(o,(b,C)=>O?.(b,C),()=>_(s)),S(i,o)});var R=re(B,2);k(R,i=>({value:c.filterText,...i}),[()=>({})],void 0,void 0,void 0,!0),d(R,i=>G?.(i)),d($,i=>M?.(i)),d($,i=>E?.(i)),d($,(i,s)=>U?.(i,s),()=>"d-flex align-items-center flex-wrap gap-1");var h=re($,2);{var N=i=>{var s=et();k(s,o=>({...o}),[()=>({})]),oe(s,21,()=>c.visibleItems,o=>o.id,(o,p)=>{const b=X(()=>_(p)===c.highlighted);var C=Ke();k(C,x=>({...x}),[()=>({})]);var Q=z(C);{let x=X(()=>({state:c,directives:w.directives,api:w.api,itemContext:_(p)}));ne(Q,{get content(){return c.itemLabel},get props(){return _(x)}})}d(C,(x,A)=>U?.(x,A),()=>["dropdown-item position-relative",{"text-bg-primary":_(b)}]),d(C,(x,A)=>W?.(x,A),()=>_(p)),S(o,C)}),d(s,o=>M?.(o)),d(s,o=>Y?.(o)),d(s,o=>H?.(o)),d(s,(o,p)=>U?.(o,p),()=>"dropdown-menu show"),S(i,s)};ke(h,i=>{c.open&&c.visibleItems.length>0&&i(N)})}return d(v,i=>Z?.(i)),d(v,(i,s)=>U?.(i,s),()=>"au-select dropdown border border-1 p-1 mb-3 d-block "+c.className),S(r,v),ye(T)}export{mt as S};
