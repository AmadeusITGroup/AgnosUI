import{a1 as y,Z as l,a9 as v,aa as S,$ as h,a0 as V,_ as $}from"./index-14bf255f.js";import{i as w}from"./directiveUtils-0f196314.js";function O(t){return function(e){S(()=>{var r;for(const[n,s]of Object.entries(e??{}))(r=t[`${n}$`])==null||r.set(s)})}}function E(t,e){if(t===e)return null;let r=!1;const n={},s=new Set([...Object.keys(t),...Object.keys(e)]);for(const o of s){const a=e[o];t[o]!==a&&(n[o]=a,r=!0)}return r?n:null}const D=function(t){this.set(t(this()))},m=Symbol();function z(t,e=h(void 0),r={},n=V(void 0)){const{normalizeValue:s=w,equal:o=Object.is}=r,a=()=>t,c=(i,u=a)=>{const f=i===void 0?void 0:s(i);return f===m?(console.error("Not using invalid value",i),u()):f===void 0?u():f},d=l(()=>c(e()),{equal:o}),k=l(()=>c(n(),d),{equal:o});return y(k,{set(i){if(i!==void 0){const u=s(i);if(u===m){console.error("Not setting invalid value",i);return}i=u}n.set(i)},update:D})}const b=t=>!!(t&&typeof t=="function"&&"subscribe"in t),N=t=>b(t)?t:h(t),I=t=>b(t)?t:V(t),W=(t,e)=>{const r={};if(e){const n=b(e);for(const s of t)r[s]=n?l(()=>e()[s]):N(e[s])}return r},L=(t,e,r)=>{const n={};for(const s of t){const o=e==null?void 0:e[s],a=r==null?void 0:r[s];n[s]=o&&a?l(()=>o()??a()):o||a}return n},A=(t,e,r)=>{const n={},s=Object.keys(t),o=W(s,e==null?void 0:e.config),a=e==null?void 0:e.props;for(const c of s){const d=a==null?void 0:a[c];n[`${c}$`]=z(t[c],o[c],r==null?void 0:r[c],I(d))}return n},R=(t,e,r)=>{const n=A(t,e,r);return[n,O(n)]},U=t=>{const e=[],r=[],n={};for(const s of Object.keys(t))if(s.endsWith("$")){const o=t[s];e.push(s.substring(0,s.length-1)),r.push(o),n[s]=y(o)}return{stores:n,state$:l(()=>{const s=r.map(v),o={};return e.forEach((a,c)=>{o[a]=s[c]}),o})}},_=(t,e,r=s=>s[0],n=(s,o)=>o===s)=>{let s=e[0]();return $(e,{derive(o){const a=r(o),c=!n(o[0],a);return c&&e[0].set(a),(c||!n(s,a))&&(s=a,t()(a)),a},equal:n})};export{m as I,_ as b,E as f,L as m,W as n,U as s,N as t,R as w};
