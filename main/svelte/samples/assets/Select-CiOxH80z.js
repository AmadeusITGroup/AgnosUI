import{a9 as u,a6 as Ie,aa as de,W as b,a8 as $e,p as ye,M as ie,P as pe,c as Fe,d as q,b as B,a as Se,q as fe,t as Z,K as Le,s as ue,k as H,n as X,g as F,l as ge,L as ne}from"./AppCommon-DE0E2XGg.js";import{a as m}from"./actions-DYuHte2n.js";import{S as me}from"./Slot-DGS7uvdj.js";import{c as Ne}from"./config-De4m06Wr.js";import{c as Te,o as Pe,a as Me,b as De}from"./floatingUI-B6hAk1ej.js";import{c as Ae}from"./focustrack-BP51_8qT.js";import{c as Ee}from"./navManager-CA_zeAke.js";import{k as Oe,m as He,q as We,n as oe,a as W,c as Y}from"./dom-BB9jLllr-DsL3TsuS.js";import{w as qe,e as Be,d as Re,s as ze,t as re}from"./stores-UZEPS6vP.js";import{e as Ue}from"./extendWidget-mDGq-wZs.js";const je={id:void 0,ariaLabel:"Select",open:!1,disabled:!1,items:[],filterText:"",loading:!1,selected:[],navSelector:r=>r.querySelectorAll(".au-select-badge,input"),itemIdFn:r=>""+r,onOpenChange:oe,onFilterTextChange:oe,onSelectedChange:oe,allowedPlacements:["bottom-start","top-start","bottom-end","top-end"],className:"",menuClassName:"",menuItemClassName:"",badgeClassName:""};function Ge(r){const[{id$:l,open$:w,filterText$:h,items$:G,itemIdFn$:R,onOpenChange$:_,onFilterTextChange$:ee,onSelectedChange$:d,allowedPlacements$:z,navSelector$:k,className$:U,badgeClassName$:T,ariaLabel$:P,menuClassName$:M,...D},j]=qe(je,r),{selected$:v}=D,S=u(()=>l()??Oe()),x=Be(h,ee),{hasFocus$:J,directive:K}=Ae(),f=Re(_,[w,J],([e,t])=>e&&t),A=u(()=>{const e=new Map,t=R();for(const a of v()){const g=t(a);e.set(g,{item:a,id:t(a),selected:!0})}return e}),te=u(()=>[...A().values()]),I=function(){const e=Ie(0);return de(e,t=>{const{length:a}=i();t!=null&&(a?t<0?t=a-1:t>=a&&(t=0):t=void 0),e.set(t)})}(),s=u(()=>{const e=new Map;if(f()){const t=A(),a=R();for(const g of G()){const y=a(g);e.set(y,{item:g,id:y,selected:t.has(y)})}}return e}),i=u(()=>f()?[...s().values()]:[]),n=u(()=>{const e=i(),t=I();return e.length&&t!=null?e[t]:void 0}),{directives:{floatingDirective:o,referenceDirective:C},stores:{placement$:p}}=Te({props:{computePositionOptions:de(u(()=>({middleware:[Pe(5),Me({allowedPlacements:z()}),De()]})))}}),{directive:L,refreshElements:E,focusFirst:se,focusLast:ae,focusLeft:$,focusRight:O}=Ee(),Q=u(()=>({keys:{Home:se,End:ae,ArrowLeft:$,ArrowRight:O},selector:k()})),le=(e,t)=>{const a=e.target;E(),c.api.unselect(t),a instanceof HTMLElement&&setTimeout(()=>{$({event:e,referenceElement:a})||O({event:e,referenceElement:a})}),e.preventDefault()},be=W(()=>({attributes:{role:b("combobox"),"aria-haspopup":b("listbox"),"aria-expanded":u(()=>`${f()}`),"aria-controls":u(()=>`${S()}-menu`)}})),he=W(e=>({attributes:{tabindex:b(-1),class:T},classNames:{"au-select-badge":re},events:{keydown:t=>{let a=!1;switch(t.key){case"Backspace":case"Delete":{le(t,e().item),a=!0;break}}a&&t.preventDefault()}}})),ve=W(()=>({attributes:{role:b("listbox"),id:u(()=>`${S()}-menu`),"data-popper-placement":p,class:M},events:{mousedown:e=>e.preventDefault()}})),xe=W(e=>({attributes:{role:b("option"),"aria-selected":u(()=>`${e().selected}`),style:b("cursor: pointer")},classNames:{"au-select-item":re,selected:u(()=>e().selected)},events:{click:()=>c.api.toggleItem(e().item)}})),Ce=W(()=>({attributes:{id:S,type:b("text"),"aria-label":P,"aria-autocomplete":b("list"),autocorrect:b("off"),autocapitalize:b("none"),autocomplete:b("off")},classNames:{"au-select-input":re},events:{input:e=>{const t=e.target.value;$e(()=>{f.set(t!=null&&t!==""),x.set(t)})},keydown:({ctrlKey:e,key:t,preventDefault:a})=>{let g=!0;switch(t){case"ArrowDown":{f()?e?c.api.highlightLast():c.api.highlightNext():(c.api.open(),c.api.highlightFirst());break}case"ArrowUp":e?c.api.highlightFirst():c.api.highlightPrevious();break;case"Enter":{const y=n();y&&c.api.toggleItem(y.item);break}case"Escape":f.set(!1);break;default:g=!1}g&&a()}}})),we=W(e=>({events:{click:t=>{le(t,e().item)}}})),c={...ze({id$:S,visibleItems$:i,highlighted$:n,open$:f,selectedContexts$:te,filterText$:x,placement$:p,className$:U,badgeClassName$:T,ariaLabel$:P,menuClassName$:M,...D}),patch:j,api:{clear(){v.set([])},select(e){c.api.toggleItem(e,!0)},unselect(e){c.api.toggleItem(e,!1)},toggleItem(e,t){const a=R(),g=a(e),V=A().has(g);t==null&&(t=!V),!(t&&!s().has(g)||!t&&!V)&&v.update(N=>{var ce;if(N=[...N],t&&!V)N.push(e);else if(!t&&V){const _e=N.findIndex(ke=>a(ke)===g);N.splice(_e,1)}return(ce=d())==null||ce(N),N})},clearText(){},highlight(e){const t=i().findIndex(a=>a.item===e);I.set(t===-1?void 0:t)},highlightFirst(){I.set(0)},highlightPrevious(){I.update(e=>e!=null?e-1:-1)},highlightNext(){I.update(e=>e!=null?e+1:1/0)},highlightLast(){I.set(-1)},open:()=>c.api.toggle(!0),close:()=>c.api.toggle(!1),toggle(e){f.update(t=>e??!t)}},directives:{hasFocusDirective:K,floatingDirective:o,referenceDirective:C,inputContainerDirective:He(We(L,Q),be),badgeAttributesDirective:he,menuAttributesDirective:ve,itemAttributesDirective:xe,inputDirective:Ce,badgeCloseButtonDirective:we}};return c}const Je={badgeLabel:({itemContext:r})=>r.item,itemLabel:({itemContext:r})=>r.item},Ke=Ue(Ge,Je),Qe=Ke,Ve=(r,l)=>{let w=()=>l==null?void 0:l().itemContext;var h=fe();q(()=>ge(h,w().item)),B(r,h)},Xe=(r,l)=>{let w=()=>l==null?void 0:l().itemContext;var h=fe();q(()=>ge(h,w().item)),B(r,h)};var Ye=Z("<div><!></div>"),Ze=Z("<li><!></li>"),et=Z("<ul></ul>"),tt=Z("<div><div><!> <input></div> <!></div>");function ut(r,l){ye(l,!0);let w=ie(l,"open",15,!1),h=ie(l,"filterText",15),G=ie(l,"selected",15),R=Le(l,["$$slots","$$events","$$legacy","open","filterText","selected"]);const _=Ne({factory:Qe,widgetName:"select",get props(){return{...R,open:w(),filterText:h(),selected:G()}},enablePatchChanged:!0,defaultConfig:{badgeLabel:Ve,itemLabel:Xe},events:{onOpenChange(s){w(s)},onSelectedChange:s=>{G(s)},onFilterTextChange:s=>{h(s)}}}),ee=_.api,{state:d,directives:{floatingDirective:z,hasFocusDirective:k,referenceDirective:U,inputContainerDirective:T,badgeAttributesDirective:P,menuAttributesDirective:M,itemAttributesDirective:D,inputDirective:j}}=_;var v=tt();let S;var x=X(v);let J;var K=X(x);pe(K,17,()=>d.selectedContexts,s=>s.id,(s,i)=>{var n=Ye();let o;var C=X(n);const p=ne(()=>({state:d,directives:_.directives,api:_.api,itemContext:F(i)}));me(C,{get content(){return d.badgeLabel},get props(){return F(p)}}),m(n,(L,E)=>P==null?void 0:P(L,E),()=>F(i)),q(L=>o=H(n,o,{...L}),[()=>({})]),B(s,n)});var f=ue(K,2);let A;m(f,s=>j==null?void 0:j(s)),m(x,s=>k==null?void 0:k(s)),m(x,s=>T==null?void 0:T(s)),m(x,(s,i)=>{var n;return(n=Y)==null?void 0:n(s,i)},()=>"d-flex align-items-center flex-wrap gap-1");var te=ue(x,2);{var I=s=>{var i=et();let n;pe(i,21,()=>d.visibleItems,o=>o.id,(o,C)=>{var p=Ze();const L=ne(()=>F(C)===d.highlighted);let E;var se=X(p);const ae=ne(()=>({state:d,directives:_.directives,api:_.api,itemContext:F(C)}));me(se,{get content(){return d.itemLabel},get props(){return F(ae)}}),m(p,($,O)=>{var Q;return(Q=Y)==null?void 0:Q($,O)},()=>["dropdown-item position-relative",{"text-bg-primary":F(L)}]),m(p,($,O)=>D==null?void 0:D($,O),()=>F(C)),q($=>E=H(p,E,{...$}),[()=>({})]),B(o,p)}),m(i,o=>k==null?void 0:k(o)),m(i,o=>z==null?void 0:z(o)),m(i,o=>M==null?void 0:M(o)),m(i,(o,C)=>{var p;return(p=Y)==null?void 0:p(o,C)},()=>"dropdown-menu show"),q(o=>n=H(i,n,{...o}),[()=>({})]),B(s,i)};Fe(te,s=>{d.open&&d.visibleItems.length>0&&s(I)})}return m(v,s=>U==null?void 0:U(s)),m(v,(s,i)=>{var n;return(n=Y)==null?void 0:n(s,i)},()=>"au-select dropdown border border-1 p-1 mb-3 d-block "+d.className),q((s,i,n)=>{S=H(v,S,{...s}),J=H(x,J,{...i}),A=H(f,A,{value:d.filterText,...n})},[()=>({}),()=>({}),()=>({})]),B(r,v),Se({api:ee})}export{ut as S};
