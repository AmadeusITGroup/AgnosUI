import{H as d,I as N,ab as X,aa as R}from"./AppCommon-CEfWotzS.js";import{t as S,a as b,f as Y}from"./writables-_Hf-xFlO.js";import{a as U}from"./promise-BgYHP4OP.js";import{n as p}from"./func-fOTgS_tI.js";import{w as Z,b as _,s as F}from"./stores-Bv6KburJ.js";import{e as T,m as ee,d as te,f as se}from"./directive-w7L2CNRH.js";const W=new Promise(p),oe=async($,h)=>{$.style.display=h==="show"?"":"none"},le={animated:!0,animatedOnInit:!1,initDone:null,visible:!0,transition:oe,onShown:p,onHidden:p,onVisibleChange:p},ae={animated:S,animatedOnInit:S,visible:S,transition:b,onShown:b,onHidden:b,onVisibleChange:b,initDone:Y},me=$=>{const[{animated$:h,initDone$:v,visible$:f,transition$:g,onShown$:j,onHidden$:k,onVisibleChange$:z,animatedOnInit$:G},A]=Z(le,$,ae),{element$:w,directive:J}=T(),x=d(()=>!!w()),r=_(z,[f],([e])=>e),i=N(null),y=d(()=>!!i()),H=()=>{let e;return i.update(t=>(t==null||t.abort.abort(),e=t==null?void 0:t.context,null)),e},K=(e,t,a,l)=>R(()=>{const m=new AbortController,o=m.signal,n=H()??{},{promise:c,resolve:C}=U(),u={abort:m,animated:t,visible:e,context:n,element:a,transitionFn:l,promise:c};return i.set(u),C((async()=>{var q;try{await l(a,e?"show":"hide",t,o,n)}finally{o.aborted?await W:(i.set(null),(q=(e?j:k)())==null||q())}})()),u}),L=d(()=>!y()&&r()&&x()),M=d(()=>!y()&&!r()),I=d(()=>v()?h():G()),D=N(null);let O,P=f(),s=null;const B=X([r,w,I,D,g,i],([e,t,a,l,m,o])=>{const n=O!==t;O=t;const c=P!==e;if(P=e,t){v()==null&&v.set(!0);const C=l!=null&&o&&o.animated!=l;if(n||c||C){(c||l!=null)&&(s=null);const u=l??(s==null?void 0:s.animated)??(n&&!e?!1:a);o=K(e,u,t,m),s==null||s.resolve(o.promise),s=null}}else n&&(H(),o=null),(c||e&&(s==null?void 0:s.animated)!==l)&&(s=e&&l!=null?{animated:l,...U()}:null);return(s==null?void 0:s.promise)??(o==null?void 0:o.promise)});let E={};const V=async(e=!f(),t=I())=>{const a={};E=a;try{await R(()=>{try{return D.set(t),f.set(e),B()}finally{D.set(null)}})}finally{E!==a&&await W}},Q=ee(J,se(A),te(B));return{...F({visible$:r,element$:w,elementPresent$:x,transitioning$:y,shown$:L,hidden$:M}),patch:A,directives:{directive:Q},actions:{},api:{show:V.bind(null,!0),hide:V.bind(null,!1),toggle:V}}};export{me as c};
