import{G as d,H as G,aa as X,a9 as N}from"./AppCommon-_nqecaAx.js";import{t as S,a as p,f as Y}from"./writables-6_V4TA8r.js";import{a as R}from"./promise-pIyw9L5e.js";import{n as b}from"./func-tK0QDe5R.js";import{w as Z,b as _,s as F}from"./stores-9lR3-9GO.js";import{e as T,m as ee,d as te,f as oe}from"./directive-wvgaRA5q.js";const U=new Promise(b),se=async($,h)=>{$.style.display=h==="show"?"":"none"},le={animation:!0,animationOnInit:!1,initDone:null,visible:!0,transition:se,onShown:b,onHidden:b,onVisibleChange:b},ne={animation:S,animationOnInit:S,visible:S,transition:p,onShown:p,onHidden:p,onVisibleChange:p,initDone:Y},me=$=>{const[{animation$:h,initDone$:v,visible$:f,transition$:W,onShown$:g,onHidden$:j,onVisibleChange$:k,animationOnInit$:z},A]=Z(le,$,ne),{element$:w,directive:J}=T(),x=d(()=>!!w()),r=_(k,[f],([e])=>e),i=G(null),y=d(()=>!!i()),H=()=>{let e;return i.update(t=>(t==null||t.abort.abort(),e=t==null?void 0:t.context,null)),e},K=(e,t,n,l)=>N(()=>{const m=new AbortController,s=m.signal,a=H()??{},{promise:c,resolve:C}=R(),u={abort:m,animation:t,visible:e,context:a,element:n,transitionFn:l,promise:c};return i.set(u),C((async()=>{var q;try{await l(n,e?"show":"hide",t,s,a)}finally{s.aborted?await U:(i.set(null),(q=(e?g:j)())==null||q())}})()),u}),L=d(()=>!y()&&r()&&x()),M=d(()=>!y()&&!r()),O=d(()=>v()?h():z()),D=G(null);let P,I=f(),o=null;const B=X([r,w,O,D,W,i],([e,t,n,l,m,s])=>{const a=P!==t;P=t;const c=I!==e;if(I=e,t){v()==null&&v.set(!0);const C=l!=null&&s&&s.animation!=l;if(a||c||C){(c||l!=null)&&(o=null);const u=l??(o==null?void 0:o.animation)??(a&&!e?!1:n);s=K(e,u,t,m),o==null||o.resolve(s.promise),o=null}}else a&&(H(),s=null),(c||e&&(o==null?void 0:o.animation)!==l)&&(o=e&&l!=null?{animation:l,...R()}:null);return(o==null?void 0:o.promise)??(s==null?void 0:s.promise)});let E={};const V=async(e=!f(),t=O())=>{const n={};E=n;try{await N(()=>{try{return D.set(t),f.set(e),B()}finally{D.set(null)}})}finally{E!==n&&await U}},Q=ee(J,oe(A),te(B));return{...F({visible$:r,element$:w,elementPresent$:x,transitioning$:y,shown$:L,hidden$:M}),patch:A,directives:{directive:Q},actions:{},api:{show:V.bind(null,!0),hide:V.bind(null,!1),toggle:V}}};export{me as c};
