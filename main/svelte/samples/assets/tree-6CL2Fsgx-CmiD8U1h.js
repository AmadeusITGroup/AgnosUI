import{a3 as v,a0 as n,$ as p}from"./AppCommon-fKgCL6YI.js";import{c as z}from"./navManager-Knf7_nOE.js";import{n as R,m as U,b as V,a as E,d as W}from"./dom-BPD8lUxd-BXl1zwuB.js";import{w as j,s as B,t as G}from"./stores-DBcJ-LkE.js";import{b as f,a as J,t as K}from"./writables-DYGjj5T3-BuJtDJfU.js";import{c as Q}from"./widget-D35XOKjg.js";const X={className:"",nodes:[],onExpandToggle:R,navSelector:i=>i.querySelectorAll("button"),ariaLabelToggleFn:i=>`Toggle ${i}`},Y={className:K,nodes:J,onExpandToggle:f,navSelector:f,ariaLabelToggleFn:f},ne=Q("tree",i=>{const[{nodes$:x,onExpandToggle$:h,navSelector$:w,ariaLabelToggleFn$:T,...D},y]=j(X,i,Y),l=new Map,A={get(e){return e.isExpanded}},o=v({}),I=n(()=>(m(),o(),A)),{elementsInDomOrder$:$,directive:L,refreshElements:N,focusIndex:k,focusPrevious:F,focusNext:S,focusFirst:M,focusLast:P}=z(),_=n(()=>({keys:{ArrowUp:F,ArrowDown:S,Home:M,End:P},selector:w()})),u=(e,t,r)=>{const a={...e,ariaLabel:e.ariaLabel??e.label,level:t,children:[],isExpanded:e.children?.length?e.isExpanded??!1:void 0};return l.set(a,{parent:r}),e.children&&(a.children=e.children.map(s=>u(s,t+1,a))),a},m=n(()=>(l.clear(),x().map(e=>u(e,0,void 0)))),g=v(m().find(e=>e.isExpanded!==void 0)),c=e=>{const t=l.get(e);return t||console.error(`Node ${e.label} doesn't exist in the map`),t},H=V((e,t)=>{let r;const a=()=>{r&&r.htmlElement===e&&(r.htmlElement=void 0),r=void 0},s=q=>{a(),r=c(q.item),r&&(r.htmlElement&&console.warn("The tree item directive should be used once per element"),r.htmlElement=e)};return s(t),{update:s,destroy:a}}),b=e=>{if(e){const t=c(e)?.htmlElement;if(t){const r=$().indexOf(t);k(r,0)}}},O=E(e=>({events:{focus:()=>{const{item:t}=e();g.set(t)},click:()=>{const{item:t}=e();d(t)},keydown:t=>{const{key:r}=t,{item:a}=e(),s=a.isExpanded;switch(N(),r){case"Enter":case" ":d(a);break;case"ArrowLeft":s?d(a):b(c(a)?.parent);break;case"ArrowRight":s?b(a.children?.[0]):d(a);break;default:return}t.preventDefault(),t.stopPropagation()}},attributes:{"aria-label":n(()=>{const{item:t}=e();return T()(t.ariaLabel)}),tabindex:n(()=>{const{item:t}=e();return t===g()?"0":"-1"}),type:p("button")},classNames:{"au-tree-expand-icon":G,"au-tree-expand-icon-expanded":n(()=>{o();const{item:t}=e();return t.isExpanded??!1})}})),d=e=>{c(e)===void 0||e.isExpanded===void 0||(e.isExpanded=!e.isExpanded,o.set({}),h()(e))};return{...B({normalizedNodes$:m,expandedMap$:I,...D}),patch:y,api:{},directives:{navigationDirective:W(L,_),itemToggleDirective:U(H,O),itemAttributesDirective:E(e=>({attributes:{role:p("treeitem"),"aria-selected":p("false"),"aria-expanded":n(()=>{const{item:t}=e();return o(),t.isExpanded?.toString()})}}))}}});export{ne as c};
