import{_ as d,Z as N,ab as M,a7 as R}from"./index-31ef738a.js";import{t as S,a as b,f as Q}from"./writables-5db1063d.js";import{a as U}from"./promise-2d771008.js";import{n as p,e as X,m as Y,d as F,f as T}from"./directive-8b598cc7.js";import{w as ee,b as te,s as oe}from"./stores-4d692201.js";const W=new Promise(p),se=async($,h)=>{$.style.display=h==="show"?"":"none"},le={animation:!0,animationOnInit:!1,initDone:null,visible:!0,transition:se,onShown:p,onHidden:p,onVisibleChange:p},ne={animation:S,animationOnInit:S,visible:S,transition:b,onShown:b,onHidden:b,onVisibleChange:b,initDone:Q},re=$=>{const[{animation$:h,initDone$:v,visible$:f,transition$:Z,onShown$:_,onHidden$:g,onVisibleChange$:j,animationOnInit$:k},A]=ee(le,$,ne),{element$:w,directive:z}=X(),x=d(()=>!!w()),r=te(j,[f],([e])=>e),i=N(null),y=d(()=>!!i()),O=()=>{let e;return i.update(t=>(t==null||t.abort.abort(),e=t==null?void 0:t.context,null)),e},G=(e,t,n,l)=>R(()=>{const u=new AbortController,s=u.signal,a=O()??{},{promise:c,resolve:C}=U(),m={abort:u,animation:t,visible:e,context:a,element:n,transitionFn:l,promise:c};return i.set(m),C((async()=>{var q;try{await l(n,e?"show":"hide",t,s,a)}finally{s.aborted?await W:(i.set(null),(q=(e?_:g)())==null||q())}})()),m}),J=d(()=>!y()&&r()&&x()),K=d(()=>!y()&&!r()),P=d(()=>v()?h():k()),D=N(null);let H,I=f(),o=null;const B=M([r,w,P,D,Z,i],([e,t,n,l,u,s])=>{const a=H!==t;H=t;const c=I!==e;if(I=e,t){v()==null&&v.set(!0);const C=l!=null&&s&&s.animation!=l;if(a||c||C){(c||l!=null)&&(o=null);const m=l??(o==null?void 0:o.animation)??(a&&!e?!1:n);s=G(e,m,t,u),o==null||o.resolve(s.promise),o=null}}else a&&(O(),s=null),(c||e&&(o==null?void 0:o.animation)!==l)&&(o=e&&l!=null?{animation:l,...U()}:null);return(o==null?void 0:o.promise)??(s==null?void 0:s.promise)});let E={};const V=async(e=!f(),t=P())=>{const n={};E=n;try{await R(()=>{try{return D.set(t),f.set(e),B()}finally{D.set(null)}})}finally{E!==n&&await W}},L=Y(z,T(A),F(B));return{...oe({visible$:r,element$:w,elementPresent$:x,transitioning$:y,shown$:J,hidden$:K}),patch:A,directives:{directive:L},actions:{},api:{show:V.bind(null,!0),hide:V.bind(null,!1),toggle:V}}};export{re as c};
