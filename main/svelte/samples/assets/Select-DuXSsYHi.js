import{ab as c,aa as we,ac as le,al as _e,p as Fe,O as se,e as b,Q as ce,b as de,g as ke,c as L,a as Ie,t as V,u as pe,L as ye,h as G,r as ue,q as N,k as w,M as ae}from"./AppCommon-D_B8a5G6.js";import{a as d}from"./actions-B64vG8Da.js";import{t as Se}from"./class-1L5W2JgY.js";import{S as me}from"./Slot-Bt2_y6gy.js";import{c as $e}from"./config-BmaADpVL.js";import{c as Le,o as Ne,a as Te,b as Ae}from"./floatingUI-BbI9geYn.js";import{c as Pe}from"./focustrack-CsH95dnP.js";import{c as Me}from"./navManager-vnOjB-HU.js";import{w as Ee,k as Oe,A as He,y as Be,s as Re,e as We,D as qe,j as oe,g as T,c as J}from"./directive-CKEccryv-BAfxyCuh.js";import{e as ze}from"./extendWidget-CKD28wu-.js";const Ue={id:void 0,ariaLabel:"Select",open:!1,disabled:!1,items:[],filterText:"",loading:!1,selected:[],navSelector:p=>p.querySelectorAll(".au-select-badge,input"),itemIdFn:p=>""+p,onOpenChange:oe,onFilterTextChange:oe,onSelectedChange:oe,allowedPlacements:["bottom-start","top-start","bottom-end","top-end"],className:"",menuClassName:"",menuItemClassName:"",badgeClassName:""};function je(p){const[{id$:_,open$:X,filterText$:Y,items$:O,itemIdFn$:k,onOpenChange$:H,onFilterTextChange$:Z,onSelectedChange$:h,allowedPlacements$:K,navSelector$:n,className$:ee,badgeClassName$:A,ariaLabel$:B,menuClassName$:R,...W},te]=Ee(Ue,p),{selected$:P}=W,I=c(()=>_()??Oe()),x=He(Y,Z),{hasFocus$:q,directive:C}=Pe(),u=Be(H,[X,q],([e,t])=>e&&t),y=c(()=>{const e=new Map,t=k();for(const a of P()){const m=t(a);e.set(m,{item:a,id:t(a),selected:!0})}return e}),z=c(()=>[...y().values()]),f=function(){const e=we(0);return le(e,t=>{const{length:a}=i();t!=null&&(a?t<0?t=a-1:t>=a&&(t=0):t=void 0),e.set(t)})}(),U=c(()=>{const e=new Map;if(u()){const t=y(),a=k();for(const m of O()){const D=a(m);e.set(D,{item:m,id:D,selected:t.has(D)})}}return e}),i=c(()=>u()?[...U().values()]:[]),s=c(()=>{const e=i(),t=f();return e.length&&t!=null?e[t]:void 0}),{directives:{floatingDirective:l,referenceDirective:o},stores:{placement$:g}}=Le({props:{computePositionOptions:le(c(()=>({middleware:[Ne(5),Te({allowedPlacements:K()}),Ae()]})))}}),{directive:v,refreshElements:M,focusFirst:S,focusLast:ie,focusLeft:j,focusRight:$}=Me(),E=c(()=>({keys:{Home:S,End:ie,ArrowLeft:j,ArrowRight:$},selector:n()})),re=(e,t)=>{const a=e.target;M(),r.api.unselect(t),a instanceof HTMLElement&&setTimeout(()=>{j({event:e,referenceElement:a})||$({event:e,referenceElement:a})}),e.preventDefault()},ge=T(()=>({attributes:{role:"combobox","aria-haspopup":"listbox","aria-expanded":c(()=>`${u()}`),"aria-controls":c(()=>`${I()}-menu`)}})),ve=T(e=>({attributes:{tabindex:-1,class:A},classNames:{"au-select-badge":!0},events:{keydown:t=>{let a=!1;switch(t.key){case"Backspace":case"Delete":{re(t,e().item),a=!0;break}}a&&t.preventDefault()}}})),fe=T(()=>({attributes:{role:"listbox",id:c(()=>`${I()}-menu`),"data-popper-placement":g,class:R},events:{mousedown:e=>e.preventDefault()}})),be=T(e=>({attributes:{role:"option","aria-selected":c(()=>`${e().selected}`),style:"cursor: pointer"},classNames:{"au-select-item":!0,selected:c(()=>e().selected)},events:{click:()=>r.api.toggleItem(e().item)}})),he=T(()=>({attributes:{id:I(),type:"text","aria-label":B(),"aria-autocomplete":"list",autocorrect:"off",autocapitalize:"none",autocomplete:"off"},classNames:{"au-select-input":!0},events:{input:e=>{const t=e.target.value;_e(()=>{u.set(t!=null&&t!==""),x.set(t)})},keydown:({ctrlKey:e,key:t,preventDefault:a})=>{let m=!0;switch(t){case"ArrowDown":{u()?e?r.api.highlightLast():r.api.highlightNext():(r.api.open(),r.api.highlightFirst());break}case"ArrowUp":e?r.api.highlightFirst():r.api.highlightPrevious();break;case"Enter":{const D=s();D&&r.api.toggleItem(D.item);break}case"Escape":u.set(!1);break;default:m=!1}m&&a()}}})),xe=T(e=>({events:{click:t=>{re(t,e().item)}}})),r={...Re({id$:I,visibleItems$:i,highlighted$:s,open$:u,selectedContexts$:z,filterText$:x,placement$:g,className$:ee,badgeClassName$:A,ariaLabel$:B,menuClassName$:R,...W}),patch:te,api:{clear(){P.set([])},select(e){r.api.toggleItem(e,!0)},unselect(e){r.api.toggleItem(e,!1)},toggleItem(e,t){const a=k(),m=a(e),Q=y().has(m);t==null&&(t=!Q),!(t&&!U().has(m)||!t&&!Q)&&P.update(F=>{var ne;if(F=[...F],t&&!Q)F.push(e);else if(!t&&Q){const Ce=F.findIndex(De=>a(De)===m);F.splice(Ce,1)}return(ne=h())==null||ne(F),F})},clearText(){},highlight(e){const t=i().findIndex(a=>a.item===e);f.set(t===-1?void 0:t)},highlightFirst(){f.set(0)},highlightPrevious(){f.update(e=>e!=null?e-1:-1)},highlightNext(){f.update(e=>e!=null?e+1:1/0)},highlightLast(){f.set(-1)},open:()=>r.api.toggle(!0),close:()=>r.api.toggle(!1),toggle(e){u.update(t=>e??!t)}},directives:{hasFocusDirective:C,floatingDirective:l,referenceDirective:o,inputContainerDirective:We(qe(v,E),ge),badgeAttributesDirective:ve,menuAttributesDirective:fe,itemAttributesDirective:be,inputDirective:he,badgeCloseButtonDirective:xe}};return r}const Qe={badgeLabel:({itemContext:p})=>p.item,itemLabel:({itemContext:p})=>p.item},Ge=ze(je,Qe,{}),Je=Ge;var Ve=V("<div><!></div>"),Xe=V("<li><!></li>"),Ye=V("<ul></ul>"),Ze=V("<div><div><!> <input></div> <!></div>");function ct(p,_){Fe(_,!0);const X=(i,s)=>{let l=()=>s==null?void 0:s().itemContext;var o=pe();b(()=>ue(o,l().item)),L(i,o)},Y=(i,s)=>{let l=()=>s==null?void 0:s().itemContext;var o=pe();b(()=>ue(o,l().item)),L(i,o)};let O=se(_,"open",15,!1),k=se(_,"filterText",15),H=se(_,"selected",15),Z=ye(_,["$$slots","$$events","$$legacy","open","filterText","selected"]);const h=$e({factory:Je,widgetName:"select",get props(){return{...Z,open:O(),filterText:k(),selected:H()}},enablePatchChanged:!0,defaultConfig:{badgeLabel:X,itemLabel:Y},events:{onOpenChange(i){O(i)},onSelectedChange:i=>{H(i)},onFilterTextChange:i=>{k(i)}}}),K=h.api,{state:n,directives:{floatingDirective:ee,hasFocusDirective:A,referenceDirective:B,inputContainerDirective:R,badgeAttributesDirective:W,menuAttributesDirective:te,itemAttributesDirective:P,inputDirective:I}}=h;var x=Ze();let q;b(()=>q=N(x,q,{}));var C=G(x);let u;b(()=>u=N(C,u,{}));var y=G(C);ce(y,17,()=>n.selectedContexts,i=>i.id,(i,s)=>{var l=Ve();let o;b(()=>o=N(l,o,{}));var g=G(l),v=ae(()=>({state:n,directives:h.directives,api:h.api,itemContext:w(s)}));me(g,{get content(){return n.badgeLabel},get props(){return w(v)}}),d(l,(M,S)=>W(M,S),()=>w(s)),L(i,l)});var z=de(y,2);let f;b(()=>f=N(z,f,{value:n.filterText}));var U=de(C,2);return ke(U,()=>n.open&&n.visibleItems.length>0,i=>{var s=Ye();let l;b(()=>l=N(s,l,{})),ce(s,21,()=>n.visibleItems,o=>o.id,(o,g)=>{var v=Xe();const M=ae(()=>w(g)===n.highlighted);let S;b(()=>S=N(v,S,{}));var ie=G(v),j=ae(()=>({state:n,directives:h.directives,api:h.api,itemContext:w(g)}));me(ie,{get content(){return n.itemLabel},get props(){return w(j)}}),b(()=>Se(v,"text-bg-primary",w(M))),d(v,($,E)=>J($,E),()=>"dropdown-item position-relative"),d(v,($,E)=>P($,E),()=>w(g)),L(o,v)}),d(s,o=>A(o)),d(s,o=>ee(o)),d(s,o=>te(o)),d(s,(o,g)=>J(o,g),()=>"dropdown-menu show"),L(i,s)}),d(z,i=>I(i)),d(C,i=>A(i)),d(C,i=>R(i)),d(C,(i,s)=>J(i,s),()=>"d-flex align-items-center flex-wrap gap-1"),d(x,i=>B(i)),d(x,(i,s)=>J(i,s),()=>"au-select dropdown border border-1 p-1 mb-3 d-block "+n.className),L(p,x),Ie({api:K})}export{ct as S};
