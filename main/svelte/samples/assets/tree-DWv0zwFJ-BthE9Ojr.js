import{a6 as x,a9 as i,W as p}from"./AppCommon-wWEJ6LdR.js";import{c as R}from"./navManager-DsxiAzdu.js";import{q as U,m as V,a as h,b as W,n as j}from"./dom-BB9jLllr-CeqtqeKx.js";import{w as B,s as G,t as J}from"./stores-CJcu1rl_.js";import{b as K,h as Q,a as m}from"./writables-DCiBdIBK-BRdRWZTk.js";const X={className:"",nodes:[],onExpandToggle:j,navSelector:o=>o.querySelectorAll("button"),ariaLabelToggleFn:o=>`Toggle ${o}`},Y={className:K,nodes:Q,onExpandToggle:m,navSelector:m,ariaLabelToggleFn:m};function re(o){const[{nodes$:w,onExpandToggle$:T,navSelector$:D,ariaLabelToggleFn$:y,...A},I]=B(X,o,Y),u=new Map,L={get(e){return e.isExpanded}},c=x({}),N=i(()=>(f(),c(),L)),{elementsInDomOrder$:_,directive:$,refreshElements:k,focusIndex:S,focusPrevious:F,focusNext:M,focusFirst:P,focusLast:q}=R(),H=i(()=>({keys:{ArrowUp:F,ArrowDown:M,Home:P,End:q},selector:D()})),g=(e,t,n)=>{var a;const s={...e,ariaLabel:e.ariaLabel??e.label,level:t,children:[],isExpanded:(a=e.children)!=null&&a.length?e.isExpanded??!1:void 0};return u.set(s,{parent:n}),e.children&&(s.children=e.children.map(r=>g(r,t+1,s))),s},f=i(()=>(u.clear(),w().map(e=>g(e,0,void 0)))),b=x(f().find(e=>e.isExpanded!==void 0)),d=e=>{const t=u.get(e);return t||console.error(`Node ${e.label} doesn't exist in the map`),t},O=W((e,t)=>{let n;const a=()=>{n&&n.htmlElement===e&&(n.htmlElement=void 0),n=void 0},s=r=>{a(),n=d(r.item),n&&(n.htmlElement&&console.warn("The tree item directive should be used once per element"),n.htmlElement=e)};return s(t),{update:s,destroy:a}}),E=e=>{var t;if(e){const n=(t=d(e))==null?void 0:t.htmlElement;if(n){const a=_().indexOf(n);S(a,0)}}},z=h(e=>({events:{focus:()=>{const{item:t}=e();b.set(t)},click:()=>{const{item:t}=e();l(t)},keydown:t=>{var n,a;const{key:s}=t,{item:r}=e(),v=r.isExpanded;switch(k(),s){case"Enter":case" ":l(r);break;case"ArrowLeft":v?l(r):E((n=d(r))==null?void 0:n.parent);break;case"ArrowRight":v?E((a=r.children)==null?void 0:a[0]):l(r);break;default:return}t.preventDefault(),t.stopPropagation()}},attributes:{"aria-label":i(()=>{const{item:t}=e();return y()(t.ariaLabel)}),tabindex:i(()=>{const{item:t}=e();return t===b()?"0":"-1"}),type:p("button")},classNames:{"au-tree-expand-icon":J,"au-tree-expand-icon-expanded":i(()=>{c();const{item:t}=e();return t.isExpanded??!1})}})),l=e=>{d(e)===void 0||e.isExpanded===void 0||(e.isExpanded=!e.isExpanded,c.set({}),T()(e))};return{...G({normalizedNodes$:f,expandedMap$:N,...A}),patch:I,api:{},directives:{navigationDirective:U($,H),itemToggleDirective:V(O,z),itemAttributesDirective:h(e=>({attributes:{role:p("treeitem"),"aria-selected":p("false"),"aria-expanded":i(()=>{var t;const{item:n}=e();return c(),(t=n.isExpanded)==null?void 0:t.toString()})}}))}}}export{re as c};
