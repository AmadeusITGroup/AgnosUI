import{ad as x,$ as i,Z as u}from"./AppCommon-CsXJDRZ3.js";import{c as R}from"./navManager-DXxk70la.js";import{n as U,m as V,a as h,b as W,o as Z}from"./dom-gfxqXJpK-BenLeVwg.js";import{w as j,s as B,t as G}from"./stores-BElQIA3m.js";import{c as f,a as J,t as K}from"./writables-CgpOQ4hA-DwO4tqpW.js";import{c as Q}from"./widget-DeVncyQM.js";const X={className:"",nodes:[],onExpandToggle:U,navSelector:o=>o.querySelectorAll("button"),ariaLabelToggleFn:o=>`Toggle ${o}`},Y={className:K,nodes:J,onExpandToggle:f,navSelector:f,ariaLabelToggleFn:f},ie=Q("tree",o=>{const[{nodes$:w,onExpandToggle$:T,navSelector$:D,ariaLabelToggleFn$:y,...A},I]=j(X,o,Y),m=new Map,$={get(e){return e.isExpanded}},c=x({}),L=i(()=>(p(),c(),$)),{elementsInDomOrder$:N,directive:_,refreshElements:k,focusIndex:F,focusPrevious:S,focusNext:M,focusFirst:P,focusLast:H}=R(),O=i(()=>({keys:{ArrowUp:S,ArrowDown:M,Home:P,End:H},selector:D()})),g=(e,t,r)=>{var a;const s={...e,ariaLabel:e.ariaLabel??e.label,level:t,children:[],isExpanded:(a=e.children)!=null&&a.length?e.isExpanded??!1:void 0};return m.set(s,{parent:r}),e.children&&(s.children=e.children.map(n=>g(n,t+1,s))),s},p=i(()=>(m.clear(),w().map(e=>g(e,0,void 0)))),v=x(p().find(e=>e.isExpanded!==void 0)),l=e=>{const t=m.get(e);return t||console.error(`Node ${e.label} doesn't exist in the map`),t},q=W((e,t)=>{let r;const a=()=>{r&&r.htmlElement===e&&(r.htmlElement=void 0),r=void 0},s=n=>{a(),r=l(n.item),r&&(r.htmlElement&&console.warn("The tree item directive should be used once per element"),r.htmlElement=e)};return s(t),{update:s,destroy:a}}),b=e=>{var t;if(e){const r=(t=l(e))==null?void 0:t.htmlElement;if(r){const a=N().indexOf(r);F(a,0)}}},z=h(e=>({events:{focus:()=>{const{item:t}=e();v.set(t)},click:()=>{const{item:t}=e();d(t)},keydown:t=>{var r,a;const{key:s}=t,{item:n}=e(),E=n.isExpanded;switch(k(),s){case"Enter":case" ":d(n);break;case"ArrowLeft":E?d(n):b((r=l(n))==null?void 0:r.parent);break;case"ArrowRight":E?b((a=n.children)==null?void 0:a[0]):d(n);break;default:return}t.preventDefault(),t.stopPropagation()}},attributes:{"aria-label":i(()=>{const{item:t}=e();return y()(t.ariaLabel)}),tabindex:i(()=>{const{item:t}=e();return t===v()?"0":"-1"}),type:u("button")},classNames:{"au-tree-expand-icon":G,"au-tree-expand-icon-expanded":i(()=>{c();const{item:t}=e();return t.isExpanded??!1})}})),d=e=>{l(e)===void 0||e.isExpanded===void 0||(e.isExpanded=!e.isExpanded,c.set({}),T()(e))};return{...B({normalizedNodes$:p,expandedMap$:L,...A}),patch:I,api:{},directives:{navigationDirective:Z(_,O),itemToggleDirective:V(q,z),itemAttributesDirective:h(e=>({attributes:{role:u("treeitem"),"aria-selected":u("false"),"aria-expanded":i(()=>{var t;const{item:r}=e();return c(),(t=r.isExpanded)==null?void 0:t.toString()})}}))}}});export{ie as c};
