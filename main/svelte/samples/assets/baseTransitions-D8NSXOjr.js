import{U as d,ab as E,af as Q,aa as q}from"./AppCommon-3JlOw5zm.js";import{d as X,c as v,b as A}from"./writables-CgpOQ4hA-Dt7UDoZQ.js";import{p as N}from"./promise-XSP94FjG-B3ruy3bf.js";import{l as Y,m as Z,e as F,n as m}from"./dom-gfxqXJpK--xUfBliB.js";import{w as T,d as nn,s as en}from"./stores-BI7cszP8.js";const R=new Promise(m),tn=(b,$)=>{b.style.display=$==="show"?"":"none"},on={animated:!0,animatedOnInit:!1,initDone:null,visible:!0,transition:tn,onShown:m,onHidden:m,onVisibleChange:m},sn={animated:A,animatedOnInit:A,visible:A,transition:v,onShown:v,onHidden:v,onVisibleChange:v,initDone:X},un=b=>{const[{animated$:$,initDone$:h,visible$:c,transition$:U,onShown$:W,onHidden$:_,onVisibleChange$:j,animatedOnInit$:k},z]=T(on,b,sn),{element$:w,directive:G}=Y(),y=d(()=>!!w()),u=nn(j,[c],([n])=>n),a=E(null),x=()=>{let n;return a.update(e=>(e==null||e.abort.abort(),n=e==null?void 0:e.context,null)),n},J=(n,e,s,i)=>q(()=>{const p=new AbortController,o=p.signal,l=x()??{},{promise:r,resolve:S}=N(),f={abort:p,animated:e,visible:n,context:l,element:s,transitionFn:i,promise:r};return a.set(f),S((async()=>{var B;try{await i(s,n?"show":"hide",e,o,l)}finally{o.aborted?await R:(a.set(null),(B=(n?W:_)())==null||B())}})()),f}),O=d(()=>h()?$():k()),g=E(null);let P,H=c(),t=null;const D=Q([u,w,O,g,U,a],([n,e,s,i,p,o])=>{const l=P!==e;P=e;const r=H!==n;if(H=n,e){h()==null&&h.set(!0);const S=i!=null&&o&&o.animated!=i;if(l||r||S){(r||i!=null)&&(t=null);const f=i??(t==null?void 0:t.animated)??(l&&!n?!1:s);o=J(n,f,e,p),t==null||t.resolve(o.promise),t=null}}else l&&(x(),o=null),(r||n&&(t==null?void 0:t.animated)!==i)&&(t=n&&i!=null?{animated:i,...N()}:null);return(t==null?void 0:t.promise)??(o==null?void 0:o.promise)});let I={};const V=async(n=!c(),e=O())=>{const s={};I=s;try{await q(()=>{try{return g.set(e),c.set(n),D()}finally{g.set(null)}})}finally{I!==s&&await R}},C=d(()=>(y()&&D(),!!a())),K=d(()=>!C()&&u()&&y()),L=d(()=>!C()&&!u()),M=Z(G,F(D));return{...en({visible$:u,element$:w,elementPresent$:y,transitioning$:C,shown$:K,hidden$:L}),patch:z,directives:{directive:M},api:{show:V.bind(null,!0),hide:V.bind(null,!1),toggle:V}}};export{un as c};
