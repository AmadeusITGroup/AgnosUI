import{aa as y,ab as g,ac as W,n as v,P as b,a8 as P,ad as w,ae as j,k as O,a0 as k,af as x,ag as F,ah as S,K as p,J as $}from"./AppCommon-D_B8a5G6.js";import{i as C,t as q,f as E}from"./directive-CKEccryv-BAfxyCuh.js";const h=(t,n,e=1/0)=>{if(n!==void 0)if(typeof n=="object"&&n&&e>=1){t||(t={});for(const r of Object.keys(n))Object.prototype.hasOwnProperty.call(n,r)&&(r==="__proto__"||r==="constructor"||(t[r]=h(t[r],n[r],e-1)))}else return n;return t},R=(t,n=C)=>{const e=y({}),r=n===C?t:g(()=>n(h({},t==null?void 0:t(),2)));return W(g(()=>h(h({},r==null?void 0:r(),2),e(),2)),{...e,own$:e,adaptedParent$:r,parent$:t})};function z(t){v(t,t.v+1)}const l=[];function M(t,n=b){let e=null;const r=new Set;function s(a){if(P(t,a)&&(t=a,e)){const u=!l.length;for(const o of r)o[1](),l.push(o,t);if(u){for(let o=0;o<l.length;o+=2)l[o][0](l[o+1]);l.length=0}}}function c(a){s(a(t))}function i(a,u=b){const o=[a,u];return r.add(o),r.size===1&&(e=n(s,c)||b),a(t),()=>{r.delete(o),r.size===0&&e&&(e(),e=null)}}return{set:s,update:c,subscribe:i}}function I(t){let n;return w(t,e=>n=e)(),n}function N(t){let n,e=F(0),r=0,s=b;function c(){return j()?(O(e),k(()=>{if(r===0){let i=!1;s=t.subscribe(a=>{n=a,i&&z(e)}),i=!0}return r+=1,()=>{r-=1,x().then(()=>{r===0&&s()})}}),n):I(t)}return"set"in t?{get current(){return c()},set current(i){t.set(i)}}:{get current(){return c()}}}function J(t,n){return e=>{const r=E(t,e);t=e,r&&n(r)}}const A=(t,n)=>n?(...e)=>{t(...e),n(...e)}:t,B=(t,n)=>{const e=y(n,{equal:Object.is});return W(g(()=>A(t,e())),{set:e.set,update:e.update})},D=t=>{const{factory:n,defaultConfig:e,widgetConfig:r,events:s,enablePatchChanged:c}=t,i=t.props??{},a=q(e),u={...i};if(s)for(const f of Object.keys(s))u[f]=B(s[f],i[f]);const o=n({config:g(()=>({...a(),...r==null?void 0:r()})),props:u}),_=Object.fromEntries(Object.entries(o.stores).map(([f,d])=>[f.slice(0,-1),N(d)]));if(c){const f=J(i,o.patch);S(()=>{f(t.props)})}return{api:o.api,directives:o.directives,state:new Proxy(_,{get(f,d,m){if(Reflect.has(f,d))return Reflect.get(f,d,m).current}})}},G=(t=Symbol("widgetsConfig"))=>{const n=s=>{const c=p(t),i=R(c,s);return $(t,i),i},e=s=>{const c=p(t);return g(()=>c==null?void 0:c()[s])};return{widgetsDefaultConfigKey:t,createWidgetsDefaultConfig:n,getContextWidgetConfig:e,callWidgetFactory:s=>D({factory:s.factory,defaultConfig:s.defaultConfig,widgetConfig:s.widgetName?e(s.widgetName):null,events:s.events,get props(){return s.props},enablePatchChanged:s.enablePatchChanged})}},{widgetsDefaultConfigKey:Q,createWidgetsDefaultConfig:T,getContextWidgetConfig:U,callWidgetFactory:V}=G();export{G as a,V as c,M as w};
