import{a8 as m,ae as Ce,aa as ue,ad as Ie,p as ke,M as ce,P as me,c as ye,d as R,b as W,a as Fe,r as ve,t as oe,L as Se,s as ge,g as d,n as he,k as se,q as x,l as B}from"./AppCommon-Cg6aVWiJ.js";import{a as g}from"./actions-DDgANA-V.js";import{t as $e}from"./class-Cc01UWtI.js";import{S as fe}from"./Slot-BDFzo0gx.js";import{c as Le}from"./config-o26kMnp0.js";import{c as Ne,o as Te,a as Pe,b as Me}from"./floatingUI-DZo6b3yF.js";import{c as De}from"./focustrack-B7Xtpx-h.js";import{c as Ae}from"./navManager-DB-voFcL.js";import{w as Ee,j as Oe,y as Be,x as He,s as Re,m as We,B as qe,h as de,a as H,c as ie}from"./directive-CKEccryv-MJlbWsK7.js";import{e as ze}from"./extendWidget-CGJbintg.js";const Ue={id:void 0,ariaLabel:"Select",open:!1,disabled:!1,items:[],filterText:"",loading:!1,selected:[],navSelector:n=>n.querySelectorAll(".au-select-badge,input"),itemIdFn:n=>""+n,onOpenChange:de,onFilterTextChange:de,onSelectedChange:de,allowedPlacements:["bottom-start","top-start","bottom-end","top-end"],className:"",menuClassName:"",menuItemClassName:"",badgeClassName:""};function je(n){const[{id$:r,open$:w,filterText$:h,items$:X,itemIdFn$:q,onOpenChange$:C,onFilterTextChange$:ne,onSelectedChange$:p,allowedPlacements$:z,navSelector$:I,className$:U,badgeClassName$:$,ariaLabel$:L,menuClassName$:N,...T},j]=Ee(Ue,n),{selected$:b}=T,P=m(()=>r()??Oe()),G=Be(h,ne),{hasFocus$:k,directive:re}=De(),f=He(C,[w,k],([e,t])=>e&&t),M=m(()=>{const e=new Map,t=q();for(const s of b()){const v=t(s);e.set(v,{item:s,id:t(s),selected:!0})}return e}),Y=m(()=>[...M().values()]),y=function(){const e=Ce(0);return ue(e,t=>{const{length:s}=D();t!=null&&(s?t<0?t=s-1:t>=s&&(t=0):t=void 0),e.set(t)})}(),J=m(()=>{const e=new Map;if(f()){const t=M(),s=q();for(const v of X()){const F=s(v);e.set(F,{item:v,id:F,selected:t.has(F)})}}return e}),D=m(()=>f()?[...J().values()]:[]),Z=m(()=>{const e=D(),t=y();return e.length&&t!=null?e[t]:void 0}),{directives:{floatingDirective:a,referenceDirective:i},stores:{placement$:l}}=Ne({props:{computePositionOptions:ue(m(()=>({middleware:[Te(5),Pe({allowedPlacements:z()}),Me()]})))}}),{directive:A,refreshElements:o,focusFirst:_,focusLast:u,focusLeft:E,focusRight:O}=Ae(),K=m(()=>({keys:{Home:_,End:u,ArrowLeft:E,ArrowRight:O},selector:I()})),ee=(e,t)=>{const s=e.target;o(),c.api.unselect(t),s instanceof HTMLElement&&setTimeout(()=>{E({event:e,referenceElement:s})||O({event:e,referenceElement:s})}),e.preventDefault()},le=H(()=>({attributes:{role:"combobox","aria-haspopup":"listbox","aria-expanded":m(()=>`${f()}`),"aria-controls":m(()=>`${P()}-menu`)}})),Q=H(e=>({attributes:{tabindex:-1,class:$},classNames:{"au-select-badge":!0},events:{keydown:t=>{let s=!1;switch(t.key){case"Backspace":case"Delete":{ee(t,e().item),s=!0;break}}s&&t.preventDefault()}}})),V=H(()=>({attributes:{role:"listbox",id:m(()=>`${P()}-menu`),"data-popper-placement":l,class:N},events:{mousedown:e=>e.preventDefault()}})),te=H(e=>({attributes:{role:"option","aria-selected":m(()=>`${e().selected}`),style:"cursor: pointer"},classNames:{"au-select-item":!0,selected:m(()=>e().selected)},events:{click:()=>c.api.toggleItem(e().item)}})),be=H(()=>({attributes:{id:P(),type:"text","aria-label":L(),"aria-autocomplete":"list",autocorrect:"off",autocapitalize:"none",autocomplete:"off"},classNames:{"au-select-input":!0},events:{input:e=>{const t=e.target.value;Ie(()=>{f.set(t!=null&&t!==""),G.set(t)})},keydown:({ctrlKey:e,key:t,preventDefault:s})=>{let v=!0;switch(t){case"ArrowDown":{f()?e?c.api.highlightLast():c.api.highlightNext():(c.api.open(),c.api.highlightFirst());break}case"ArrowUp":e?c.api.highlightFirst():c.api.highlightPrevious();break;case"Enter":{const F=Z();F&&c.api.toggleItem(F.item);break}case"Escape":f.set(!1);break;default:v=!1}v&&s()}}})),_e=H(e=>({events:{click:t=>{ee(t,e().item)}}})),c={...Re({id$:P,visibleItems$:D,highlighted$:Z,open$:f,selectedContexts$:Y,filterText$:G,placement$:l,className$:U,badgeClassName$:$,ariaLabel$:L,menuClassName$:N,...T}),patch:j,api:{clear(){b.set([])},select(e){c.api.toggleItem(e,!0)},unselect(e){c.api.toggleItem(e,!1)},toggleItem(e,t){const s=q(),v=s(e),ae=M().has(v);t==null&&(t=!ae),!(t&&!J().has(v)||!t&&!ae)&&b.update(S=>{var pe;if(S=[...S],t&&!ae)S.push(e);else if(!t&&ae){const xe=S.findIndex(we=>s(we)===v);S.splice(xe,1)}return(pe=p())==null||pe(S),S})},clearText(){},highlight(e){const t=D().findIndex(s=>s.item===e);y.set(t===-1?void 0:t)},highlightFirst(){y.set(0)},highlightPrevious(){y.update(e=>e!=null?e-1:-1)},highlightNext(){y.update(e=>e!=null?e+1:1/0)},highlightLast(){y.set(-1)},open:()=>c.api.toggle(!0),close:()=>c.api.toggle(!1),toggle(e){f.update(t=>e??!t)}},directives:{hasFocusDirective:re,floatingDirective:a,referenceDirective:i,inputContainerDirective:We(qe(A,K),le),badgeAttributesDirective:Q,menuAttributesDirective:V,itemAttributesDirective:te,inputDirective:be,badgeCloseButtonDirective:_e}};return c}const Ge={badgeLabel:({itemContext:n})=>n.item,itemLabel:({itemContext:n})=>n.item},Je=ze(je,Ge),Qe=Je,Ve=(n,r)=>{let w=()=>r==null?void 0:r().itemContext;var h=ve();R(()=>he(h,w().item)),W(n,h)},Xe=(n,r)=>{let w=()=>r==null?void 0:r().itemContext;var h=ve();R(()=>he(h,w().item)),W(n,h)};var Ye=oe("<div><!></div>"),Ze=oe("<li><!></li>"),Ke=oe("<ul></ul>"),et=oe("<div><div><!> <input></div> <!></div>");function pt(n,r){ke(r,!0);let w=ce(r,"open",15,!1),h=ce(r,"filterText",15),X=ce(r,"selected",15),q=Se(r,["$$slots","$$events","$$legacy","open","filterText","selected"]);const C=Le({factory:Qe,widgetName:"select",get props(){return{...q,open:w(),filterText:h(),selected:X()}},enablePatchChanged:!0,defaultConfig:{badgeLabel:Ve,itemLabel:Xe},events:{onOpenChange(a){w(a)},onSelectedChange:a=>{X(a)},onFilterTextChange:a=>{h(a)}}}),ne=C.api,{state:p,directives:{floatingDirective:z,hasFocusDirective:I,referenceDirective:U,inputContainerDirective:$,badgeAttributesDirective:L,menuAttributesDirective:N,itemAttributesDirective:T,inputDirective:j}}=C;var b=et();const P=x(()=>({}));let G;var k=se(b);const re=x(()=>({}));let f;var M=se(k);me(M,17,()=>p.selectedContexts,a=>a.id,(a,i)=>{var l=Ye();const A=x(()=>({}));let o;var _=se(l),u=x(()=>({state:p,directives:C.directives,api:C.api,itemContext:d(i)}));fe(_,{get content(){return p.badgeLabel},get props(){return d(u)}}),g(l,(E,O)=>L==null?void 0:L(E,O),()=>d(i)),R(()=>o=B(l,o,{...d(A)})),W(a,l)});var Y=ge(M,2);const y=x(()=>({}));let J;g(Y,a=>j==null?void 0:j(a)),g(k,a=>I==null?void 0:I(a)),g(k,a=>$==null?void 0:$(a)),g(k,(a,i)=>{var l;return(l=ie)==null?void 0:l(a,i)},()=>"d-flex align-items-center flex-wrap gap-1");var D=ge(k,2);{var Z=a=>{var i=Ke();const l=x(()=>({}));let A;me(i,21,()=>p.visibleItems,o=>o.id,(o,_)=>{var u=Ze();const E=x(()=>d(_)===p.highlighted),O=x(()=>({}));let K;var ee=se(u),le=x(()=>({state:p,directives:C.directives,api:C.api,itemContext:d(_)}));fe(ee,{get content(){return p.itemLabel},get props(){return d(le)}}),g(u,(Q,V)=>{var te;return(te=ie)==null?void 0:te(Q,V)},()=>"dropdown-item position-relative"),g(u,(Q,V)=>T==null?void 0:T(Q,V),()=>d(_)),R(()=>{K=B(u,K,{...d(O)}),$e(u,"text-bg-primary",d(E))}),W(o,u)}),g(i,o=>I==null?void 0:I(o)),g(i,o=>z==null?void 0:z(o)),g(i,o=>N==null?void 0:N(o)),g(i,(o,_)=>{var u;return(u=ie)==null?void 0:u(o,_)},()=>"dropdown-menu show"),R(()=>A=B(i,A,{...d(l)})),W(a,i)};ye(D,a=>{p.open&&p.visibleItems.length>0&&a(Z)})}return g(b,a=>U==null?void 0:U(a)),g(b,(a,i)=>{var l;return(l=ie)==null?void 0:l(a,i)},()=>"au-select dropdown border border-1 p-1 mb-3 d-block "+p.className),R(()=>{G=B(b,G,{...d(P)}),f=B(k,f,{...d(re)}),J=B(Y,J,{value:p.filterText,...d(y)})}),W(n,b),Fe({api:ne})}export{pt as S};
