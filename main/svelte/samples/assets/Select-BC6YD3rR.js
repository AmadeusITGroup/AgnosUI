import{$ as u,ad as $e,a0 as de,Z as v,ae as ke,p as Fe,O as ie,K as ye,t as Y,Q as pe,d as V,b as ue,e as Se,h as B,j as H,c as R,a as Le,q as ge,k as fe,L as oe,g as y}from"./AppCommon-CsXJDRZ3.js";import{a as m}from"./actions-kl0KjzIn.js";import{S as me}from"./Slot-BZUO5b9L.js";import{c as Te}from"./config-DPIUpkcO.js";import{c as Ne,o as Pe,a as De,b as Me}from"./floatingUI-BjOnL2vv.js";import{c as Ae}from"./focustrack-UpNoKNdY.js";import{c as Ee}from"./navManager-DXxk70la.js";import{n as ne,g as Oe,m as He,a as W,o as We,c as X}from"./dom-gfxqXJpK-BenLeVwg.js";import{w as Be,e as Re,d as qe,s as ze,t as re}from"./stores-BElQIA3m.js";import{c as Ue}from"./widget-DeVncyQM.js";import{e as je}from"./extendWidget-Dym7HUbM.js";const Qe={id:void 0,ariaLabel:"Select",open:!1,disabled:!1,items:[],filterText:"",loading:!1,selected:[],navSelector:r=>r.querySelectorAll(".au-select-badge,input"),itemIdFn:r=>""+r,onOpenChange:ne,onFilterTextChange:ne,onSelectedChange:ne,allowedPlacements:["bottom-start","top-start","bottom-end","top-end"],className:"",menuClassName:"",menuItemClassName:"",badgeClassName:""},Ze=Ue("select",r=>{const[{id$:l,open$:w,filterText$:b,items$:Q,itemIdFn$:q,onOpenChange$:_,onFilterTextChange$:ee,onSelectedChange$:d,allowedPlacements$:z,navSelector$:I,className$:U,badgeClassName$:N,ariaLabel$:P,menuClassName$:D,...M},j]=Be(Qe,r),{selected$:h}=M,S=u(()=>l()??Oe()),x=Re(b,ee),{hasFocus$:Z,directive:G}=Ae(),g=qe(_,[w,Z],([e,t])=>e&&t),A=u(()=>{const e=new Map,t=q();for(const a of h()){const f=t(a);e.set(f,{item:a,id:t(a),selected:!0})}return e}),te=u(()=>[...A().values()]),$=function(){const e=$e(0);return de(e,t=>{const{length:a}=i();t!=null&&(a?t<0?t=a-1:t>=a&&(t=0):t=void 0),e.set(t)})}(),s=u(()=>{const e=new Map;if(g()){const t=A(),a=q();for(const f of Q()){const F=a(f);e.set(F,{item:f,id:F,selected:t.has(F)})}}return e}),i=u(()=>g()?[...s().values()]:[]),o=u(()=>{const e=i(),t=$();return e.length&&t!=null?e[t]:void 0}),{directives:{floatingDirective:n,referenceDirective:C},stores:{placement$:p}}=Ne({props:{computePositionOptions:de(u(()=>({middleware:[Pe(5),De({allowedPlacements:z()}),Me()]})))}}),{directive:L,refreshElements:E,focusFirst:se,focusLast:ae,focusLeft:k,focusRight:O}=Ee(),J=u(()=>({keys:{Home:se,End:ae,ArrowLeft:k,ArrowRight:O},selector:I()})),le=(e,t)=>{const a=e.target;E(),c.api.unselect(t),a instanceof HTMLElement&&setTimeout(()=>{k({event:e,referenceElement:a})||O({event:e,referenceElement:a})}),e.preventDefault()},ve=W(()=>({attributes:{role:v("combobox"),"aria-haspopup":v("listbox"),"aria-expanded":u(()=>`${g()}`),"aria-controls":u(()=>`${S()}-menu`)}})),be=W(e=>({attributes:{tabindex:v(-1),class:N},classNames:{"au-select-badge":re},events:{keydown:t=>{let a=!1;switch(t.key){case"Backspace":case"Delete":{le(t,e().item),a=!0;break}}a&&t.preventDefault()}}})),he=W(()=>({attributes:{role:v("listbox"),id:u(()=>`${S()}-menu`),"data-popper-placement":p,class:D},events:{mousedown:e=>e.preventDefault()}})),xe=W(e=>({attributes:{role:v("option"),"aria-selected":u(()=>`${e().selected}`),style:v("cursor: pointer")},classNames:{"au-select-item":re,selected:u(()=>e().selected)},events:{click:()=>c.api.toggleItem(e().item)}})),Ce=W(()=>({attributes:{id:S,type:v("text"),"aria-label":P,"aria-autocomplete":v("list"),autocorrect:v("off"),autocapitalize:v("none"),autocomplete:v("off")},classNames:{"au-select-input":re},events:{input:e=>{const t=e.target.value;ke(()=>{g.set(t!=null&&t!==""),x.set(t)})},keydown:({ctrlKey:e,key:t,preventDefault:a})=>{let f=!0;switch(t){case"ArrowDown":{g()?e?c.api.highlightLast():c.api.highlightNext():(c.api.open(),c.api.highlightFirst());break}case"ArrowUp":e?c.api.highlightFirst():c.api.highlightPrevious();break;case"Enter":{const F=o();F&&c.api.toggleItem(F.item);break}case"Escape":g.set(!1);break;default:f=!1}f&&a()}}})),we=W(e=>({events:{click:t=>{le(t,e().item)}}})),c={...ze({id$:S,visibleItems$:i,highlighted$:o,open$:g,selectedContexts$:te,filterText$:x,placement$:p,className$:U,badgeClassName$:N,ariaLabel$:P,menuClassName$:D,...M}),patch:j,api:{clear(){h.set([])},select(e){c.api.toggleItem(e,!0)},unselect(e){c.api.toggleItem(e,!1)},toggleItem(e,t){const a=q(),f=a(e),K=A().has(f);t==null&&(t=!K),!(t&&!s().has(f)||!t&&!K)&&h.update(T=>{var ce;if(T=[...T],t&&!K)T.push(e);else if(!t&&K){const _e=T.findIndex(Ie=>a(Ie)===f);T.splice(_e,1)}return(ce=d())==null||ce(T),T})},clearText(){},highlight(e){const t=i().findIndex(a=>a.item===e);$.set(t===-1?void 0:t)},highlightFirst(){$.set(0)},highlightPrevious(){$.update(e=>e!=null?e-1:-1)},highlightNext(){$.update(e=>e!=null?e+1:1/0)},highlightLast(){$.set(-1)},open:()=>c.api.toggle(!0),close:()=>c.api.toggle(!1),toggle(e){g.update(t=>e??!t)}},directives:{hasFocusDirective:G,floatingDirective:n,referenceDirective:C,inputContainerDirective:He(We(L,J),ve),badgeAttributesDirective:be,menuAttributesDirective:he,itemAttributesDirective:xe,inputDirective:Ce,badgeCloseButtonDirective:we}};return c}),Ge={badgeLabel:({itemContext:r})=>r.item,itemLabel:({itemContext:r})=>r.item},Je=je(Ze,Ge),Ke=Je,Ve=(r,l)=>{let w=()=>l==null?void 0:l().itemContext;var b=ge();B(()=>fe(b,w().item)),R(r,b)},Xe=(r,l)=>{let w=()=>l==null?void 0:l().itemContext;var b=ge();B(()=>fe(b,w().item)),R(r,b)};var Ye=Y("<div><!></div>"),et=Y("<li><!></li>"),tt=Y("<ul></ul>"),st=Y("<div><div><!> <input></div> <!></div>");function gt(r,l){Fe(l,!0);let w=ie(l,"open",15,!1),b=ie(l,"filterText",15),Q=ie(l,"selected",15),q=ye(l,["$$slots","$$events","$$legacy","open","filterText","selected"]);const _=Te(Ke,{get props(){return{...q,open:w(),filterText:b(),selected:Q()}},defaultConfig:{badgeLabel:Ve,itemLabel:Xe},events:{onOpenChange(s){w(s)},onSelectedChange:s=>{Q(s)},onFilterTextChange:s=>{b(s)}}}),ee=_.api,{state:d,directives:{floatingDirective:z,hasFocusDirective:I,referenceDirective:U,inputContainerDirective:N,badgeAttributesDirective:P,menuAttributesDirective:D,itemAttributesDirective:M,inputDirective:j}}=_;var h=st();let S;var x=V(h);let Z;var G=V(x);pe(G,17,()=>d.selectedContexts,s=>s.id,(s,i)=>{var o=Ye();let n;var C=V(o);const p=oe(()=>({state:d,directives:_.directives,api:_.api,itemContext:y(i)}));me(C,{get content(){return d.badgeLabel},get props(){return y(p)}}),m(o,(L,E)=>P==null?void 0:P(L,E),()=>y(i)),B(L=>n=H(o,n,{...L}),[()=>({})]),R(s,o)});var g=ue(G,2);let A;m(g,s=>j==null?void 0:j(s)),m(x,s=>I==null?void 0:I(s)),m(x,s=>N==null?void 0:N(s)),m(x,(s,i)=>{var o;return(o=X)==null?void 0:o(s,i)},()=>"d-flex align-items-center flex-wrap gap-1");var te=ue(x,2);{var $=s=>{var i=tt();let o;pe(i,21,()=>d.visibleItems,n=>n.id,(n,C)=>{var p=et();const L=oe(()=>y(C)===d.highlighted);let E;var se=V(p);const ae=oe(()=>({state:d,directives:_.directives,api:_.api,itemContext:y(C)}));me(se,{get content(){return d.itemLabel},get props(){return y(ae)}}),m(p,(k,O)=>{var J;return(J=X)==null?void 0:J(k,O)},()=>["dropdown-item position-relative",{"text-bg-primary":y(L)}]),m(p,(k,O)=>M==null?void 0:M(k,O),()=>y(C)),B(k=>E=H(p,E,{...k}),[()=>({})]),R(n,p)}),m(i,n=>I==null?void 0:I(n)),m(i,n=>z==null?void 0:z(n)),m(i,n=>D==null?void 0:D(n)),m(i,(n,C)=>{var p;return(p=X)==null?void 0:p(n,C)},()=>"dropdown-menu show"),B(n=>o=H(i,o,{...n}),[()=>({})]),R(s,i)};Se(te,s=>{d.open&&d.visibleItems.length>0&&s($)})}return m(h,s=>U==null?void 0:U(s)),m(h,(s,i)=>{var o;return(o=X)==null?void 0:o(s,i)},()=>"au-select dropdown border border-1 p-1 mb-3 d-block "+d.className),B((s,i,o)=>{S=H(h,S,{...s}),Z=H(x,Z,{...i}),A=H(g,A,{value:d.filterText,...o})},[()=>({}),()=>({}),()=>({})]),R(r,h),Le({api:ee})}export{gt as S};
