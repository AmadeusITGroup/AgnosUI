import{Z as u,a0 as N,_ as M,aa as R}from"./index-4cf2a498.js";import{t as S,b as h,f as Q}from"./writables-51f383fe.js";import{w as X,b as Y,s as F}from"./stores-af83239d.js";import{c as T,m as ee,d as te,f as oe}from"./directiveUtils-574f6e37.js";const v=()=>{},U=new Promise(v),se=async(i,f)=>{i.style.display=f==="show"?"":"none"},ne={animation:!0,animationOnInit:!1,initDone:null,visible:!0,transition:se,onShown:v,onHidden:v,onVisibleChange:v},le={animation:S,animationOnInit:S,visible:S,transition:h,onShown:h,onHidden:h,onVisibleChange:h,initDone:Q},W=()=>{let i;return{promise:new Promise(c=>{i=c}),resolve:i}},de=i=>{const[{animation$:f,initDone$:c,visible$:m,transition$:Z,onShown$:_,onHidden$:g,onVisibleChange$:j,animationOnInit$:k},A]=X(ne,i,le),{element$:w,directive:z}=T(),P=u(()=>!!w()),b=Y(j,[m],([e])=>e),r=N(null),y=u(()=>!!r()),x=()=>{let e;return r.update(t=>(t==null||t.abort.abort(),e=t==null?void 0:t.context,null)),e},G=(e,t,l,n)=>R(()=>{const p=new AbortController,s=p.signal,a=x()??{},{promise:d,resolve:C}=W(),$={abort:p,animation:t,visible:e,context:a,element:l,transitionFn:n,promise:d};return r.set($),C((async()=>{var q;try{await n(l,e?"show":"hide",t,s,a)}finally{s.aborted?await U:(r.set(null),(q=(e?_:g)())==null||q())}})()),$}),J=u(()=>!y()&&b()&&P()),K=u(()=>!y()&&!b()),O=u(()=>c()?f():k()),D=N(null);let H,I=m(),o=null;const B=M([b,w,O,D,Z,r],([e,t,l,n,p,s])=>{const a=H!==t;H=t;const d=I!==e;if(I=e,t){c()==null&&c.set(!0);const C=n!=null&&s&&s.animation!=n;if(a||d||C){(d||n!=null)&&(o=null);const $=n??(o==null?void 0:o.animation)??(a&&!e?!1:l);s=G(e,$,t,p),o==null||o.resolve(s.promise),o=null}}else a&&(x(),s=null),(d||e&&(o==null?void 0:o.animation)!==n)&&(o=e&&n!=null?{animation:n,...W()}:null);return(o==null?void 0:o.promise)??(s==null?void 0:s.promise)});let E={};const V=async(e=!m(),t=O())=>{const l={};E=l;try{await R(()=>{try{return D.set(t),m.set(e),B()}finally{D.set(null)}})}finally{E!==l&&await U}},L=ee(z,oe(A),te(B));return{...F({visible$:b,element$:w,elementPresent$:P,transitioning$:y,shown$:J,hidden$:K}),patch:A,directives:{directive:L},actions:{},api:{show:V.bind(null,!0),hide:V.bind(null,!1),toggle:V}}};export{de as c};
