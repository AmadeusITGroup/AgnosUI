import{G as d,H as q,ac as Q,ab as G}from"./AppCommon--XJnjPQd.js";import{t as V,a as f,d as X}from"./writables-DoU_XYTX-CrRf2Xvc.js";import{a as N}from"./promise-CY2U8bTP-CJdx88sI.js";import{e as m,w as Y,A as Z,B as F,s as T,a as ee,d as ne,C as te}from"./directive-DCYlDznf-Cmj9bg2S.js";const R=new Promise(m),ie=async(b,$)=>{b.style.display=$==="show"?"":"none"},se={animated:!0,animatedOnInit:!1,initDone:null,visible:!0,transition:ie,onShown:m,onHidden:m,onVisibleChange:m},oe={animated:V,animatedOnInit:V,visible:V,transition:f,onShown:f,onHidden:f,onVisibleChange:f,initDone:X},ce=b=>{const[{animated$:$,initDone$:h,visible$:c,transition$:U,onShown$:W,onHidden$:_,onVisibleChange$:j,animatedOnInit$:k},A]=Y(se,b,oe),{element$:w,directive:z}=Z(),S=d(()=>!!w()),u=F(j,[c],([e])=>e),a=q(null),y=d(()=>!!a()),x=()=>{let e;return a.update(n=>(n==null||n.abort.abort(),e=n==null?void 0:n.context,null)),e},J=(e,n,o,i)=>G(()=>{const p=new AbortController,s=p.signal,l=x()??{},{promise:r,resolve:D}=N(),v={abort:p,animated:n,visible:e,context:l,element:o,transitionFn:i,promise:r};return a.set(v),D((async()=>{var E;try{await i(o,e?"show":"hide",n,s,l)}finally{s.aborted?await R:(a.set(null),(E=(e?W:_)())==null||E())}})()),v}),K=d(()=>!y()&&u()&&S()),L=d(()=>!y()&&!u()),H=d(()=>h()?$():k()),g=q(null);let O,P=c(),t=null;const B=Q([u,w,H,g,U,a],([e,n,o,i,p,s])=>{const l=O!==n;O=n;const r=P!==e;if(P=e,n){h()==null&&h.set(!0);const D=i!=null&&s&&s.animated!=i;if(l||r||D){(r||i!=null)&&(t=null);const v=i??(t==null?void 0:t.animated)??(l&&!e?!1:o);s=J(e,v,n,p),t==null||t.resolve(s.promise),t=null}}else l&&(x(),s=null),(r||e&&(t==null?void 0:t.animated)!==i)&&(t=e&&i!=null?{animated:i,...N()}:null);return(t==null?void 0:t.promise)??(s==null?void 0:s.promise)});let I={};const C=async(e=!c(),n=H())=>{const o={};I=o;try{await G(()=>{try{return g.set(n),c.set(e),B()}finally{g.set(null)}})}finally{I!==o&&await R}},M=ee(z,te(A),ne(B));return{...T({visible$:u,element$:w,elementPresent$:S,transitioning$:y,shown$:K,hidden$:L}),patch:A,directives:{directive:M},actions:{},api:{show:C.bind(null,!0),hide:C.bind(null,!1),toggle:C}}};export{ce as c};
