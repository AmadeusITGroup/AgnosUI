import{a6 as h,a9 as f,aa as C,T as W,J as p,I as P}from"./AppCommon-wWEJ6LdR.js";import{i as u}from"./dom-BB9jLllr-CeqtqeKx.js";import{a as j,f as v}from"./stores-CJcu1rl_.js";import{f as w}from"./index-client-QFyY-InH.js";const g=(t,e,o=1/0)=>{if(e!==void 0)if(typeof e=="object"&&e&&o>=1){t||(t={});for(const n of Object.keys(e))Object.prototype.hasOwnProperty.call(e,n)&&(n==="__proto__"||n==="constructor"||(t[n]=g(t[n],e[n],o-1)))}else return e;return t},O=(t,e=u)=>{const o=h({}),n=e===u?t:f(()=>e(g({},t==null?void 0:t(),2)));return C(f(()=>g(g({},n==null?void 0:n(),2),o(),2)),{...o,own$:o,adaptedParent$:n,parent$:t})};function x(t,e){return o=>{const n=v(t,o);t=o,n&&e(n)}}const F=(t,e)=>e?(...o)=>{t(...o),e(...o)}:t,_=(t,e)=>{const o=h(e,{equal:Object.is});return C(f(()=>F(t,o())),{set:o.set,update:o.update})},S=t=>{const{factory:e,defaultConfig:o,widgetConfig:n,events:c,enablePatchChanged:s}=t,a=t.props??{},y=j(o),l={...a};if(c)for(const r of Object.keys(c))l[r]=_(c[r],a[r]);const i=e({config:f(()=>({...y(),...n==null?void 0:n()})),props:l}),b=Object.fromEntries(Object.entries(i.stores).map(([r,d])=>[r.slice(0,-1),w(d)]));if(s){const r=x(a,i.patch);W(()=>{r({...t.props})})}return{api:i.api,directives:i.directives,state:new Proxy(b,{get(r,d,m){if(Reflect.has(r,d))return Reflect.get(r,d,m).current}})}},k=(t=Symbol("widgetsConfig"))=>{const e=c=>{const s=p(t),a=O(s,c);return P(t,a),a},o=c=>{const s=p(t);return f(()=>s==null?void 0:s()[c])};return{widgetsDefaultConfigKey:t,createWidgetsDefaultConfig:e,getContextWidgetConfig:o,callWidgetFactory:c=>S({factory:c.factory,defaultConfig:c.defaultConfig,widgetConfig:c.widgetName?o(c.widgetName):null,events:c.events,get props(){return c.props},enablePatchChanged:c.enablePatchChanged})}},{widgetsDefaultConfigKey:N,createWidgetsDefaultConfig:q,getContextWidgetConfig:J,callWidgetFactory:T}=k();export{T as c,k as w};
