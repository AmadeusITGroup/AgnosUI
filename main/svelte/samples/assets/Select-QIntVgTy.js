import{ac as d,ai as we,ad as ue,ag as De,p as Fe,P as ce,R as me,s as ge,c as Ie,d as $,b as N,a as ye,t as Z,r as ve,O as ke,e as X,g as l,n as fe,q as _,l as T}from"./AppCommon-D6XzPDt_.js";import{a as p}from"./actions-C5zFepch.js";import{t as Se}from"./class-BjsImlqy.js";import{S as he}from"./Slot-DAvQuAHA.js";import{c as $e}from"./config-BMGCqy3X.js";import{c as Ne,o as Te,a as Le,b as Pe}from"./floatingUI-04gu6OHp.js";import{c as Ae}from"./focustrack-1RBV_tjs.js";import{c as Me}from"./navManager-BYnEWTmU.js";import{w as Ee,j as Oe,y as Be,x as He,s as Re,m as We,B as qe,h as de,a as L,c as Y}from"./directive-CKEccryv-BLJ74ze2.js";import{e as ze}from"./extendWidget-Cq2v8VqQ.js";const Ue={id:void 0,ariaLabel:"Select",open:!1,disabled:!1,items:[],filterText:"",loading:!1,selected:[],navSelector:g=>g.querySelectorAll(".au-select-badge,input"),itemIdFn:g=>""+g,onOpenChange:de,onFilterTextChange:de,onSelectedChange:de,allowedPlacements:["bottom-start","top-start","bottom-end","top-end"],className:"",menuClassName:"",menuItemClassName:"",badgeClassName:""};function je(g){const[{id$:D,open$:K,filterText$:ee,items$:q,itemIdFn$:I,onOpenChange$:z,onFilterTextChange$:te,onSelectedChange$:x,allowedPlacements$:ie,navSelector$:c,className$:se,badgeClassName$:P,ariaLabel$:U,menuClassName$:j,...G},ae]=Ee(Ue,g),{selected$:A}=G,y=d(()=>D()??Oe()),C=Be(ee,te),{hasFocus$:oe,directive:J}=Ae(),r=He(z,[K,oe],([e,t])=>e&&t),M=d(()=>{const e=new Map,t=I();for(const a of A()){const f=t(a);e.set(f,{item:a,id:t(a),selected:!0})}return e}),Q=d(()=>[...M().values()]),h=function(){const e=we(0);return ue(e,t=>{const{length:a}=k();t!=null&&(a?t<0?t=a-1:t>=a&&(t=0):t=void 0),e.set(t)})}(),E=d(()=>{const e=new Map;if(r()){const t=M(),a=I();for(const f of q()){const w=a(f);e.set(w,{item:f,id:w,selected:t.has(w)})}}return e}),k=d(()=>r()?[...E().values()]:[]),O=d(()=>{const e=k(),t=h();return e.length&&t!=null?e[t]:void 0}),{directives:{floatingDirective:re,referenceDirective:i},stores:{placement$:s}}=Ne({props:{computePositionOptions:ue(d(()=>({middleware:[Te(5),Le({allowedPlacements:ie()}),Pe()]})))}}),{directive:u,refreshElements:m,focusFirst:o,focusLast:b,focusLeft:v,focusRight:S}=Me(),B=d(()=>({keys:{Home:o,End:b,ArrowLeft:v,ArrowRight:S},selector:c()})),H=(e,t)=>{const a=e.target;m(),n.api.unselect(t),a instanceof HTMLElement&&setTimeout(()=>{v({event:e,referenceElement:a})||S({event:e,referenceElement:a})}),e.preventDefault()},ne=L(()=>({attributes:{role:"combobox","aria-haspopup":"listbox","aria-expanded":d(()=>`${r()}`),"aria-controls":d(()=>`${y()}-menu`)}})),le=L(e=>({attributes:{tabindex:-1,class:P},classNames:{"au-select-badge":!0},events:{keydown:t=>{let a=!1;switch(t.key){case"Backspace":case"Delete":{H(t,e().item),a=!0;break}}a&&t.preventDefault()}}})),R=L(()=>({attributes:{role:"listbox",id:d(()=>`${y()}-menu`),"data-popper-placement":s,class:j},events:{mousedown:e=>e.preventDefault()}})),W=L(e=>({attributes:{role:"option","aria-selected":d(()=>`${e().selected}`),style:"cursor: pointer"},classNames:{"au-select-item":!0,selected:d(()=>e().selected)},events:{click:()=>n.api.toggleItem(e().item)}})),be=L(()=>({attributes:{id:y(),type:"text","aria-label":U(),"aria-autocomplete":"list",autocorrect:"off",autocapitalize:"none",autocomplete:"off"},classNames:{"au-select-input":!0},events:{input:e=>{const t=e.target.value;De(()=>{r.set(t!=null&&t!==""),C.set(t)})},keydown:({ctrlKey:e,key:t,preventDefault:a})=>{let f=!0;switch(t){case"ArrowDown":{r()?e?n.api.highlightLast():n.api.highlightNext():(n.api.open(),n.api.highlightFirst());break}case"ArrowUp":e?n.api.highlightFirst():n.api.highlightPrevious();break;case"Enter":{const w=O();w&&n.api.toggleItem(w.item);break}case"Escape":r.set(!1);break;default:f=!1}f&&a()}}})),_e=L(e=>({events:{click:t=>{H(t,e().item)}}})),n={...Re({id$:y,visibleItems$:k,highlighted$:O,open$:r,selectedContexts$:Q,filterText$:C,placement$:s,className$:se,badgeClassName$:P,ariaLabel$:U,menuClassName$:j,...G}),patch:ae,api:{clear(){A.set([])},select(e){n.api.toggleItem(e,!0)},unselect(e){n.api.toggleItem(e,!1)},toggleItem(e,t){const a=I(),f=a(e),V=M().has(f);t==null&&(t=!V),!(t&&!E().has(f)||!t&&!V)&&A.update(F=>{var pe;if(F=[...F],t&&!V)F.push(e);else if(!t&&V){const xe=F.findIndex(Ce=>a(Ce)===f);F.splice(xe,1)}return(pe=x())==null||pe(F),F})},clearText(){},highlight(e){const t=k().findIndex(a=>a.item===e);h.set(t===-1?void 0:t)},highlightFirst(){h.set(0)},highlightPrevious(){h.update(e=>e!=null?e-1:-1)},highlightNext(){h.update(e=>e!=null?e+1:1/0)},highlightLast(){h.set(-1)},open:()=>n.api.toggle(!0),close:()=>n.api.toggle(!1),toggle(e){r.update(t=>e??!t)}},directives:{hasFocusDirective:J,floatingDirective:re,referenceDirective:i,inputContainerDirective:We(qe(u,B),ne),badgeAttributesDirective:le,menuAttributesDirective:R,itemAttributesDirective:W,inputDirective:be,badgeCloseButtonDirective:_e}};return n}const Ge={badgeLabel:({itemContext:g})=>g.item,itemLabel:({itemContext:g})=>g.item},Je=ze(je,Ge),Qe=Je;var Ve=Z("<div><!></div>"),Xe=Z("<li><!></li>"),Ye=Z("<ul></ul>"),Ze=Z("<div><div><!> <input></div> <!></div>");function ct(g,D){Fe(D,!0);const K=(i,s)=>{let u=()=>s==null?void 0:s().itemContext;var m=ve();$(()=>fe(m,u().item)),N(i,m)},ee=(i,s)=>{let u=()=>s==null?void 0:s().itemContext;var m=ve();$(()=>fe(m,u().item)),N(i,m)};let q=ce(D,"open",15,!1),I=ce(D,"filterText",15),z=ce(D,"selected",15),te=ke(D,["$$slots","$$events","$$legacy","open","filterText","selected"]);const x=$e({factory:Qe,widgetName:"select",get props(){return{...te,open:q(),filterText:I(),selected:z()}},enablePatchChanged:!0,defaultConfig:{badgeLabel:K,itemLabel:ee},events:{onOpenChange(i){q(i)},onSelectedChange:i=>{z(i)},onFilterTextChange:i=>{I(i)}}}),ie=x.api,{state:c,directives:{floatingDirective:se,hasFocusDirective:P,referenceDirective:U,inputContainerDirective:j,badgeAttributesDirective:G,menuAttributesDirective:ae,itemAttributesDirective:A,inputDirective:y}}=x;var C=Ze();const oe=_(()=>({}));let J;var r=X(C);const M=_(()=>({}));let Q;var h=X(r);me(h,17,()=>c.selectedContexts,i=>i.id,(i,s)=>{var u=Ve();const m=_(()=>({}));let o;var b=X(u),v=_(()=>({state:c,directives:x.directives,api:x.api,itemContext:l(s)}));he(b,{get content(){return c.badgeLabel},get props(){return l(v)}}),p(u,(S,B)=>G(S,B),()=>l(s)),$(()=>o=T(u,o,{...l(m)})),N(i,u)});var E=ge(h,2);const k=_(()=>({}));let O;p(E,i=>y(i)),p(r,i=>P(i)),p(r,i=>j(i)),p(r,(i,s)=>Y(i,s),()=>"d-flex align-items-center flex-wrap gap-1");var re=ge(r,2);return Ie(re,()=>c.open&&c.visibleItems.length>0,i=>{var s=Ye();const u=_(()=>({}));let m;me(s,21,()=>c.visibleItems,o=>o.id,(o,b)=>{var v=Xe();const S=_(()=>l(b)===c.highlighted),B=_(()=>({}));let H;var ne=X(v),le=_(()=>({state:c,directives:x.directives,api:x.api,itemContext:l(b)}));he(ne,{get content(){return c.itemLabel},get props(){return l(le)}}),p(v,(R,W)=>Y(R,W),()=>"dropdown-item position-relative"),p(v,(R,W)=>A(R,W),()=>l(b)),$(()=>{H=T(v,H,{...l(B)}),Se(v,"text-bg-primary",l(S))}),N(o,v)}),p(s,o=>P(o)),p(s,o=>se(o)),p(s,o=>ae(o)),p(s,(o,b)=>Y(o,b),()=>"dropdown-menu show"),$(()=>m=T(s,m,{...l(u)})),N(i,s)}),p(C,i=>U(i)),p(C,(i,s)=>Y(i,s),()=>"au-select dropdown border border-1 p-1 mb-3 d-block "+c.className),$(()=>{J=T(C,J,{...l(oe)}),Q=T(r,Q,{...l(M)}),O=T(E,O,{value:c.filterText,...l(k)})}),N(g,C),ye({api:ie})}export{ct as S};
