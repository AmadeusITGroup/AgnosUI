import{ae as d,ak as j,ag as Q,ai as k}from"./AppCommon-CC-VkUgW.js";import{t as C,a as f,c as X}from"./writables-DoU_XYTX-slp4MWt3.js";import{p as q}from"./promise-CY2U8bTP-FiA19x-Q.js";import{j as m,w as Y,x as Z,y as F,s as T,e as ee,h as ne,z as te}from"./directive-CKEccryv-BuQmRVBG.js";const z=new Promise(m),ie=(h,$)=>{h.style.display=$==="show"?"":"none"},oe={animated:!0,animatedOnInit:!1,initDone:null,visible:!0,transition:ie,onShown:m,onHidden:m,onVisibleChange:m},se={animated:C,animatedOnInit:C,visible:C,transition:f,onShown:f,onHidden:f,onVisibleChange:f,initDone:X},ce=h=>{const[{animated$:$,initDone$:b,visible$:c,transition$:N,onShown$:R,onHidden$:U,onVisibleChange$:W,animatedOnInit$:_},S]=Y(oe,h,se),{element$:w,directive:G}=Z(),x=d(()=>!!w()),u=F(W,[c],([e])=>e),a=j(null),y=d(()=>!!a()),A=()=>{let e;return a.update(n=>(n==null||n.abort.abort(),e=n==null?void 0:n.context,null)),e},J=(e,n,s,i)=>k(()=>{const p=new AbortController,o=p.signal,l=A()??{},{promise:r,resolve:V}=q(),v={abort:p,animated:n,visible:e,context:l,element:s,transitionFn:i,promise:r};return a.set(v),V((async()=>{var E;try{await i(s,e?"show":"hide",n,o,l)}finally{o.aborted?await z:(a.set(null),(E=(e?R:U)())==null||E())}})()),v}),K=d(()=>!y()&&u()&&x()),L=d(()=>!y()&&!u()),O=d(()=>b()?$():_()),g=j(null);let P,H=c(),t=null;const I=Q([u,w,O,g,N,a],([e,n,s,i,p,o])=>{const l=P!==n;P=n;const r=H!==e;if(H=e,n){b()==null&&b.set(!0);const V=i!=null&&o&&o.animated!=i;if(l||r||V){(r||i!=null)&&(t=null);const v=i??(t==null?void 0:t.animated)??(l&&!e?!1:s);o=J(e,v,n,p),t==null||t.resolve(o.promise),t=null}}else l&&(A(),o=null),(r||e&&(t==null?void 0:t.animated)!==i)&&(t=e&&i!=null?{animated:i,...q()}:null);return(t==null?void 0:t.promise)??(o==null?void 0:o.promise)});let B={};const D=async(e=!c(),n=O())=>{const s={};B=s;try{await k(()=>{try{return g.set(n),c.set(e),I()}finally{g.set(null)}})}finally{B!==s&&await z}},M=ee(G,te(e=>{e&&S(e)}),ne(I));return{...T({visible$:u,element$:w,elementPresent$:x,transitioning$:y,shown$:K,hidden$:L}),patch:S,directives:{directive:M},api:{show:D.bind(null,!0),hide:D.bind(null,!1),toggle:D}}};export{ce as c};
