import{ag as H,aa as h,p as D,g as b,s as R,d as L,b as x,a as N,t as T,e as U,q as _,n as ae,c as V,P as j,l as C,L as G,v as re,f as ie,w as I,O as A}from"./AppCommon-C_Uz3Ejm.js";import{S as w}from"./Slot-Bu-WTpc_.js";import{c as ne}from"./config-BR7DENd9.js";import{c as se}from"./navManager-nDn0Z_Sk.js";import{w as oe,s as le,B as ce,m as de,a as W,h as ue,b as me,c as ve}from"./directive-CKEccryv-Dj2WBjfx.js";import{b as ge,h as pe,a as M}from"./writables-DCiBdIBK-COVli6XW.js";import{e as fe}from"./extendWidget-Dy2T1Nx7.js";import{a as S}from"./actions-CtzdcLql.js";import"./snippet-gGBChira.js";import"./config-vsRo1j0h.js";import"./index-client-D5u8RE9d.js";const be={className:"",nodes:[],onExpandToggle:ue,navSelector:o=>o.querySelectorAll("button"),ariaLabelToggleFn:o=>`Toggle ${o}`},he={className:ge,nodes:pe,onExpandToggle:M,navSelector:M,ariaLabelToggleFn:M};function xe(o){const[{nodes$:e,onExpandToggle$:l,navSelector$:d,ariaLabelToggleFn$:u,...i},g]=oe(be,o,he),m=new Map,n={get(t){return t.isExpanded}},r=H({}),c=h(()=>(k(),r(),n)),{elementsInDomOrder$:E,directive:P,refreshElements:J,focusIndex:K,focusPrevious:Q,focusNext:X,focusFirst:Y,focusLast:Z}=se(),$=h(()=>({keys:{ArrowUp:Q,ArrowDown:X,Home:Y,End:Z},selector:d()})),O=(t,a,s)=>{var v;const p={...t,ariaLabel:t.ariaLabel??t.label,level:a,children:[],isExpanded:(v=t.children)!=null&&v.length?t.isExpanded??!1:void 0};return m.set(p,{parent:s}),t.children&&(p.children=t.children.map(f=>O(f,a+1,p))),p},k=h(()=>(m.clear(),e().map(t=>O(t,0,void 0)))),q=H(k()[0]),y=t=>{const a=m.get(t);return a||console.error(`Node ${t.label} doesn't exist in the map`),a},ee=me((t,a)=>{let s;const v=()=>{s&&s.htmlElement===t&&(s.htmlElement=void 0),s=void 0},p=f=>{v(),s=y(f.item),s&&(s.htmlElement&&console.warn("The tree item directive should be used once per element"),s.htmlElement=t)};return p(a),{update:p,destroy:v}}),z=t=>{var a;if(t){const s=(a=y(t))==null?void 0:a.htmlElement;if(s){const v=E().indexOf(s);K(v,0)}}},te=W(t=>({events:{focus:()=>{const{item:a}=t();q.set(a)},click:()=>{const{item:a}=t();F(a)},keydown:a=>{var s,v;const{key:p}=a,{item:f}=t(),B=f.isExpanded;switch(J(),p){case"ArrowLeft":B?F(f):z((s=y(f))==null?void 0:s.parent);break;case"ArrowRight":B?z((v=f.children)==null?void 0:v[0]):F(f);break;default:return}a.preventDefault(),a.stopPropagation()}},attributes:{"aria-label":h(()=>{const{item:a}=t();return u()(a.ariaLabel)}),tabindex:h(()=>{const{item:a}=t();return a===q()?"0":"-1"}),type:"button"},classNames:{"au-tree-expand-icon":!0,"au-tree-expand-icon-expanded":h(()=>{r();const{item:a}=t();return a.isExpanded??!1})}})),F=t=>{y(t)===void 0||t.isExpanded===void 0||(t.isExpanded=!t.isExpanded,r.set({}),l()(t))};return{...le({normalizedNodes$:k,expandedMap$:c,...i}),patch:g,api:{},directives:{navigationDirective:ce(P,$),itemToggleDirective:de(ee,te),itemAttributesDirective:W(t=>({attributes:{role:"treeitem","aria-selected":"false","aria-expanded":h(()=>{var a;const{item:s}=t();return r(),(a=s.isExpanded)==null?void 0:a.toString()})}}))}}}const _e={structure:void 0,item:void 0,itemContent:void 0,itemToggle:void 0},Te=fe(xe,_e,{structure:void 0,item:void 0,itemContent:void 0,itemToggle:void 0}),Ee=Te;var we=T('<span class="au-tree-item"><!> </span>');function De(o,e){D(e,!0);var l=we(),d=U(l),u=_(()=>({item:e.item,state:e.state,api:e.api,directives:e.directives}));w(d,{get content(){return e.state.itemToggle},get props(){return b(u)}});var i=R(d);L(()=>ae(i,` ${e.item.label??""}`)),x(o,l),N()}var Ne=T('<ul role="group"></ul>'),ye=T("<li><!> <!></li>");function Ie(o,e){D(e,!0);var l=ye();const d=_(()=>({}));let u;var i=U(l),g=_(()=>({item:e.item,state:e.state,api:e.api,directives:e.directives}));w(i,{get content(){return e.state.itemContent},get props(){return b(g)}});var m=R(i,2);V(m,()=>e.state.expandedMap.get(e.item),n=>{var r=Ne();j(r,23,()=>e.item.children,(c,E)=>c.label+c.level+E,(c,E)=>{var P=_(()=>({item:b(E),state:e.state,api:e.api,directives:e.directives}));w(c,{get content(){return e.state.item},get props(){return b(P)}})}),x(n,r)}),S(l,(n,r)=>e.directives.itemAttributesDirective(n,r),()=>({item:e.item})),L(()=>u=C(l,u,{...b(d)})),x(o,l),N()}var Ae=T("<ul></ul>");function Se(o,e){D(e,!0);let l=G(e,["$$slots","$$events","$$legacy"]),{state:d,directives:u}=l;var i=Ae();const g=_(()=>({}));let m;j(i,23,()=>d.normalizedNodes,(n,r)=>n.label+n.level+r,(n,r)=>{var c=_(()=>({item:b(r),...l}));w(n,{get content(){return d.item},get props(){return b(c)}})}),S(i,(n,r)=>ve(n,r),()=>"au-tree "+d.className),S(i,n=>u.navigationDirective(n)),L(()=>m=C(i,m,{role:"tree",...b(g)})),x(o,i),N()}var Le=T("<button></button>"),Pe=T('<span class="au-tree-expand-icon-placeholder"></span>');function ke(o,e){D(e,!0);var l=re(),d=ie(l);V(d,()=>e.item.children.length>0,u=>{var i=Le();const g=_(()=>({}));let m;S(i,(n,r)=>e.directives.itemToggleDirective(n,r),()=>({item:e.item})),L(()=>m=C(i,m,{...b(g)})),x(u,i)},u=>{var i=Pe();x(u,i)}),x(o,l),N()}function Fe(o,e){D(e,!0);const l=(r,c=A)=>{Se(r,I(c))},d=(r,c=A)=>{Ie(r,I(c))},u=(r,c=A)=>{De(r,I(c))},i=(r,c=A)=>{ke(r,I(c))};let g=G(e,["$$slots","$$events","$$legacy"]);const m=ne({factory:Ee,widgetName:"tree",props:g,enablePatchChanged:!0,defaultConfig:{structure:l,item:d,itemContent:u,itemToggle:i}}),{state:n}=m;w(o,{get content(){return n.structure},props:m}),N()}function Ge(o){Fe(o,{nodes:[{label:"Node 1",isExpanded:!0,children:[{label:"Node 1.1",children:[{label:"Node 1.1.1"}]},{label:"Node 1.2",children:[{label:"Node 1.2.1"}]}]}]})}export{Ge as default};
