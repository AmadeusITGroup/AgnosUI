import{a9 as u,a6 as Ce,ab as ue,a8 as Ie,p as ke,M as ce,P as me,c as ye,d as R,b as W,a as Fe,r as he,t as ne,L as Se,s as fe,g as d,n as be,k as se,q as x,l as B}from"./AppCommon-ZwIOf5HX.js";import{a as m}from"./actions-BgK1WUfw.js";import{S as ge}from"./Slot-DtsV2h1H.js";import{c as $e}from"./config-6P0VySVD.js";import{c as Le,o as Ne,a as Te,b as Pe}from"./floatingUI-BIFXfu_Q.js";import{c as De}from"./focustrack-IGv9B6tG.js";import{c as Me}from"./navManager-Cw2_7b0f.js";import{w as Ae,D as Ee,y as Oe,x as Be,s as He,m as Re,B as We,n as de,a as H,c as ie}from"./stores-DX-ADOKq-CL6jUnRu.js";import{e as qe}from"./extendWidget-PHDLH8-l.js";const ze={id:void 0,ariaLabel:"Select",open:!1,disabled:!1,items:[],filterText:"",loading:!1,selected:[],navSelector:o=>o.querySelectorAll(".au-select-badge,input"),itemIdFn:o=>""+o,onOpenChange:de,onFilterTextChange:de,onSelectedChange:de,allowedPlacements:["bottom-start","top-start","bottom-end","top-end"],className:"",menuClassName:"",menuItemClassName:"",badgeClassName:""};function Ue(o){const[{id$:r,open$:w,filterText$:b,items$:X,itemIdFn$:q,onOpenChange$:C,onFilterTextChange$:oe,onSelectedChange$:p,allowedPlacements$:z,navSelector$:I,className$:U,badgeClassName$:$,ariaLabel$:L,menuClassName$:N,...T},j]=Ae(ze,o),{selected$:v}=T,P=u(()=>r()??Ee()),G=Oe(b,oe),{hasFocus$:k,directive:re}=De(),g=Be(C,[w,k],([e,t])=>e&&t),D=u(()=>{const e=new Map,t=q();for(const s of v()){const h=t(s);e.set(h,{item:s,id:t(s),selected:!0})}return e}),Y=u(()=>[...D().values()]),y=function(){const e=Ce(0);return ue(e,t=>{const{length:s}=M();t!=null&&(s?t<0?t=s-1:t>=s&&(t=0):t=void 0),e.set(t)})}(),J=u(()=>{const e=new Map;if(g()){const t=D(),s=q();for(const h of X()){const F=s(h);e.set(F,{item:h,id:F,selected:t.has(F)})}}return e}),M=u(()=>g()?[...J().values()]:[]),Z=u(()=>{const e=M(),t=y();return e.length&&t!=null?e[t]:void 0}),{directives:{floatingDirective:a,referenceDirective:i},stores:{placement$:l}}=Le({props:{computePositionOptions:ue(u(()=>({middleware:[Ne(5),Te({allowedPlacements:z()}),Pe()]})))}}),{directive:A,refreshElements:n,focusFirst:_,focusLast:f,focusLeft:E,focusRight:O}=Me(),K=u(()=>({keys:{Home:_,End:f,ArrowLeft:E,ArrowRight:O},selector:I()})),ee=(e,t)=>{const s=e.target;n(),c.api.unselect(t),s instanceof HTMLElement&&setTimeout(()=>{E({event:e,referenceElement:s})||O({event:e,referenceElement:s})}),e.preventDefault()},le=H(()=>({attributes:{role:"combobox","aria-haspopup":"listbox","aria-expanded":u(()=>`${g()}`),"aria-controls":u(()=>`${P()}-menu`)}})),Q=H(e=>({attributes:{tabindex:-1,class:$},classNames:{"au-select-badge":!0},events:{keydown:t=>{let s=!1;switch(t.key){case"Backspace":case"Delete":{ee(t,e().item),s=!0;break}}s&&t.preventDefault()}}})),V=H(()=>({attributes:{role:"listbox",id:u(()=>`${P()}-menu`),"data-popper-placement":l,class:N},events:{mousedown:e=>e.preventDefault()}})),te=H(e=>({attributes:{role:"option","aria-selected":u(()=>`${e().selected}`),style:"cursor: pointer"},classNames:{"au-select-item":!0,selected:u(()=>e().selected)},events:{click:()=>c.api.toggleItem(e().item)}})),ve=H(()=>({attributes:{id:P(),type:"text","aria-label":L(),"aria-autocomplete":"list",autocorrect:"off",autocapitalize:"none",autocomplete:"off"},classNames:{"au-select-input":!0},events:{input:e=>{const t=e.target.value;Ie(()=>{g.set(t!=null&&t!==""),G.set(t)})},keydown:({ctrlKey:e,key:t,preventDefault:s})=>{let h=!0;switch(t){case"ArrowDown":{g()?e?c.api.highlightLast():c.api.highlightNext():(c.api.open(),c.api.highlightFirst());break}case"ArrowUp":e?c.api.highlightFirst():c.api.highlightPrevious();break;case"Enter":{const F=Z();F&&c.api.toggleItem(F.item);break}case"Escape":g.set(!1);break;default:h=!1}h&&s()}}})),_e=H(e=>({events:{click:t=>{ee(t,e().item)}}})),c={...He({id$:P,visibleItems$:M,highlighted$:Z,open$:g,selectedContexts$:Y,filterText$:G,placement$:l,className$:U,badgeClassName$:$,ariaLabel$:L,menuClassName$:N,...T}),patch:j,api:{clear(){v.set([])},select(e){c.api.toggleItem(e,!0)},unselect(e){c.api.toggleItem(e,!1)},toggleItem(e,t){const s=q(),h=s(e),ae=D().has(h);t==null&&(t=!ae),!(t&&!J().has(h)||!t&&!ae)&&v.update(S=>{var pe;if(S=[...S],t&&!ae)S.push(e);else if(!t&&ae){const xe=S.findIndex(we=>s(we)===h);S.splice(xe,1)}return(pe=p())==null||pe(S),S})},clearText(){},highlight(e){const t=M().findIndex(s=>s.item===e);y.set(t===-1?void 0:t)},highlightFirst(){y.set(0)},highlightPrevious(){y.update(e=>e!=null?e-1:-1)},highlightNext(){y.update(e=>e!=null?e+1:1/0)},highlightLast(){y.set(-1)},open:()=>c.api.toggle(!0),close:()=>c.api.toggle(!1),toggle(e){g.update(t=>e??!t)}},directives:{hasFocusDirective:re,floatingDirective:a,referenceDirective:i,inputContainerDirective:Re(We(A,K),le),badgeAttributesDirective:Q,menuAttributesDirective:V,itemAttributesDirective:te,inputDirective:ve,badgeCloseButtonDirective:_e}};return c}const je={badgeLabel:({itemContext:o})=>o.item,itemLabel:({itemContext:o})=>o.item},Ge=qe(Ue,je),Je=Ge,Qe=(o,r)=>{let w=()=>r==null?void 0:r().itemContext;var b=he();R(()=>be(b,w().item)),W(o,b)},Ve=(o,r)=>{let w=()=>r==null?void 0:r().itemContext;var b=he();R(()=>be(b,w().item)),W(o,b)};var Xe=ne("<div><!></div>"),Ye=ne("<li><!></li>"),Ze=ne("<ul></ul>"),Ke=ne("<div><div><!> <input></div> <!></div>");function ct(o,r){ke(r,!0);let w=ce(r,"open",15,!1),b=ce(r,"filterText",15),X=ce(r,"selected",15),q=Se(r,["$$slots","$$events","$$legacy","open","filterText","selected"]);const C=$e({factory:Je,widgetName:"select",get props(){return{...q,open:w(),filterText:b(),selected:X()}},enablePatchChanged:!0,defaultConfig:{badgeLabel:Qe,itemLabel:Ve},events:{onOpenChange(a){w(a)},onSelectedChange:a=>{X(a)},onFilterTextChange:a=>{b(a)}}}),oe=C.api,{state:p,directives:{floatingDirective:z,hasFocusDirective:I,referenceDirective:U,inputContainerDirective:$,badgeAttributesDirective:L,menuAttributesDirective:N,itemAttributesDirective:T,inputDirective:j}}=C;var v=Ke();const P=x(()=>({}));let G;var k=se(v);const re=x(()=>({}));let g;var D=se(k);me(D,17,()=>p.selectedContexts,a=>a.id,(a,i)=>{var l=Xe();const A=x(()=>({}));let n;var _=se(l),f=x(()=>({state:p,directives:C.directives,api:C.api,itemContext:d(i)}));ge(_,{get content(){return p.badgeLabel},get props(){return d(f)}}),m(l,(E,O)=>L==null?void 0:L(E,O),()=>d(i)),R(()=>n=B(l,n,{...d(A)})),W(a,l)});var Y=fe(D,2);const y=x(()=>({}));let J;m(Y,a=>j==null?void 0:j(a)),m(k,a=>I==null?void 0:I(a)),m(k,a=>$==null?void 0:$(a)),m(k,(a,i)=>{var l;return(l=ie)==null?void 0:l(a,i)},()=>"d-flex align-items-center flex-wrap gap-1");var M=fe(k,2);{var Z=a=>{var i=Ze();const l=x(()=>({}));let A;me(i,21,()=>p.visibleItems,n=>n.id,(n,_)=>{var f=Ye();const E=x(()=>d(_)===p.highlighted),O=x(()=>({}));let K;var ee=se(f),le=x(()=>({state:p,directives:C.directives,api:C.api,itemContext:d(_)}));ge(ee,{get content(){return p.itemLabel},get props(){return d(le)}}),m(f,(Q,V)=>{var te;return(te=ie)==null?void 0:te(Q,V)},()=>["dropdown-item position-relative",{"text-bg-primary":d(E)}]),m(f,(Q,V)=>T==null?void 0:T(Q,V),()=>d(_)),R(()=>K=B(f,K,{...d(O)})),W(n,f)}),m(i,n=>I==null?void 0:I(n)),m(i,n=>z==null?void 0:z(n)),m(i,n=>N==null?void 0:N(n)),m(i,(n,_)=>{var f;return(f=ie)==null?void 0:f(n,_)},()=>"dropdown-menu show"),R(()=>A=B(i,A,{...d(l)})),W(a,i)};ye(M,a=>{p.open&&p.visibleItems.length>0&&a(Z)})}return m(v,a=>U==null?void 0:U(a)),m(v,(a,i)=>{var l;return(l=ie)==null?void 0:l(a,i)},()=>"au-select dropdown border border-1 p-1 mb-3 d-block "+p.className),R(()=>{G=B(v,G,{...d(P)}),g=B(k,g,{...d(re)}),J=B(Y,J,{value:p.filterText,...d(y)})}),W(o,v),Fe({api:oe})}export{ct as S};
