import{a1 as v,Z as n,Y as p}from"./AppCommon-Wa4AmAan.js";import{c as z}from"./navManager-DnoAKEyK.js";import{n as R,m as U,a as E,b as V,e as W}from"./dom-DD1hAVZy-BYveNrMV.js";import{w as Y,s as Z,t as j}from"./stores-D55NZwSh.js";import{b as f,a as B,t as G}from"./writables-Is1bF1Vt-V-2PSM06.js";import{c as J}from"./widget-DSB4mopV.js";const K={className:"",nodes:[],onExpandToggle:R,navSelector:i=>i.querySelectorAll("button"),ariaLabelToggleFn:i=>`Toggle ${i}`},Q={className:G,nodes:B,onExpandToggle:f,navSelector:f,ariaLabelToggleFn:f},ne=J("tree",i=>{const[{nodes$:x,onExpandToggle$:h,navSelector$:w,ariaLabelToggleFn$:T,...D},y]=Y(K,i,Q),d=new Map,A={get(e){return e.isExpanded}},o=v({}),I=n(()=>(m(),o(),A)),{elementsInDomOrder$:L,directive:N,refreshElements:$,focusIndex:k,focusPrevious:F,focusNext:S,focusFirst:M,focusLast:P}=z(),_=n(()=>({keys:{ArrowUp:F,ArrowDown:S,Home:M,End:P},selector:w()})),u=(e,t,r)=>{const a={...e,ariaLabel:e.ariaLabel??e.label,level:t,children:[],isExpanded:e.children?.length?e.isExpanded??!1:void 0};return d.set(a,{parent:r}),e.children&&(a.children=e.children.map(s=>u(s,t+1,a))),a},m=n(()=>(d.clear(),x().map(e=>u(e,0,void 0)))),g=v(m().find(e=>e.isExpanded!==void 0)),c=e=>{const t=d.get(e);return t||console.error(`Node ${e.label} doesn't exist in the map`),t},H=V((e,t)=>{let r;const a=()=>{r&&r.htmlElement===e&&(r.htmlElement=void 0),r=void 0},s=q=>{a(),r=c(q.item),r&&(r.htmlElement&&console.warn("The tree item directive should be used once per element"),r.htmlElement=e)};return s(t),{update:s,destroy:a}}),b=e=>{if(e){const t=c(e)?.htmlElement;if(t){const r=L().indexOf(t);k(r,0)}}},O=E(e=>({events:{focus:()=>{const{item:t}=e();g.set(t)},click:()=>{const{item:t}=e();l(t)},keydown:t=>{const{key:r}=t,{item:a}=e(),s=a.isExpanded;switch($(),r){case"Enter":case" ":l(a);break;case"ArrowLeft":s?l(a):b(c(a)?.parent);break;case"ArrowRight":s?b(a.children?.[0]):l(a);break;default:return}t.preventDefault(),t.stopPropagation()}},attributes:{"aria-label":n(()=>{const{item:t}=e();return T()(t.ariaLabel)}),tabindex:n(()=>{const{item:t}=e();return t===g()?"0":"-1"}),type:p("button")},classNames:{"au-tree-expand-icon":j,"au-tree-expand-icon-expanded":n(()=>{o();const{item:t}=e();return t.isExpanded??!1})}})),l=e=>{c(e)===void 0||e.isExpanded===void 0||(e.isExpanded=!e.isExpanded,o.set({}),h()(e))};return{...Z({normalizedNodes$:m,expandedMap$:I,...D}),patch:y,api:{},directives:{navigationDirective:W(N,_),itemToggleDirective:U(H,O),itemAttributesDirective:E(e=>({attributes:{role:p("treeitem"),"aria-selected":p("false"),"aria-expanded":n(()=>{const{item:t}=e();return o(),t.isExpanded?.toString()})}}))}}});export{ne as c};
