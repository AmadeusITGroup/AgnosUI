import{a0 as c,af as B,aj as U,a2 as E}from"./AppCommon-D-Irf_br.js";import{d as X,b as m,c as A}from"./writables-e0tyaQpe-5AqAML2m.js";import{p as j}from"./promise-XSP94FjG-C5dnIRFm.js";import{l as Y,m as Z,e as _,n as b}from"./dom-Bcg9ORcA-CPWV9YZz.js";import{w as F,d as T,s as ee}from"./stores-CNuHRGye.js";const q=new Promise(b),ne=($,h)=>{$.style.display=h==="show"?"":"none"},te={animated:!0,animatedOnInit:!1,initDone:null,visible:!0,transition:ne,onShown:b,onHidden:b,onVisibleChange:b},ie={animated:A,animatedOnInit:A,visible:A,transition:m,onShown:m,onHidden:m,onVisibleChange:m,initDone:X},ce=$=>{const[{animated$:h,initDone$:v,visible$:d,transition$:N,onShown$:R,onHidden$:W,onVisibleChange$:k,animatedOnInit$:z},G]=F(te,$,ie),{element$:w,directive:J}=Y(),y=c(()=>!!w()),u=T(k,[d],([e])=>e),l=B(null),x=()=>{let e;return l.update(n=>(n?.abort.abort(),e=n?.context,null)),e},K=(e,n,o,t)=>E(()=>{const p=new AbortController,i=p.signal,a=x()??{},{promise:r,resolve:S}=j(),f={abort:p,animated:n,visible:e,context:a,element:o,transitionFn:t,promise:r};return l.set(f),S((async()=>{try{await t(o,e?"show":"hide",n,i,a)}finally{i.aborted?await q:(l.set(null),(e?R:W)()?.())}})()),f}),O=c(()=>v()?h():z()),g=B(null);let P,H=d(),s=null;const D=U([u,w,O,g,N,l],([e,n,o,t,p,i])=>{const a=P!==n;P=n;const r=H!==e;if(H=e,n){v()==null&&v.set(!0);const S=t!=null&&i&&i.animated!=t;if(a||r||S){(r||t!=null)&&(s=null);const f=t??s?.animated??(a&&!e?!1:o);i=K(e,f,n,p),s?.resolve(i.promise),s=null}}else a&&(x(),i=null),(r||e&&s?.animated!==t)&&(s=e&&t!=null?{animated:t,...j()}:null);return s?.promise??i?.promise});let I={};const V=async(e=!d(),n=O())=>{const o={};I=o;try{await E(()=>{try{return g.set(n),d.set(e),D()}finally{g.set(null)}})}finally{I!==o&&await q}},C=c(()=>(y()&&D(),!!l())),L=c(()=>!C()&&u()&&y()),M=c(()=>!C()&&!u()),Q=Z(J,_(D));return{...ee({visible$:u,element$:w,elementPresent$:y,transitioning$:C,shown$:L,hidden$:M}),patch:G,directives:{directive:Q},api:{show:V.bind(null,!0),hide:V.bind(null,!1),toggle:V}}};export{ce as c};
