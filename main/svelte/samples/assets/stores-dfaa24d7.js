import{aa as S,Z as u,ab as V,a8 as k,a9 as $,a7 as y,$ as v,_ as O}from"./index-bf18eef9.js";import{i as D}from"./directive-14c41ad8.js";const E=t=>({actions:t.actions,api:t.api,directives:t.directives,state$:t.state$,stores:t.stores}),m=Symbol();function W(t){return function(e){k(()=>{var r;for(const[n,s]of Object.entries(e??{}))(r=t[`${n}$`])==null||r.set(s)})}}function L(t,e){if(t===e)return null;let r=!1;const n={},s=new Set([...Object.keys(t),...Object.keys(e)]);for(const a of s){const o=e[a];t[a]!==o&&(n[a]=o,r=!0)}return r?n:null}function z(t,e=y(void 0),r={},n=v(void 0)){const{normalizeValue:s=D,equal:a=Object.is}=r,o=()=>t,c=(i,l=o)=>{const f=i===void 0?void 0:s(i);return f===m?(console.error("Not using invalid value",i),l()):f===void 0?l():f},d=u(()=>c(e()),{equal:a}),h=u(()=>c(n(),d),{equal:a});return $(h,i=>{if(i!==void 0){const l=s(i);if(l===m){console.error("Not setting invalid value",i);return}i=l}n.set(i)})}const b=t=>!!(t&&typeof t=="function"&&"subscribe"in t),N=t=>b(t)?t:y(t),I=t=>b(t)?t:v(t),w=(t,e)=>{const r={};if(e){const n=b(e);for(const s of t)r[s]=n?u(()=>e()[s]):N(e[s])}return r},R=(t,e,r)=>{const n={};for(const s of t){const a=e==null?void 0:e[s],o=r==null?void 0:r[s];n[s]=a&&o?u(()=>a()??o()):a||o}return n},A=(t,e,r)=>{const n={},s=Object.keys(t),a=w(s,e==null?void 0:e.config),o=e==null?void 0:e.props;for(const c of s){const d=o==null?void 0:o[c];n[`${c}$`]=z(t[c],a[c],r==null?void 0:r[c],I(d))}return n},U=(t,e,r)=>{const n=A(t,e,r);return[n,W(n)]},_=t=>{const e=[],r=[],n={};for(const s of Object.keys(t))if(s.endsWith("$")){const a=t[s];e.push(s.substring(0,s.length-1)),r.push(a),n[s]=S(a)}return{stores:n,state$:u(()=>{const s=r.map(V),a={};return e.forEach((o,c)=>{a[o]=s[c]}),a})}},F=(t,e,r=s=>s[0],n=(s,a)=>a===s)=>{let s=e[0]();return O(e,{derive(a){const o=r(a),c=!n(a[0],o);return c&&e[0].set(o),(c||!n(s,o))&&(s=o,t()(o)),o},equal:n})};export{m as I,A as a,F as b,N as c,L as f,R as m,w as n,_ as s,E as t,U as w};
