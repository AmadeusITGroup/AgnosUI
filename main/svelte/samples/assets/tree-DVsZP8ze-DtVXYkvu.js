import{ad as E,a7 as i}from"./AppCommon-TeUJQW-I.js";import{c as z}from"./navManager-DURd1YkS.js";import{w as B,s as R,B as U,m as V,a as x,b as j,h as G}from"./directive-DrDJkTS5-DUdLAntD.js";import{b as J,h as K,a as u}from"./writables-DCiBdIBK-43mrhbqD.js";const Q={className:"",nodes:[],onExpandToggle:G,navSelector:o=>o.querySelectorAll("button"),ariaLabelToggleFn:o=>`Toggle ${o}`},W={className:J,nodes:K,onExpandToggle:u,navSelector:u,ariaLabelToggleFn:u};function te(o){const[{nodes$:h,onExpandToggle$:w,navSelector$:T,ariaLabelToggleFn$:D,...y},A]=B(Q,o,W),p=new Map,I={get(e){return e.isExpanded}},c=E({}),L=i(()=>(m(),c(),I)),{elementsInDomOrder$:N,directive:_,refreshElements:k,focusIndex:S,focusPrevious:$,focusNext:F,focusFirst:M,focusLast:P}=z(),H=i(()=>({keys:{ArrowUp:$,ArrowDown:F,Home:M,End:P},selector:T()})),f=(e,t,a)=>{var r;const s={...e,ariaLabel:e.ariaLabel??e.label,level:t,children:[],isExpanded:(r=e.children)!=null&&r.length?e.isExpanded??!1:void 0};return p.set(s,{parent:a}),e.children&&(s.children=e.children.map(n=>f(n,t+1,s))),s},m=i(()=>(p.clear(),h().map(e=>f(e,0,void 0)))),g=E(m().find(e=>e.isExpanded!==void 0)),l=e=>{const t=p.get(e);return t||console.error(`Node ${e.label} doesn't exist in the map`),t},O=j((e,t)=>{let a;const r=()=>{a&&a.htmlElement===e&&(a.htmlElement=void 0),a=void 0},s=n=>{r(),a=l(n.item),a&&(a.htmlElement&&console.warn("The tree item directive should be used once per element"),a.htmlElement=e)};return s(t),{update:s,destroy:r}}),v=e=>{var t;if(e){const a=(t=l(e))==null?void 0:t.htmlElement;if(a){const r=N().indexOf(a);S(r,0)}}},q=x(e=>({events:{focus:()=>{const{item:t}=e();g.set(t)},click:()=>{const{item:t}=e();d(t)},keydown:t=>{var a,r;const{key:s}=t,{item:n}=e(),b=n.isExpanded;switch(k(),s){case"Enter":case" ":d(n);break;case"ArrowLeft":b?d(n):v((a=l(n))==null?void 0:a.parent);break;case"ArrowRight":b?v((r=n.children)==null?void 0:r[0]):d(n);break;default:return}t.preventDefault(),t.stopPropagation()}},attributes:{"aria-label":i(()=>{const{item:t}=e();return D()(t.ariaLabel)}),tabindex:i(()=>{const{item:t}=e();return t===g()?"0":"-1"}),type:"button"},classNames:{"au-tree-expand-icon":!0,"au-tree-expand-icon-expanded":i(()=>{c();const{item:t}=e();return t.isExpanded??!1})}})),d=e=>{l(e)===void 0||e.isExpanded===void 0||(e.isExpanded=!e.isExpanded,c.set({}),w()(e))};return{...R({normalizedNodes$:m,expandedMap$:L,...y}),patch:A,api:{},directives:{navigationDirective:U(_,H),itemToggleDirective:V(O,q),itemAttributesDirective:x(e=>({attributes:{role:"treeitem","aria-selected":"false","aria-expanded":i(()=>{var t;const{item:a}=e();return c(),(t=a.isExpanded)==null?void 0:t.toString()})}}))}}}export{te as c};
