import{E as d,F as q,aa as Q,a8 as z}from"./AppCommon-Cd2V92GK.js";import{t as A,a as f,d as X}from"./writables-DoU_XYTX-CyXwBtTT.js";import{a as N}from"./promise-CY2U8bTP-DnAuZGpf.js";import{b as m,w as Y,z as Z,A as F,s as T,a as nn,d as en,B as tn}from"./directive-DwbtadSh-BZ7DGJEn.js";const R=new Promise(m),sn=async(b,$)=>{b.style.display=$==="show"?"":"none"},on={animated:!0,animatedOnInit:!1,initDone:null,visible:!0,transition:sn,onShown:m,onHidden:m,onVisibleChange:m},ln={animated:A,animatedOnInit:A,visible:A,transition:f,onShown:f,onHidden:f,onVisibleChange:f,initDone:X},un=b=>{const[{animated$:$,initDone$:h,visible$:c,transition$:U,onShown$:W,onHidden$:_,onVisibleChange$:j,animatedOnInit$:k},C]=Y(on,b,ln),{element$:w,directive:G}=Z(),S=d(()=>!!w()),u=F(j,[c],([n])=>n),a=q(null),y=d(()=>!!a()),x=()=>{let n;return a.update(e=>(e==null||e.abort.abort(),n=e==null?void 0:e.context,null)),n},J=(n,e,o,i)=>z(()=>{const p=new AbortController,s=p.signal,l=x()??{},{promise:r,resolve:V}=N(),v={abort:p,animated:e,visible:n,context:l,element:o,transitionFn:i,promise:r};return a.set(v),V((async()=>{var I;try{await i(o,n?"show":"hide",e,s,l)}finally{s.aborted?await R:(a.set(null),(I=(n?W:_)())==null||I())}})()),v}),K=d(()=>!y()&&u()&&S()),L=d(()=>!y()&&!u()),O=d(()=>h()?$():k()),g=q(null);let P,B=c(),t=null;const E=Q([u,w,O,g,U,a],([n,e,o,i,p,s])=>{const l=P!==e;P=e;const r=B!==n;if(B=n,e){h()==null&&h.set(!0);const V=i!=null&&s&&s.animated!=i;if(l||r||V){(r||i!=null)&&(t=null);const v=i??(t==null?void 0:t.animated)??(l&&!n?!1:o);s=J(n,v,e,p),t==null||t.resolve(s.promise),t=null}}else l&&(x(),s=null),(r||n&&(t==null?void 0:t.animated)!==i)&&(t=n&&i!=null?{animated:i,...N()}:null);return(t==null?void 0:t.promise)??(s==null?void 0:s.promise)});let H={};const D=async(n=!c(),e=O())=>{const o={};H=o;try{await z(()=>{try{return g.set(e),c.set(n),E()}finally{g.set(null)}})}finally{H!==o&&await R}},M=nn(G,tn(C),en(E));return{...T({visible$:u,element$:w,elementPresent$:S,transitioning$:y,shown$:K,hidden$:L}),patch:C,directives:{directive:M},actions:{},api:{show:D.bind(null,!0),hide:D.bind(null,!1),toggle:D}}};export{un as c};
