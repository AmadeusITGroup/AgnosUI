import{ab as u,U as i,W as b,X as W,J as p,I as v}from"./AppCommon-B_pcUxBJ.js";import{i as h}from"./dom-gfxqXJpK-CN5zhQdp.js";import{a as P,f as j}from"./stores-CtF6dy3A.js";import{f as O}from"./index-client-B2BTts_b.js";const l=(t,e,o=1/0)=>{if(e!==void 0)if(typeof e=="object"&&e&&o>=1){t||(t={});for(const n of Object.keys(e))Object.prototype.hasOwnProperty.call(e,n)&&(n==="__proto__"||n==="constructor"||(t[n]=l(t[n],e[n],o-1)))}else return e;return t},w=(t,e=h)=>{const o=u({}),n=e===h?t:i(()=>e(l({},t==null?void 0:t(),2)));return b(i(()=>l(l({},n==null?void 0:n(),2),o(),2)),{...o,own$:o,adaptedParent$:n,parent$:t})};function F(t,e){return o=>{const n=j(t,o);t=o,n&&e(n)}}const x=(t,e)=>e?(...o)=>{t(...o),e(...o)}:t,_=(t,e)=>{const o=u(e,{equal:Object.is});return b(i(()=>x(t,o())),{set:o.set,update:o.update})},S=t=>{const{factory:e,defaultConfig:o,widgetConfig:n,events:c,enablePatchChanged:s}=t,a=t.props??{},y=P(o),g={...a};if(c)for(const r of Object.keys(c))g[r]=_(c[r],a[r]);const f=e({config:i(()=>({...y(),...n==null?void 0:n()})),props:g}),m=Object.fromEntries(Object.entries(f.stores).map(([r,d])=>[r.slice(0,-1),O(d)]));if(s){const r=F(a,f.patch);W(()=>{r({...t.props})})}return{api:f.api,directives:f.directives,state:new Proxy(m,{get(r,d,C){if(Reflect.has(r,d))return Reflect.get(r,d,C).current}})}},k=(t=Symbol("widgetsConfig"))=>{const e=c=>{const s=p(t),a=w(s,c);return v(t,a),a},o=c=>{const s=p(t);return i(()=>s==null?void 0:s()[c])};return{widgetsDefaultConfigKey:t,createWidgetsDefaultConfig:e,getContextWidgetConfig:o,callWidgetFactory:c=>S({factory:c.factory,defaultConfig:c.defaultConfig,widgetConfig:c.widgetName?o(c.widgetName):null,events:c.events,get props(){return c.props},enablePatchChanged:c.enablePatchChanged})}},{callWidgetFactory:N}=k();export{N as c,k as w};
