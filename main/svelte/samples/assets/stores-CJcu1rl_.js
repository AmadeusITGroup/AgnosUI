import{W as d,a7 as p,a9 as u,ab as g,aa as m,ac as v,ad as w,a8 as D,a6 as S}from"./AppCommon-wWEJ6LdR.js";import{i as V,k as O}from"./dom-BB9jLllr-CeqtqeKx.js";const h=Symbol();function W(e){return function(t){D(()=>{var a;for(const[s,n]of Object.entries(t))(a=e[`${s}$`])==null||a.set(n)})}}function j(e,t){if(e===t)return null;let a=!1;const s={},n=new Set([...Object.keys(e),...Object.keys(t)]);for(const r of n){const o=t[r];e[r]!==o&&(s[r]=o,a=!0)}return a?s:null}function I(e,t=d(void 0),a={},s=S(void 0)){const{normalizeValue:n=V,equal:r=Object.is}=a,o=()=>e,i=(c,l=o)=>{const b=c===void 0?void 0:n(c);return b===h?(console.error("Not using invalid value",c),l()):b===void 0?l():b},f=u(()=>i(t()),{equal:r}),k=u(()=>i(s(),f),{equal:r});return m(k,c=>{if(c!==void 0){const l=n(c);if(l===h){console.error("Not setting invalid value",c);return}c=l}s.set(c)})}const y=e=>!!(e&&typeof e=="function"&&"subscribe"in e),$=e=>y(e)?e:d(e),z=e=>y(e)?e:S(e),N=(e,t)=>{const a={};if(t){const s=y(t);for(const n of e)a[n]=s?u(()=>t()[n]):$(t[n])}return a},E=(e,t,a)=>{const s={};for(const n of e){const r=t==null?void 0:t[n],o=a==null?void 0:a[n];s[n]=r&&o?u(()=>r()??o()):r||o}return s},q=(e,t,a)=>{const s={},n=Object.keys(e),r=N(n,t==null?void 0:t.config),o=t==null?void 0:t.props;for(const i of n){const f=o==null?void 0:o[i];s[`${i}$`]=I(e[i],r[i],a==null?void 0:a[i],z(f))}return s},L=(e,t,a)=>{const s=q(e,t,a);return[s,W(s)]},R=e=>{const t=[],a=[],s={};for(const[n,r]of Object.entries(e))n.endsWith("$")&&(t.push(n.substring(0,n.length-1)),a.push(r),s[n]=p(r));return{stores:s,state$:u(()=>{const n=a.map(g),r={};return t.forEach((o,i)=>{r[o]=n[i]}),r})}},U=(e,t,a=n=>n[0],s=(n,r)=>r===n)=>{let n=t[0]();return m(v(t,{derive(r){const o=a(r),i=!s(r[0],o);return i&&t[0].set(o),(i||!s(n,o))&&(n=o,e()(o)),o},equal:s}),t[0].set.bind(t[0]))},_=(e,t,a=V,s=w)=>m(u(()=>a(e()),{equal:s}),n=>{const r=a(n);s(e(),r)||(e.set(r),t()(r))});function F(e){const t=u(()=>O());return u(()=>e()||t())}const B=d(!0);d(!1);export{h as I,$ as a,q as b,y as c,U as d,_ as e,j as f,F as i,E as m,N as n,R as s,B as t,L as w};
