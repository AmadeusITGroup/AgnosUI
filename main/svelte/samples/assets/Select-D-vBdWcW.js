import{a0 as p,ae as $e,a1 as ne,$ as g,af as Fe,p as ke,O as Y,K as ye,f as J,e as P,h as Q,Q as re,s as le,j as Se,d as M,a as Le,q as de,t as pe,n as me,g as k,L as Z}from"./AppCommon-CktIYRS0.js";import{a as m}from"./actions-CyAa2qxk.js";import{S as ce}from"./Slot-DtZ_5PbW.js";import{c as Te}from"./config-eOMZjSHZ.js";import{c as Ne,o as Pe,a as De,b as Me}from"./floatingUI-CeAseSla.js";import{c as Ae}from"./focustrack-BVhgrKVi.js";import{c as Ee}from"./navManager-DM6NtsTL.js";import{n as ee,g as Oe,m as He,a as D,o as We,c as G}from"./dom-gfxqXJpK-DHjn65Yu.js";import{w as Be,e as Re,d as qe,s as ze,t as te}from"./stores-oih0Gj_W.js";import{c as Ue}from"./widget-vjc6u9aX.js";import{e as je}from"./extendWidget-slkbMRtf.js";const Qe={id:void 0,ariaLabel:"Select",open:!1,disabled:!1,items:[],filterText:"",loading:!1,selected:[],navSelector:n=>n.querySelectorAll(".au-select-badge,input"),itemIdFn:n=>""+n,onOpenChange:ee,onFilterTextChange:ee,onSelectedChange:ee,allowedPlacements:["bottom-start","top-start","bottom-end","top-end"],className:"",menuClassName:"",menuItemClassName:"",badgeClassName:""},Ge=Ue("select",n=>{const[{id$:r,open$:C,filterText$:v,items$:q,itemIdFn$:A,onOpenChange$:w,onFilterTextChange$:K,onSelectedChange$:d,allowedPlacements$:E,navSelector$:_,className$:O,badgeClassName$:S,ariaLabel$:L,menuClassName$:T,...N},H]=Be(Qe,n),{selected$:x}=N,u=p(()=>r()??Oe()),W=Re(v,K),{hasFocus$:z,directive:V}=Ae(),h=qe(w,[C,z],([e,t])=>e&&t),s=p(()=>{const e=new Map,t=A();for(const i of x()){const f=t(i);e.set(f,{item:i,id:t(i),selected:!0})}return e}),o=p(()=>[...s().values()]),a=function(){const e=$e(0);return ne(e,t=>{const{length:i}=l();t!=null&&(i?t<0?t=i-1:t>=i&&(t=0):t=void 0),e.set(t)})}(),b=p(()=>{const e=new Map;if(h()){const t=s(),i=A();for(const f of q()){const F=i(f);e.set(F,{item:f,id:F,selected:t.has(F)})}}return e}),l=p(()=>h()?[...b().values()]:[]),I=p(()=>{const e=l(),t=a();return e.length&&t!=null?e[t]:void 0}),{directives:{floatingDirective:B,referenceDirective:X},stores:{placement$:$}}=Ne({props:{computePositionOptions:ne(p(()=>({middleware:[Pe(5),De({allowedPlacements:E()}),Me()]})))}}),{directive:R,refreshElements:U,focusFirst:ue,focusLast:fe,focusLeft:se,focusRight:ae}=Ee(),ge=p(()=>({keys:{Home:ue,End:fe,ArrowLeft:se,ArrowRight:ae},selector:_()})),ie=(e,t)=>{const i=e.target;U(),c.api.unselect(t),i instanceof HTMLElement&&setTimeout(()=>{se({event:e,referenceElement:i})||ae({event:e,referenceElement:i})}),e.preventDefault()},ve=D(()=>({attributes:{role:g("combobox"),"aria-haspopup":g("listbox"),"aria-expanded":p(()=>`${h()}`),"aria-controls":p(()=>`${u()}-menu`)}})),he=D(e=>({attributes:{tabindex:g(-1),class:S},classNames:{"au-select-badge":te},events:{keydown:t=>{let i=!1;switch(t.key){case"Backspace":case"Delete":{ie(t,e().item),i=!0;break}}i&&t.preventDefault()}}})),be=D(()=>({attributes:{role:g("listbox"),id:p(()=>`${u()}-menu`),"data-popper-placement":$,class:T},events:{mousedown:e=>e.preventDefault()}})),xe=D(e=>({attributes:{role:g("option"),"aria-selected":p(()=>`${e().selected}`),style:g("cursor: pointer")},classNames:{"au-select-item":te,selected:p(()=>e().selected)},events:{click:()=>c.api.toggleItem(e().item)}})),Ce=D(()=>({attributes:{id:u,type:g("text"),"aria-label":L,"aria-autocomplete":g("list"),autocorrect:g("off"),autocapitalize:g("none"),autocomplete:g("off")},classNames:{"au-select-input":te},events:{input:e=>{const t=e.target.value;Fe(()=>{h.set(t!=null&&t!==""),W.set(t)})},keydown:({ctrlKey:e,key:t,preventDefault:i})=>{let f=!0;switch(t){case"ArrowDown":{h()?e?c.api.highlightLast():c.api.highlightNext():(c.api.open(),c.api.highlightFirst());break}case"ArrowUp":e?c.api.highlightFirst():c.api.highlightPrevious();break;case"Enter":{const F=I();F&&c.api.toggleItem(F.item);break}case"Escape":h.set(!1);break;default:f=!1}f&&i()}}})),we=D(e=>({events:{click:t=>{ie(t,e().item)}}})),c={...ze({id$:u,visibleItems$:l,highlighted$:I,open$:h,selectedContexts$:o,filterText$:W,placement$:$,className$:O,badgeClassName$:S,ariaLabel$:L,menuClassName$:T,...N}),patch:H,api:{clear(){x.set([])},select(e){c.api.toggleItem(e,!0)},unselect(e){c.api.toggleItem(e,!1)},toggleItem(e,t){const i=A(),f=i(e),j=s().has(f);t==null&&(t=!j),!(t&&!b().has(f)||!t&&!j)&&x.update(y=>{var oe;if(y=[...y],t&&!j)y.push(e);else if(!t&&j){const _e=y.findIndex(Ie=>i(Ie)===f);y.splice(_e,1)}return(oe=d())==null||oe(y),y})},clearText(){},highlight(e){const t=l().findIndex(i=>i.item===e);a.set(t===-1?void 0:t)},highlightFirst(){a.set(0)},highlightPrevious(){a.update(e=>e!=null?e-1:-1)},highlightNext(){a.update(e=>e!=null?e+1:1/0)},highlightLast(){a.set(-1)},open:()=>c.api.toggle(!0),close:()=>c.api.toggle(!1),toggle(e){h.update(t=>e??!t)}},directives:{hasFocusDirective:V,floatingDirective:B,referenceDirective:X,inputContainerDirective:He(We(R,ge),ve),badgeAttributesDirective:he,menuAttributesDirective:be,itemAttributesDirective:xe,inputDirective:Ce,badgeCloseButtonDirective:we}};return c}),Je={badgeLabel:({itemContext:n})=>n.item,itemLabel:({itemContext:n})=>n.item},Ke=je(Ge,Je),Ve=Ke,Xe=(n,r)=>{let C=()=>r==null?void 0:r().itemContext;var v=de();pe(()=>me(v,C().item)),M(n,v)},Ye=(n,r)=>{let C=()=>r==null?void 0:r().itemContext;var v=de();pe(()=>me(v,C().item)),M(n,v)};var Ze=J("<div><!></div>"),et=J("<li><!></li>"),tt=J("<ul></ul>"),st=J("<div><div><!> <input/></div> <!></div>");function ft(n,r){ke(r,!0);let C=Y(r,"open",15,!1),v=Y(r,"filterText",15),q=Y(r,"selected",15),A=ye(r,["$$slots","$$events","$$legacy","open","filterText","selected"]);const w=Te(Ve,{get props(){return{...A,open:C(),filterText:v(),selected:q()}},defaultConfig:{badgeLabel:Xe,itemLabel:Ye},events:{onOpenChange(s){C(s)},onSelectedChange:s=>{q(s)},onFilterTextChange:s=>{v(s)}}}),K=w.api,{state:d,directives:{floatingDirective:E,hasFocusDirective:_,referenceDirective:O,inputContainerDirective:S,badgeAttributesDirective:L,menuAttributesDirective:T,itemAttributesDirective:N,inputDirective:H}}=w;var x=st();P(x,s=>({...s}),[()=>({})]);var u=Q(x);P(u,s=>({...s}),[()=>({})]);var W=Q(u);re(W,17,()=>d.selectedContexts,s=>s.id,(s,o)=>{var a=Ze();P(a,I=>({...I}),[()=>({})]);var b=Q(a);const l=Z(()=>({state:d,directives:w.directives,api:w.api,itemContext:k(o)}));ce(b,{get content(){return d.badgeLabel},get props(){return k(l)}}),m(a,(I,B)=>L==null?void 0:L(I,B),()=>k(o)),M(s,a)});var z=le(W,2);P(z,s=>({value:d.filterText,...s}),[()=>({})]),m(z,s=>H==null?void 0:H(s)),m(u,s=>_==null?void 0:_(s)),m(u,s=>S==null?void 0:S(s)),m(u,(s,o)=>{var a;return(a=G)==null?void 0:a(s,o)},()=>"d-flex align-items-center flex-wrap gap-1");var V=le(u,2);{var h=s=>{var o=tt();P(o,a=>({...a}),[()=>({})]),re(o,21,()=>d.visibleItems,a=>a.id,(a,b)=>{var l=et();const I=Z(()=>k(b)===d.highlighted);P(l,$=>({...$}),[()=>({})]);var B=Q(l);const X=Z(()=>({state:d,directives:w.directives,api:w.api,itemContext:k(b)}));ce(B,{get content(){return d.itemLabel},get props(){return k(X)}}),m(l,($,R)=>{var U;return(U=G)==null?void 0:U($,R)},()=>["dropdown-item position-relative",{"text-bg-primary":k(I)}]),m(l,($,R)=>N==null?void 0:N($,R),()=>k(b)),M(a,l)}),m(o,a=>_==null?void 0:_(a)),m(o,a=>E==null?void 0:E(a)),m(o,a=>T==null?void 0:T(a)),m(o,(a,b)=>{var l;return(l=G)==null?void 0:l(a,b)},()=>"dropdown-menu show"),M(s,o)};Se(V,s=>{d.open&&d.visibleItems.length>0&&s(h)})}return m(x,s=>O==null?void 0:O(s)),m(x,(s,o)=>{var a;return(a=G)==null?void 0:a(s,o)},()=>"au-select dropdown border border-1 p-1 mb-3 d-block "+d.className),M(n,x),Le({api:K})}export{ft as S};
