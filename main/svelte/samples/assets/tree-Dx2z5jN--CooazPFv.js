import{a6 as v,a9 as i}from"./AppCommon-ZwIOf5HX.js";import{c as z}from"./navManager-Cw2_7b0f.js";import{w as B,s as R,B as U,m as V,a as x,b as j,n as G}from"./stores-DX-ADOKq-CL6jUnRu.js";import{b as J,h as K,a as p}from"./writables-DCiBdIBK-BkdelxAY.js";const Q={className:"",nodes:[],onExpandToggle:G,navSelector:o=>o.querySelectorAll("button"),ariaLabelToggleFn:o=>`Toggle ${o}`},W={className:J,nodes:K,onExpandToggle:p,navSelector:p,ariaLabelToggleFn:p};function te(o){const[{nodes$:h,onExpandToggle$:w,navSelector$:T,ariaLabelToggleFn$:D,...y},A]=B(Q,o,W),u=new Map,I={get(e){return e.isExpanded}},c=v({}),L=i(()=>(f(),c(),I)),{elementsInDomOrder$:N,directive:_,refreshElements:k,focusIndex:S,focusPrevious:$,focusNext:F,focusFirst:M,focusLast:P}=z(),H=i(()=>({keys:{ArrowUp:$,ArrowDown:F,Home:M,End:P},selector:T()})),m=(e,t,n)=>{var a;const s={...e,ariaLabel:e.ariaLabel??e.label,level:t,children:[],isExpanded:(a=e.children)!=null&&a.length?e.isExpanded??!1:void 0};return u.set(s,{parent:n}),e.children&&(s.children=e.children.map(r=>m(r,t+1,s))),s},f=i(()=>(u.clear(),h().map(e=>m(e,0,void 0)))),g=v(f().find(e=>e.isExpanded!==void 0)),d=e=>{const t=u.get(e);return t||console.error(`Node ${e.label} doesn't exist in the map`),t},O=j((e,t)=>{let n;const a=()=>{n&&n.htmlElement===e&&(n.htmlElement=void 0),n=void 0},s=r=>{a(),n=d(r.item),n&&(n.htmlElement&&console.warn("The tree item directive should be used once per element"),n.htmlElement=e)};return s(t),{update:s,destroy:a}}),b=e=>{var t;if(e){const n=(t=d(e))==null?void 0:t.htmlElement;if(n){const a=N().indexOf(n);S(a,0)}}},q=x(e=>({events:{focus:()=>{const{item:t}=e();g.set(t)},click:()=>{const{item:t}=e();l(t)},keydown:t=>{var n,a;const{key:s}=t,{item:r}=e(),E=r.isExpanded;switch(k(),s){case"Enter":case" ":l(r);break;case"ArrowLeft":E?l(r):b((n=d(r))==null?void 0:n.parent);break;case"ArrowRight":E?b((a=r.children)==null?void 0:a[0]):l(r);break;default:return}t.preventDefault(),t.stopPropagation()}},attributes:{"aria-label":i(()=>{const{item:t}=e();return D()(t.ariaLabel)}),tabindex:i(()=>{const{item:t}=e();return t===g()?"0":"-1"}),type:"button"},classNames:{"au-tree-expand-icon":!0,"au-tree-expand-icon-expanded":i(()=>{c();const{item:t}=e();return t.isExpanded??!1})}})),l=e=>{d(e)===void 0||e.isExpanded===void 0||(e.isExpanded=!e.isExpanded,c.set({}),w()(e))};return{...R({normalizedNodes$:f,expandedMap$:L,...y}),patch:A,api:{},directives:{navigationDirective:U(_,H),itemToggleDirective:V(O,q),itemAttributesDirective:x(e=>({attributes:{role:"treeitem","aria-selected":"false","aria-expanded":i(()=>{var t;const{item:n}=e();return c(),(t=n.isExpanded)==null?void 0:t.toString()})}}))}}}export{te as c};
