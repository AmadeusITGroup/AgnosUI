import{af as D,a0 as I}from"./AppCommon-D-Irf_br.js";import{r as S,p as $,b}from"./dom-Bcg9ORcA-CPWV9YZz.js";import{i as x}from"./isFocusable-Ckwus82R-adOM025a.js";const E=(r,e)=>{if(r===e)return 0;const s=r.compareDocumentPosition(e);if(s&Node.DOCUMENT_POSITION_FOLLOWING)return-1;if(s&Node.DOCUMENT_POSITION_PRECEDING)return 1;throw new Error("failed to compare elements")},N=r=>getComputedStyle(r).direction,F=new Set(["text","search","url","tel","password"]),R=r=>r instanceof HTMLInputElement&&F.has(r.type),T=r=>{let e=r.key;return r.shiftKey&&(e=`Shift+${e}`),r.altKey&&(e=`Alt+${e}`),r.ctrlKey&&(e=`Ctrl+${e}`),r.metaKey&&(e=`Meta+${e}`),e},P=r=>{const{target:e,key:s}=r;if(R(e)&&(s==="ArrowLeft"||s==="ArrowRight"||s==="Home"||s==="End")){let a;if(s==="ArrowLeft"||s==="ArrowRight"){const i=N(e);a=s===(i==="ltr"?"ArrowLeft":"ArrowRight")}else a=s==="Home";const f=e.selectionStart===e.selectionEnd?e.selectionStart:null;if(a&&f!==0||!a&&f!==e.value.length)return!0}return!1},C=r=>[r],q=()=>{const r=S(),e=D({}),s=(t=!0)=>{e.set({}),t&&(f(),i())},a=I(()=>{e();const t=[];for(const o of r())t.push(...o());return t}),f=I(()=>$(a()),{equal:Object.is}),i=I(()=>[...a()].sort(E)),l=()=>{const t=f();return t?N(t):"ltr"},p=(t,o)=>(t&&o?.preventDefault(),t),h=(t,o=0)=>{const c=i();for(;t>=0&&t<c.length;){const n=c[t];if(x(n)){if(n.focus(),o!=0&&R(n)){const u=l()!==N(n),m=o>0!==u?0:n.value.length;n.setSelectionRange(m,m,m===0?"forward":"backward")}return n}if(o===0)break;t+=o}return null},L=t=>({event:o,referenceElement:c=o?.target??document.activeElement}={})=>{const n=c?i().indexOf(c):-1;return n>-1?p(h(n+t,t),o):null},k=b((t,o)=>{const c=u=>{if(P(u))return;const m=T(u),A=o.keys?.[m];A&&(s(!1),A({event:u,directiveElement:t,navManager:O,context:o.context}))};t.addEventListener("keydown",c);const n=r.register(()=>(o?.selector??C)(t));return{update(u){o=u},destroy(){t.removeEventListener("keydown",c),n()}}}),d=L(-1),g=L(1),w=({event:t}={})=>p(h(0,1),t),y=({event:t}={})=>p(h(i().length-1,-1),t),O={elementsInDomOrder$:i,directive:k,focusIndex:h,focusPrevious:d,focusNext:g,focusFirst:w,focusFirstLeft:(...t)=>(l()==="rtl"?y:w)(...t),focusFirstRight:(...t)=>(l()==="rtl"?w:y)(...t),focusLast:y,focusLeft:(...t)=>(l()==="rtl"?g:d)(...t),focusRight:(...t)=>(l()==="rtl"?d:g)(...t),refreshElements:s};return O};export{q as c};
