import{C as U,b as c,w as B,z as X,m as Y,e as E,k as Z,n as b}from"./dom-BPD8lUxd-BmYWB-gd.js";import{g as _,b as m,c as A}from"./writables-DYGjj5T3-rf9CR7xD.js";import{p as k}from"./promise-D-RZVPuv-CKesYrIM.js";import{w as F,d as T,s as ee}from"./stores-CmUTCjpT.js";const q=new Promise(b),ne=($,h)=>{$.style.display=h==="show"?"":"none"},te={animated:!0,animatedOnInit:!1,initDone:null,visible:!0,transition:ne,onShown:b,onHidden:b,onVisibleChange:b},ie={animated:A,animatedOnInit:A,visible:A,transition:m,onShown:m,onHidden:m,onVisibleChange:m,initDone:_},re=$=>{const[{animated$:h,initDone$:w,visible$:d,transition$:z,onShown$:N,onHidden$:R,onVisibleChange$:W,animatedOnInit$:j},G]=F(te,$,ie),{element$:v,directive:J}=U(),y=c(()=>!!v()),u=T(W,[d],([e])=>e),l=B(null),x=()=>{let e;return l.update(n=>(n?.abort.abort(),e=n?.context,null)),e},K=(e,n,o,t)=>E(()=>{const p=new AbortController,i=p.signal,a=x()??{},{promise:r,resolve:S}=k(),f={abort:p,animated:n,visible:e,context:a,element:o,transitionFn:t,promise:r};return l.set(f),S((async()=>{try{await t(o,e?"show":"hide",n,i,a)}finally{i.aborted?await q:(l.set(null),(e?N:R)()?.())}})()),f}),O=c(()=>w()?h():j()),g=B(null);let P,H=d(),s=null;const C=X([u,v,O,g,z,l],([e,n,o,t,p,i])=>{const a=P!==n;P=n;const r=H!==e;if(H=e,n){w()==null&&w.set(!0);const S=t!=null&&i&&i.animated!=t;if(a||r||S){(r||t!=null)&&(s=null);const f=t??s?.animated??(a&&!e?!1:o);i=K(e,f,n,p),s?.resolve(i.promise),s=null}}else a&&(x(),i=null),(r||e&&s?.animated!==t)&&(s=e&&t!=null?{animated:t,...k()}:null);return s?.promise??i?.promise});let I={};const D=async(e=!d(),n=O())=>{const o={};I=o;try{await E(()=>{try{return g.set(n),d.set(e),C()}finally{g.set(null)}})}finally{I!==o&&await q}},V=c(()=>(y()&&C(),!!l())),L=c(()=>!V()&&u()&&y()),M=c(()=>!V()&&!u()),Q=Y(J,Z(C));return{...ee({visible$:u,element$:v,elementPresent$:y,transitioning$:V,shown$:L,hidden$:M}),patch:G,directives:{directive:Q},api:{show:D.bind(null,!0),hide:D.bind(null,!1),toggle:D}}};export{re as c};
