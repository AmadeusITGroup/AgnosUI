import{h as m,w as X,c as Y,a as d,i as Z,f as N,d as _,s as F,o as R,m as T,b as ee,A as te}from"./utils-5008118f.js";import{t as C,a as h,f as se}from"./writables-57ac5d4a.js";import{b as U}from"./promise-803e54ea.js";const W=new Promise(m),oe=async($,p)=>{$.style.display=p==="show"?"":"none"},le={animation:!0,animationOnInit:!1,initDone:null,visible:!0,transition:oe,onShown:m,onHidden:m,onVisibleChange:m},ne={animation:C,animationOnInit:C,visible:C,transition:h,onShown:h,onHidden:h,onVisibleChange:h,initDone:se},de=$=>{const[{animation$:p,initDone$:v,visible$:u,transition$:g,onShown$:j,onHidden$:k,onVisibleChange$:z,animationOnInit$:G},S]=X(le,$,ne),{element$:w,directive:J}=Y(),x=d(()=>!!w()),f=Z(z,[u],([e])=>e),i=N(null),y=d(()=>!!i()),O=()=>{let e;return i.update(t=>(t==null||t.abort.abort(),e=t==null?void 0:t.context,null)),e},K=(e,t,n,l)=>R(()=>{const b=new AbortController,o=b.signal,a=O()??{},{promise:c,resolve:A}=U(),r={abort:b,animation:t,visible:e,context:a,element:n,transitionFn:l,promise:c};return i.set(r),A((async()=>{var q;try{await l(n,e?"show":"hide",t,o,a)}finally{o.aborted?await W:(i.set(null),(q=(e?j:k)())==null||q())}})()),r}),L=d(()=>!y()&&f()&&x()),M=d(()=>!y()&&!f()),P=d(()=>v()?p():G()),D=N(null);let H,I=u(),s=null;const B=_([f,w,P,D,g,i],([e,t,n,l,b,o])=>{const a=H!==t;H=t;const c=I!==e;if(I=e,t){v()==null&&v.set(!0);const A=l!=null&&o&&o.animation!=l;if(a||c||A){(c||l!=null)&&(s=null);const r=l??(s==null?void 0:s.animation)??(a&&!e?!1:n);o=K(e,r,t,b),s==null||s.resolve(o.promise),s=null}}else a&&(O(),o=null),(c||e&&(s==null?void 0:s.animation)!==l)&&(s=e&&l!=null?{animation:l,...U()}:null);return(s==null?void 0:s.promise)??(o==null?void 0:o.promise)});let E={};const V=async(e=!u(),t=P())=>{const n={};E=n;try{await R(()=>{try{return D.set(t),u.set(e),B()}finally{D.set(null)}})}finally{E!==n&&await W}},Q=T(J,te(S),ee(B));return{...F({visible$:f,element$:w,elementPresent$:x,transitioning$:y,shown$:L,hidden$:M}),patch:S,directives:{directive:Q},actions:{},api:{show:V.bind(null,!0),hide:V.bind(null,!1),toggle:V}}};export{de as c};
