var ie=(t,e,s)=>{if(!e.has(t))throw TypeError("Cannot "+s)};var o=(t,e,s)=>(ie(t,e,"read from private field"),s?s.call(t):e.get(t)),l=(t,e,s)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,s)},a=(t,e,s,n)=>(ie(t,e,"write to private field"),n?n.call(t,s):e.set(t,s),s);var pe=(t,e,s,n)=>({set _(r){a(t,e,r,s)},get _(){return o(t,e,n)}}),f=(t,e,s)=>(ie(t,e,"access private method"),s);import{r as y}from"./index-36fc15f3.js";const ft=t=>({actions:t.actions,api:t.api,directives:t.directives,state$:t.state$,stores:t.stores}),ye=Symbol();var Se;const se=typeof Symbol=="function"&&Symbol.observable||"@@observable",ae=Symbol(),w=()=>{},J=()=>{};J.unsubscribe=J;const ue=(t,e)=>{const s=t?t[e]:null;return typeof s=="function"?s.bind(t):w},_e=t=>({next:typeof t=="function"?t.bind(null):ue(t,"next"),pause:ue(t,"pause"),resume:ue(t,"resume"),_value:void 0,_valueIndex:0,_paused:!1}),ke=function(){return this},le=t=>{if(!t)return J;if(t.unsubscribe===t)return t;const e=typeof t=="function"?()=>t():()=>t.unsubscribe();return e.unsubscribe=e,e},ce=new WeakSet,We=t=>{let e=t.subscribe;return ce.has(e)||(e=(...s)=>le(t.subscribe(...s)),ce.add(e)),e},ne=t=>{const e="subscribe"in t?t:t[se]();return We(e)},je=t=>{let e;return t(s=>e=s)(),e};function I(t,e){const s=ne(t),n=Object.assign(()=>de(n),e,{subscribe:s,[se]:ke});return n}const me=function(t){this.set(t(Ve(()=>de(this))))};function Ne(t,e){return I(t,typeof e=="function"?{set:e,update:me}:{...e,set:(e==null?void 0:e.set)??w,update:(e==null?void 0:e.update)??(e!=null&&e.set?me:w)})}const p=Symbol(),qe=Symbol();let oe=!1;const Q=new Set,Me=1e3,fe=t=>{if(t>Me)throw new Error("reached maximum number of store changes in one shot")},A=t=>{const e=!oe;e&&(oe=!0);try{return t()}finally{if(e)try{const s=new Map;for(const n of Q){const r=s.get(n)??0;fe(r),s.set(n,r+1),Q.delete(n),n[qe]()}}finally{Q.clear(),oe=!1}}},we=t=>je(ne(t));let W=we;const de=t=>W(t),ge=t=>({[t]:!0,[t-1]:!1,0:!1}),O=Symbol(),Ee=(t,e)=>Object.is(t,e)&&(!t||typeof t!="object")&&typeof t!="function";var m,$,g,k,x,z,N,K,Ue,Y,xe,M,H;class he{constructor(e){l(this,K);l(this,Y);l(this,M);l(this,m,void 0);l(this,$,void 0);l(this,g,void 0);l(this,k,void 0);l(this,x,void 0);l(this,z,void 0);l(this,N,void 0);a(this,m,new Set),a(this,$,null),a(this,g,!1),a(this,k,1),a(this,z,ge(1)),a(this,N,new WeakMap),this[Se]=!1,a(this,x,e)}[(Se=O,qe)](){const e=o(this,k);for(const s of[...o(this,m)]){if(o(this,g)||o(this,k)!==e)return;s._valueIndex!==0&&f(this,M,H).call(this,s)}}[p](){}equal(e,s){return!this.notEqual(e,s)}notEqual(e,s){return!Ee(e,s)}pauseSubscribers(){if(!o(this,g)){a(this,g,!0),Q.delete(this);for(const e of[...o(this,m)])e._valueIndex===0||e._paused||(e._paused=!0,e.pause())}}resumeSubscribers(){o(this,g)&&(a(this,g,!1),A(()=>{Q.add(this)}))}set(e){const s=this[O];if(s||!this.equal(o(this,x),e)){const n=o(this,k)+1;a(this,k,n),a(this,x,e),a(this,z,ge(n)),s&&delete o(this,z)[n-1],this.pauseSubscribers()}this.resumeSubscribers()}update(e){this.set(e(o(this,x)))}onUse(){}subscribe(e){const s=_e(e),n=e==null?void 0:e[ae];if(n){const i=o(this,N).get(n);i&&(s._value=i._value,s._valueIndex=i._valueIndex)}o(this,m).add(s),A(()=>{o(this,m).size==1?f(this,K,Ue).call(this):this[p]()}),f(this,M,H).call(this,s);const r=()=>{const i=o(this,m).delete(s);s.next=w,s.pause=w,s.resume=w,i&&(o(this,N).set(r,s),o(this,m).size===0&&f(this,Y,xe).call(this))};return r[p]=()=>{this[p](),f(this,M,H).call(this,s)},r.unsubscribe=r,r}[se](){return this}}m=new WeakMap,$=new WeakMap,g=new WeakMap,k=new WeakMap,x=new WeakMap,z=new WeakMap,N=new WeakMap,K=new WeakSet,Ue=function(){a(this,$,le(this.onUse()))},Y=new WeakSet,xe=function(){const e=o(this,$);e&&(a(this,$,null),e())},M=new WeakSet,H=function(e){const s=o(this,z),n=o(this,k),r=o(this,x);let i=s[e._valueIndex];i==null&&(i=!!this.equal(e._value,r),s[e._valueIndex]=i),e._valueIndex=n,i?!o(this,g)&&e._paused&&(e._paused=!1,e.resume()):(e._value=r,e._paused=!1,e.next(r))};function Oe(t){const e=s=>(s!=null&&s[ae]||_e(s).next(t),J);return ce.add(e),Object.assign(()=>t,{subscribe:e,[se]:ke})}class De extends he{constructor(e){super(e)}set(e){super.set(e)}update(e){super.update(e)}}const re=(t,e)=>{const{onUse:s,equal:n,notEqual:r}=e;return s&&(t.onUse=function(){const i=u=>this.set(u);return i.set=i,i.update=u=>this.update(u),s(i)}),n&&(t.equal=function(i,u){return n(i,u)}),r&&(t.notEqual=function(i,u){return r(i,u)}),t};function be(t,e={}){return typeof e=="function"&&(e={onUse:e}),e.onUse?I(re(new De(t),e)):Oe(t)}function X(t,e={}){typeof e=="function"&&(e={onUse:e});const s=re(new De(t),e);return I(s,{set:s.set.bind(s),update:s.update.bind(s)})}function Te(t){return t.length<=1}const Qe=t=>t();var B,G,S;class Ie extends he{constructor(s,n){super(n);l(this,B,void 0);l(this,G,void 0);l(this,S,0);const r=Array.isArray(s);a(this,B,r),a(this,G,(r?[...s]:[s]).map(ne))}resumeSubscribers(){o(this,S)||super.resumeSubscribers()}onUse(){let s=!1,n=0;const r=o(this,B),i=o(this,G),u=new Array(i.length);let c=null;const h=()=>{const d=c;d&&(c=null,d())},_=(d=!1)=>{d&&(s=!0),s&&!o(this,S)&&(n&&(n=0,h(),c=le(this.derive(r?u:u[0]))),this.resumeSubscribers())},b=i.map((d,C)=>{const U=Fe=>{u[C]=Fe,n|=1<<C,a(this,S,o(this,S)&~(1<<C)),_()};return U.next=U,U.pause=()=>{a(this,S,o(this,S)|1<<C),this.pauseSubscribers()},U.resume=()=>{a(this,S,o(this,S)&~(1<<C)),_()},d(U)}),R=(d,C)=>{var U;o(this,S)&1<<C&&((U=d[p])==null||U.call(d))};return this[p]=()=>{let d=0;for(;o(this,S)&&(fe(++d),s=!1,b.forEach(R),!o(this,S));)_(!0)},_(!0),this[p](),()=>{this[p]=w,h(),b.forEach(Qe)}}}B=new WeakMap,G=new WeakMap,S=new WeakMap;function Le(t,e,s){typeof e=="function"&&(e={derive:e});const{derive:n,...r}=e,i=Te(n)?class extends Ie{constructor(u,c){super(u,c),this[O]=!0}derive(u){this.set(n(u)),this[O]=!1}}:class extends Ie{derive(u){const c=h=>this.set(h);return c.set=c,c.update=h=>this.update(h),n(u,c)}};return I(re(new i(t,s),{...r,onUse:void 0}))}const Ve=t=>{const e=W;try{return W=we,t()}finally{W=e}},Be=({unsubscribe:t})=>t(),Ge=({resubscribe:t})=>t();var E,q,D,v,Z,P,Ae,ee,Re,F,T,V,j,te,Ce;class Xe extends he{constructor(){super(void 0);l(this,P);l(this,ee);l(this,F);l(this,V);l(this,te);l(this,E,!1);l(this,q,!1);l(this,D,0);l(this,v,new Map);l(this,Z,s=>Ve(()=>f(this,ee,Re).call(this,s)));this[O]=!0}resumeSubscribers(){f(this,V,j).call(this)||super.resumeSubscribers()}[p](){var n;if(o(this,E))throw new Error("recursive computed");let s=0;for(;f(this,V,j).call(this);){fe(++s),a(this,q,!0);try{for(const[,{pending:r,unsubscribe:i}]of o(this,v))r&&((n=i[p])==null||n.call(i))}finally{a(this,q,!1)}if(f(this,V,j).call(this))break;f(this,F,T).call(this)}}onUse(){return f(this,F,T).call(this,!0),this[p](),()=>o(this,v).forEach(Be)}}E=new WeakMap,q=new WeakMap,D=new WeakMap,v=new WeakMap,Z=new WeakMap,P=new WeakSet,Ae=function(s){const n={versionIndex:o(this,D),unsubscribe:w,resubscribe:w,pending:!1,usedValueIndex:0,value:void 0,valueIndex:0},r=i=>{n.value=i,n.valueIndex++,n.pending=!1,!o(this,q)&&!f(this,V,j).call(this)&&A(()=>f(this,F,T).call(this))};return r.next=r,r.pause=()=>{n.pending=!0,this.pauseSubscribers()},r.resume=()=>{n.pending=!1,!o(this,q)&&!f(this,V,j).call(this)&&A(()=>f(this,F,T).call(this))},n.resubscribe=()=>{n.unsubscribe=s(r),r[ae]=n.unsubscribe},n.resubscribe(),n},ee=new WeakSet,Re=function(s){var r,i;let n=o(this,v).get(s);return n?(n.versionIndex=o(this,D),(i=(r=n.unsubscribe)[p])==null||i.call(r)):(n=f(this,P,Ae).call(this,ne(s)),o(this,v).set(s,n)),n.usedValueIndex=n.valueIndex,n.value},F=new WeakSet,T=function(s=!1){a(this,E,!0),a(this,q,!0);try{if(o(this,D)>0&&(s&&o(this,v).forEach(Ge),!f(this,te,Ce).call(this))){this.resumeSubscribers();return}pe(this,D)._++;const n=o(this,D),r=W;let i;try{W=o(this,Z),i=this.compute()}finally{W=r}this.set(i),this[O]=!1;for(const[u,c]of o(this,v))c.versionIndex!==n&&(o(this,v).delete(u),c.unsubscribe())}finally{a(this,q,!1),a(this,E,!1)}},V=new WeakSet,j=function(){for(const[,{pending:s}]of o(this,v))if(s)return!0;return!1},te=new WeakSet,Ce=function(){for(const[,{valueIndex:s,usedValueIndex:n}]of o(this,v))if(s!=n)return!0;return!1};function L(t,e={}){const s=class extends Xe{compute(){return t()}};return I(re(new s,{...e,onUse:void 0}))}const He=()=>{},Je=t=>t;function Ke(t){return function(e){A(()=>{var s;for(const[n,r]of Object.entries(e??{}))(s=t[`${n}$`])==null||s.set(r)})}}function $e(t,e){if(t===e)return null;let s=!1;const n={},r=new Set([...Object.keys(t),...Object.keys(e)]);for(const i of r){const u=e[i];t[i]!==u&&(n[i]=u,s=!0)}return s?n:null}function Ye(t,e=be(void 0),s={},n=X(void 0)){const{normalizeValue:r=Je,equal:i=Object.is}=s,u=()=>t,c=(b,R=u)=>{const d=b===void 0?void 0:r(b);return d===ye?(console.error("Not using invalid value",b),R()):d===void 0?R():d},h=L(()=>c(e()),{equal:i}),_=L(()=>c(n(),h),{equal:i});return Ne(_,b=>{if(b!==void 0){const R=r(b);if(R===ye){console.error("Not setting invalid value",b);return}b=R}n.set(b)})}const ve=t=>!!(t&&typeof t=="function"&&"subscribe"in t),Ze=t=>ve(t)?t:be(t),Pe=t=>ve(t)?t:X(t),et=(t,e)=>{const s={};if(e){const n=ve(e);for(const r of t)s[r]=n?L(()=>e()[r]):Ze(e[r])}return s},dt=(t,e,s)=>{const n={};for(const r of t){const i=e==null?void 0:e[r],u=s==null?void 0:s[r];n[r]=i&&u?L(()=>i()??u()):i||u}return n},tt=(t,e,s)=>{const n={},r=Object.keys(t),i=et(r,e==null?void 0:e.config),u=e==null?void 0:e.props;for(const c of r){const h=u==null?void 0:u[c];n[`${c}$`]=Ye(t[c],i[c],s==null?void 0:s[c],Pe(h))}return n},ht=(t,e,s)=>{const n=tt(t,e,s);return[n,Ke(n)]},bt=t=>{const e=[],s=[],n={};for(const r of Object.keys(t))if(r.endsWith("$")){const i=t[r];e.push(r.substring(0,r.length-1)),s.push(i),n[r]=I(i)}return{stores:n,state$:L(()=>{const r=s.map(de),i={};return e.forEach((u,c)=>{i[u]=r[c]}),i})}},vt=(t,e,s=r=>r[0],n=(r,i)=>i===r)=>{let r=e[0]();return Le(e,{derive(i){const u=s(i),c=!n(i[0],u);return c&&e[0].set(u),(c||!n(r,u))&&(r=u,t()(u)),u},equal:n})},st=(t,e)=>s=>{let n=!0,r;const i=e.subscribe(u=>{var c;n?(n=!1,r=t(s,u)):(c=r==null?void 0:r.update)==null||c.call(r,u)});return{destroy(){var u;(u=r==null?void 0:r.destroy)==null||u.call(r),i()}}},nt=be(void 0),pt=t=>st(t,nt),yt=(t,e=!0)=>()=>{const s=t.subscribe(He);return{destroy:async()=>{e&&await 0,s()}}},St=t=>(e,s)=>(t(s),{update:t}),ze={equal:Object.is},rt=()=>{const t=X([],ze);return I(t,{register:e=>{let s=!1;return t.update(n=>[...n,e]),()=>{s||(s=!0,t.update(n=>{const r=n.indexOf(e);if(r>-1){const i=[...n];return i.splice(r,1),i}return n}))}}})},mt=()=>{const t=rt();return{elements$:I(t),directive:e=>({destroy:t.register(e)})}},gt=()=>{const t=X(null,ze);return{element$:I(t),directive:e=>{let s=!1;return t.update(n=>n?(console.error("The directive cannot be used on multiple elements.",n,e),n):(s=!0,e)),s?{destroy(){t.update(n=>e===n?null:n)}}:void 0}}},it=(...t)=>(e,s)=>{const n=A(()=>t.map(r=>r(e,s)));return{update(r){A(()=>n.forEach(i=>{var u;return(u=i==null?void 0:i.update)==null?void 0:u.call(i,r)}))},destroy(){A(()=>n.reverse().forEach(r=>{var i;return(i=r==null?void 0:r.destroy)==null?void 0:i.call(r)}))}}};function It(t,e={},...s){const n=y.useRef(void 0);n.current||(n.current=t(...s),n.current.patch(e));const r=n.current,i=y.useRef(e);return y.useEffect(()=>{const c=$e(i.current,e);i.current=e,c&&r.patch(c)},[e]),[ut(r.state$),r]}function ut(t){const[e,s]=y.useState(()=>t());return y.useEffect(()=>t.subscribe(n=>{s(()=>n)}),[t]),e}function ot(t,e){var i,u;const s=y.useRef(),n=y.useRef(),r=y.useCallback(c=>{var h,_;(_=(h=s.current)==null?void 0:h.destroy)==null||_.call(h),s.current=void 0,c&&(s.current=t(c,n.current))},[t]);return n.current=e,(u=(i=s.current)==null?void 0:i.update)==null||u.call(i,e),r}function _t(t,e){const s=y.useMemo(()=>it(...t),t);return ot(s,e)}const ct=(t,e)=>!$e(t,e),kt=t=>{const e=y.useRef();return e.current||(e.current=X({...t},{equal:ct})),y.useEffect(()=>{e.current.set({...t})},[t]),y.useMemo(()=>I(e.current),[e.current])};export{St as A,Ee as B,I as C,_t as D,ye as I,ut as a,ht as b,L as c,yt as d,He as e,vt as f,be as g,pt as h,tt as i,A as j,mt as k,it as l,dt as m,et as n,st as o,Ne as p,Je as q,rt as r,bt as s,ft as t,ot as u,kt as v,X as w,It as x,gt as y,Le as z};
