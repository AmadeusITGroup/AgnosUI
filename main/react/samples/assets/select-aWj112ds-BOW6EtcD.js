import{r as me,j as r}from"./App-M9-8VOml.js";import{S as J}from"./slot-DAuOEMb2.js";import{a as A,u as M}from"./directive-Ds3K8r_f-Dh7SKN2M.js";import{c as ge}from"./clsx-B-dksMZM.js";import{u as fe}from"./config-MneJLPWz.js";import{b as o,x as he,w as be,d as G,m as ve,a as h,z as xe,r as l,q as $e,n as N,c as P}from"./dom-CzJpOnsw-BpVpkhUo.js";import{c as De,o as we,a as Ce,b as Fe}from"./floatingUI-CMxwAUbj.js";import{c as Ie}from"./focustrack-BoI7jhC0.js";import{c as je}from"./navManager-CyCQH-_r.js";import{w as Se,d as ke,c as ye,s as Ne,t as L}from"./stores-DStrda4r.js";import{c as Le}from"./widget-vd6sDzmv.js";import{e as Ae}from"./extendWidget-Bk4mQ2oI.js";const Pe={id:void 0,ariaLabel:"Select",open:!1,disabled:!1,items:[],filterText:"",loading:!1,selected:[],navSelector:s=>s.querySelectorAll(".au-select-badge,input"),itemIdFn:s=>""+s,onOpenChange:N,onFilterTextChange:N,onSelectedChange:N,allowedPlacements:["bottom-start","top-start","bottom-end","top-end"],className:"",menuClassName:"",menuItemClassName:"",badgeClassName:""},Me=Le("select",s=>{const[{id$:a,open$:u,filterText$:b,items$:g,itemIdFn$:v,onOpenChange$:w,onFilterTextChange$:C,onSelectedChange$:F,allowedPlacements$:I,navSelector$:j,className$:S,badgeClassName$:T,ariaLabel$:E,menuClassName$:B,...O},Q]=Se(Pe,s),{selected$:k}=O,x=o(()=>a()??he()),R=ke(b,C),{hasFocus$:V,directive:X}=Ie(),d=ye(w,[u,V],([e,t])=>e&&t),y=o(()=>{const e=new Map,t=v();for(const i of k()){const c=t(i);e.set(c,{item:i,id:t(i),selected:!0})}return e}),Y=o(()=>[...y().values()]),f=(function(){const e=be(0);return G(e,t=>{const{length:i}=$();t!=null&&(i?t<0?t=i-1:t>=i&&(t=0):t=void 0),e.set(t)})})(),H=o(()=>{const e=new Map;if(d()){const t=y(),i=v();for(const c of g()){const p=i(c);e.set(p,{item:c,id:p,selected:t.has(p)})}}return e}),$=o(()=>d()?[...H().values()]:[]),W=o(()=>{const e=$(),t=f();return e.length&&t!=null?e[t]:void 0}),{directives:{floatingDirective:Z,referenceDirective:K},stores:{placement$:_}}=De({props:{computePositionOptions:G(o(()=>({middleware:[we(5),Ce({allowedPlacements:I()}),Fe()]})))}}),{directive:ee,refreshElements:te,focusFirst:se,focusLast:ie,focusLeft:z,focusRight:q}=je(),ae=o(()=>({keys:{Home:se,End:ie,ArrowLeft:z,ArrowRight:q},selector:j()})),U=(e,t)=>{const i=e.target;te(),n.api.unselect(t),i instanceof HTMLElement&&setTimeout(()=>{z({event:e,referenceElement:i})||q({event:e,referenceElement:i})}),e.preventDefault()},re=h(()=>({attributes:{role:l("combobox"),"aria-haspopup":l("listbox"),"aria-expanded":o(()=>`${d()}`),"aria-controls":o(()=>`${x()}-menu`)}})),ne=h(e=>({attributes:{tabindex:l(-1),class:T},classNames:{"au-select-badge":L},events:{keydown:t=>{let i=!1;switch(t.key){case"Backspace":case"Delete":{U(t,e().item),i=!0;break}}i&&t.preventDefault()}}})),oe=h(()=>({attributes:{role:l("listbox"),id:o(()=>`${x()}-menu`),"data-popper-placement":_,class:B},events:{mousedown:e=>e.preventDefault()}})),ce=h(e=>({attributes:{role:l("option"),"aria-selected":o(()=>`${e().selected}`),style:l("cursor: pointer")},classNames:{"au-select-item":L,selected:o(()=>e().selected)},events:{click:()=>n.api.toggleItem(e().item)}})),le=h(()=>({attributes:{id:x,type:l("text"),"aria-label":E,"aria-autocomplete":l("list"),autocorrect:l("off"),autocapitalize:l("none"),autocomplete:l("off")},classNames:{"au-select-input":L},events:{input:e=>{const t=e.target.value;$e(()=>{d.set(t!=null&&t!==""),R.set(t)})},keydown:({ctrlKey:e,key:t,preventDefault:i})=>{let c=!0;switch(t){case"ArrowDown":{d()?e?n.api.highlightLast():n.api.highlightNext():(n.api.open(),n.api.highlightFirst());break}case"ArrowUp":e?n.api.highlightFirst():n.api.highlightPrevious();break;case"Enter":{const p=W();p&&n.api.toggleItem(p.item);break}case"Escape":d.set(!1);break;default:c=!1}c&&i()}}})),ue=h(e=>({events:{click:t=>{U(t,e().item)}}})),n={...Ne({id$:x,visibleItems$:$,highlighted$:W,open$:d,selectedContexts$:Y,filterText$:R,placement$:_,className$:S,badgeClassName$:T,ariaLabel$:E,menuClassName$:B,...O}),patch:Q,api:{clear(){k.set([])},select(e){n.api.toggleItem(e,!0)},unselect(e){n.api.toggleItem(e,!1)},toggleItem(e,t){const i=v(),c=i(e),D=y().has(c);t==null&&(t=!D),!(t&&!H().has(c)||!t&&!D)&&k.update(m=>{if(m=[...m],t&&!D)m.push(e);else if(!t&&D){const de=m.findIndex(pe=>i(pe)===c);m.splice(de,1)}return F()?.(m),m})},clearText(){},highlight(e){const t=$().findIndex(i=>i.item===e);f.set(t===-1?void 0:t)},highlightFirst(){f.set(0)},highlightPrevious(){f.update(e=>e!=null?e-1:-1)},highlightNext(){f.update(e=>e!=null?e+1:1/0)},highlightLast(){f.set(-1)},open:()=>n.api.toggle(!0),close:()=>n.api.toggle(!1),toggle(e){d.update(t=>e??!t)}},directives:{hasFocusDirective:X,floatingDirective:Z,referenceDirective:K,inputContainerDirective:ve(xe(ee,ae),re),badgeAttributesDirective:ne,menuAttributesDirective:oe,itemAttributesDirective:ce,inputDirective:le,badgeCloseButtonDirective:ue}};return n}),Te={badgeLabel:({itemContext:s})=>s.item,itemLabel:({itemContext:s})=>s.item},Ee=Ae(Me,Te),Be=Ee;function Oe(s){return r.jsx(r.Fragment,{children:""+s.itemContext.item})}function Re(s){return r.jsx(r.Fragment,{children:""+s.itemContext.item})}function He({itemContext:s,slotContext:a}){return r.jsx("div",{...M(a.directives.badgeAttributesDirective,s),children:r.jsx(J,{slotContent:a.state.badgeLabel,props:{...a,itemContext:s}})})}function We({slotContext:s}){const a=[];for(const u of s.state.selectedContexts)a.push(r.jsx(He,{itemContext:u,slotContext:s},u.id));return a.length?r.jsx(r.Fragment,{children:a}):null}function _e({itemContext:s,slotContext:a}){const u=ge("dropdown-item","position-relative",{"text-bg-primary":s===a.state.highlighted});return r.jsx("li",{className:u,...M(a.directives.itemAttributesDirective,s),children:r.jsx(J,{slotContent:a.state.itemLabel,props:{...a,itemContext:s}})})}function ze({slotContext:s}){const{directives:{hasFocusDirective:a,floatingDirective:u,menuAttributesDirective:b}}=s;return r.jsx("ul",{...A([P,"dropdown-menu show"],a,u,b),children:s.state.visibleItems.map(g=>r.jsx(_e,{slotContext:s,itemContext:g},g.id))})}function st(s){const a=fe(Be,s,{badgeLabel:Oe,itemLabel:Re});me.useImperativeHandle(s.ref,()=>a.api,[a.api]);const{state:{id:u,visibleItems:b,filterText:g,open:v,className:w},directives:{hasFocusDirective:C,referenceDirective:F,inputContainerDirective:I,inputDirective:j}}=a,S=`${u}-menu`;return r.jsxs("div",{...A([P,`au-select dropdown border border-1 p-1 mb-3 d-block ${w}`],F),children:[r.jsxs("div",{...A([P,"d-flex align-items-center flex-wrap gap-1"],C,I),children:[r.jsx(We,{slotContext:a}),r.jsx("input",{type:"text",value:g,...M(j),onChange:()=>{}})]}),v&&b.length>0&&r.jsx(ze,{slotContext:a,menuId:S})]})}export{st as S};
