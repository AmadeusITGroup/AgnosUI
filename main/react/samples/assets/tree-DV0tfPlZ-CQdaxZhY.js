import{n as q,w as v,b as n,m as R,a as E,f as U,z as V,r as m}from"./dom-Bcg9ORcA-WqVLZWvA.js";import{c as W}from"./navManager-CKwK0fMF.js";import{w as j,s as B,t as G}from"./stores-4lfDy9AV.js";import{b as f,a as J,t as K}from"./writables-e0tyaQpe-CjYdKy22.js";import{c as Q}from"./widget-Cks0GYyt.js";const X={className:"",nodes:[],onExpandToggle:q,navSelector:i=>i.querySelectorAll("button"),ariaLabelToggleFn:i=>`Toggle ${i}`},Y={className:K,nodes:J,onExpandToggle:f,navSelector:f,ariaLabelToggleFn:f},se=Q("tree",i=>{const[{nodes$:x,onExpandToggle$:h,navSelector$:w,ariaLabelToggleFn$:T,...D},y]=j(X,i,Y),d=new Map,A={get(e){return e.isExpanded}},o=v({}),I=n(()=>(p(),o(),A)),{elementsInDomOrder$:L,directive:N,refreshElements:$,focusIndex:k,focusPrevious:F,focusNext:S,focusFirst:M,focusLast:P}=W(),_=n(()=>({keys:{ArrowUp:F,ArrowDown:S,Home:M,End:P},selector:w()})),u=(e,t,r)=>{const a={...e,ariaLabel:e.ariaLabel??e.label,level:t,children:[],isExpanded:e.children?.length?e.isExpanded??!1:void 0};return d.set(a,{parent:r}),e.children&&(a.children=e.children.map(s=>u(s,t+1,a))),a},p=n(()=>(d.clear(),x().map(e=>u(e,0,void 0)))),g=v(p().find(e=>e.isExpanded!==void 0)),c=e=>{const t=d.get(e);return t||console.error(`Node ${e.label} doesn't exist in the map`),t},z=U((e,t)=>{let r;const a=()=>{r&&r.htmlElement===e&&(r.htmlElement=void 0),r=void 0},s=O=>{a(),r=c(O.item),r&&(r.htmlElement&&console.warn("The tree item directive should be used once per element"),r.htmlElement=e)};return s(t),{update:s,destroy:a}}),b=e=>{if(e){const t=c(e)?.htmlElement;if(t){const r=L().indexOf(t);k(r,0)}}},H=E(e=>({events:{focus:()=>{const{item:t}=e();g.set(t)},click:()=>{const{item:t}=e();l(t)},keydown:t=>{const{key:r}=t,{item:a}=e(),s=a.isExpanded;switch($(),r){case"Enter":case" ":l(a);break;case"ArrowLeft":s?l(a):b(c(a)?.parent);break;case"ArrowRight":s?b(a.children?.[0]):l(a);break;default:return}t.preventDefault(),t.stopPropagation()}},attributes:{"aria-label":n(()=>{const{item:t}=e();return T()(t.ariaLabel)}),tabindex:n(()=>{const{item:t}=e();return t===g()?"0":"-1"}),type:m("button")},classNames:{"au-tree-expand-icon":G,"au-tree-expand-icon-expanded":n(()=>{o();const{item:t}=e();return t.isExpanded??!1})}})),l=e=>{c(e)===void 0||e.isExpanded===void 0||(e.isExpanded=!e.isExpanded,o.set({}),h()(e))};return{...B({normalizedNodes$:p,expandedMap$:I,...D}),patch:y,api:{},directives:{navigationDirective:V(N,_),itemToggleDirective:R(z,H),itemAttributesDirective:E(e=>({attributes:{role:m("treeitem"),"aria-selected":m("false"),"aria-expanded":n(()=>{const{item:t}=e();return o(),t.isExpanded?.toString()})}}))}}});export{se as c};
