import{n as m,w as U,C as X,h as d,D as Y,f as B,E as Z,s as F,z as q,m as T,p as nn}from"./stores-DX-ADOKq-MSAn3urh.js";import{t as A,a as h,c as en}from"./writables-DCiBdIBK-0-aBPFP1.js";import{p as z}from"./promise-CBh_HbSK-BLHhwNoC.js";const N=new Promise(m),tn=($,b)=>{$.style.display=b==="show"?"":"none"},sn={animated:!0,animatedOnInit:!1,initDone:null,visible:!0,transition:tn,onShown:m,onHidden:m,onVisibleChange:m},on={animated:A,animatedOnInit:A,visible:A,transition:h,onShown:h,onHidden:h,onVisibleChange:h,initDone:en},dn=$=>{const[{animated$:b,initDone$:v,visible$:u,transition$:R,onShown$:W,onHidden$:_,onVisibleChange$:j,animatedOnInit$:k},G]=U(sn,$,on),{element$:w,directive:J}=X(),y=d(()=>!!w()),c=Y(j,[u],([n])=>n),a=B(null),x=()=>{let n;return a.update(e=>(e==null||e.abort.abort(),n=e==null?void 0:e.context,null)),n},K=(n,e,o,i)=>q(()=>{const f=new AbortController,s=f.signal,l=x()??{},{promise:r,resolve:S}=z(),p={abort:f,animated:e,visible:n,context:l,element:o,transitionFn:i,promise:r};return a.set(p),S((async()=>{var I;try{await i(o,n?"show":"hide",e,s,l)}finally{s.aborted?await N:(a.set(null),(I=(n?W:_)())==null||I())}})()),p}),O=d(()=>v()?b():k()),g=B(null);let P,E=u(),t=null;const D=Z([c,w,O,g,R,a],([n,e,o,i,f,s])=>{const l=P!==e;P=e;const r=E!==n;if(E=n,e){v()==null&&v.set(!0);const S=i!=null&&s&&s.animated!=i;if(l||r||S){(r||i!=null)&&(t=null);const p=i??(t==null?void 0:t.animated)??(l&&!n?!1:o);s=K(n,p,e,f),t==null||t.resolve(s.promise),t=null}}else l&&(x(),s=null),(r||n&&(t==null?void 0:t.animated)!==i)&&(t=n&&i!=null?{animated:i,...z()}:null);return(t==null?void 0:t.promise)??(s==null?void 0:s.promise)});let H={};const C=async(n=!u(),e=O())=>{const o={};H=o;try{await q(()=>{try{return g.set(e),u.set(n),D()}finally{g.set(null)}})}finally{H!==o&&await N}},V=d(()=>(y()&&D(),!!a())),L=d(()=>!V()&&c()&&y()),M=d(()=>!V()&&!c()),Q=T(J,nn(D));return{...F({visible$:c,element$:w,elementPresent$:y,transitioning$:V,shown$:L,hidden$:M}),patch:G,directives:{directive:Q},api:{show:C.bind(null,!0),hide:C.bind(null,!1),toggle:C}}};export{dn as c};
