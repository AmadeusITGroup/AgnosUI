import{h,w as Q,G as X,c,H as Y,a as q,I as Z,s as F,D as G,e as T,g as ee,J as ne}from"./directive-DCYlDznf-D2hjAqcK.js";import{t as C,a as f,d as te}from"./writables-DoU_XYTX-Dq9jyVLj.js";import{a as J}from"./promise-CY2U8bTP-ChJZdKFm.js";const N=new Promise(h),ie=async($,b)=>{$.style.display=b==="show"?"":"none"},se={animated:!0,animatedOnInit:!1,initDone:null,visible:!0,transition:ie,onShown:h,onHidden:h,onVisibleChange:h},oe={animated:C,animatedOnInit:C,visible:C,transition:f,onShown:f,onHidden:f,onVisibleChange:f,initDone:te},ce=$=>{const[{animated$:b,initDone$:m,visible$:d,transition$:R,onShown$:U,onHidden$:W,onVisibleChange$:_,animatedOnInit$:j},S]=Q(se,$,oe),{element$:w,directive:k}=X(),A=c(()=>!!w()),u=Y(_,[d],([e])=>e),a=q(null),y=c(()=>!!a()),x=()=>{let e;return a.update(n=>(n==null||n.abort.abort(),e=n==null?void 0:n.context,null)),e},z=(e,n,o,i)=>G(()=>{const p=new AbortController,s=p.signal,l=x()??{},{promise:r,resolve:V}=J(),v={abort:p,animated:n,visible:e,context:l,element:o,transitionFn:i,promise:r};return a.set(v),V((async()=>{var E;try{await i(o,e?"show":"hide",n,s,l)}finally{s.aborted?await N:(a.set(null),(E=(e?U:W)())==null||E())}})()),v}),K=c(()=>!y()&&u()&&A()),L=c(()=>!y()&&!u()),H=c(()=>m()?b():j()),g=q(null);let I,O=d(),t=null;const P=Z([u,w,H,g,R,a],([e,n,o,i,p,s])=>{const l=I!==n;I=n;const r=O!==e;if(O=e,n){m()==null&&m.set(!0);const V=i!=null&&s&&s.animated!=i;if(l||r||V){(r||i!=null)&&(t=null);const v=i??(t==null?void 0:t.animated)??(l&&!e?!1:o);s=z(e,v,n,p),t==null||t.resolve(s.promise),t=null}}else l&&(x(),s=null),(r||e&&(t==null?void 0:t.animated)!==i)&&(t=e&&i!=null?{animated:i,...J()}:null);return(t==null?void 0:t.promise)??(s==null?void 0:s.promise)});let B={};const D=async(e=!d(),n=H())=>{const o={};B=o;try{await G(()=>{try{return g.set(n),d.set(e),P()}finally{g.set(null)}})}finally{B!==o&&await N}},M=T(k,ne(S),ee(P));return{...F({visible$:u,element$:w,elementPresent$:A,transitioning$:y,shown$:K,hidden$:L}),patch:S,directives:{directive:M},actions:{},api:{show:D.bind(null,!0),hide:D.bind(null,!1),toggle:D}}};export{ce as c};
