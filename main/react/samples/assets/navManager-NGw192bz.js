import{q as k,w as $,b as I,D as b,f as x}from"./dom-BPD8lUxd-BmYWB-gd.js";import{i as E}from"./isFocusable-Ckwus82R-adOM025a.js";import{g as N}from"./textDirection-cNgt24LJ-sg3JWs5A.js";const F=(r,e)=>{if(r===e)return 0;const o=r.compareDocumentPosition(e);if(o&Node.DOCUMENT_POSITION_FOLLOWING)return-1;if(o&Node.DOCUMENT_POSITION_PRECEDING)return 1;throw new Error("failed to compare elements")},S=new Set(["text","search","url","tel","password"]),R=r=>r instanceof HTMLInputElement&&S.has(r.type),T=r=>{let e=r.key;return r.shiftKey&&(e=`Shift+${e}`),r.altKey&&(e=`Alt+${e}`),r.ctrlKey&&(e=`Ctrl+${e}`),r.metaKey&&(e=`Meta+${e}`),e},P=r=>{const{target:e,key:o}=r;if(R(e)&&(o==="ArrowLeft"||o==="ArrowRight"||o==="Home"||o==="End")){let a;if(o==="ArrowLeft"||o==="ArrowRight"){const i=N(e);a=o===(i==="ltr"?"ArrowLeft":"ArrowRight")}else a=o==="Home";const f=e.selectionStart===e.selectionEnd?e.selectionStart:null;if(a&&f!==0||!a&&f!==e.value.length)return!0}return!1},K=r=>[r],j=()=>{const r=k(),e=$({}),o=(t=!0)=>{e.set({}),t&&(f(),i())},a=I(()=>{e();const t=[];for(const s of r())t.push(...s());return t}),f=I(()=>b(a()),{equal:Object.is}),i=I(()=>[...a()].sort(F)),l=()=>{const t=f();return t?N(t):"ltr"},g=(t,s)=>(t&&s?.preventDefault(),t),h=(t,s=0)=>{const c=i();for(;t>=0&&t<c.length;){const n=c[t];if(E(n)){if(n.focus(),s!=0&&R(n)){const u=l()!==N(n),m=s>0!==u?0:n.value.length;n.setSelectionRange(m,m,m===0?"forward":"backward")}return n}if(s===0)break;t+=s}return null},L=t=>({event:s,referenceElement:c=s?.target??document.activeElement}={})=>{const n=c?i().indexOf(c):-1;return n>-1?g(h(n+t,t),s):null},D=x((t,s)=>{const c=u=>{if(P(u))return;const m=T(u),A=s.keys?.[m];A&&(o(!1),A({event:u,directiveElement:t,navManager:O,context:s.context}))};t.addEventListener("keydown",c);const n=r.register(()=>(s?.selector??K)(t));return{update(u){s=u},destroy(){t.removeEventListener("keydown",c),n()}}}),p=L(-1),d=L(1),w=({event:t}={})=>g(h(0,1),t),y=({event:t}={})=>g(h(i().length-1,-1),t),O={elementsInDomOrder$:i,directive:D,focusIndex:h,focusPrevious:p,focusNext:d,focusFirst:w,focusFirstLeft:(...t)=>(l()==="rtl"?y:w)(...t),focusFirstRight:(...t)=>(l()==="rtl"?w:y)(...t),focusLast:y,focusLeft:(...t)=>(l()==="rtl"?d:p)(...t),focusRight:(...t)=>(l()==="rtl"?p:d)(...t),refreshElements:o};return O};export{j as c};
