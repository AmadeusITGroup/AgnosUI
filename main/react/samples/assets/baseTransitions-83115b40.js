import{b as X,e as Y,c as r,i as Z,w as N,d as _,s as F,x as R,m as T,f as ee,y as te}from"./utils-925d60ed.js";import{t as S,b as p,f as se}from"./writables-3b79b637.js";const v=()=>{},U=new Promise(v),oe=async(i,f)=>{i.style.display=f==="show"?"":"none"},ne={animation:!0,animationOnInit:!1,initDone:null,visible:!0,transition:oe,onShown:v,onHidden:v,onVisibleChange:v},le={animation:S,animationOnInit:S,visible:S,transition:p,onShown:p,onHidden:p,onVisibleChange:p,initDone:se},W=()=>{let i;return{promise:new Promise(c=>{i=c}),resolve:i}},ce=i=>{const[{animation$:f,initDone$:c,visible$:b,transition$:g,onShown$:j,onHidden$:k,onVisibleChange$:z,animationOnInit$:G},x]=X(ne,i,le),{element$:w,directive:J}=Y(),A=r(()=>!!w()),m=Z(z,[b],([e])=>e),d=N(null),y=r(()=>!!d()),P=()=>{let e;return d.update(t=>(t==null||t.abort.abort(),e=t==null?void 0:t.context,null)),e},K=(e,t,l,n)=>R(()=>{const $=new AbortController,o=$.signal,a=P()??{},{promise:u,resolve:C}=W(),h={abort:$,animation:t,visible:e,context:a,element:l,transitionFn:n,promise:u};return d.set(h),C((async()=>{var q;try{await n(l,e?"show":"hide",t,o,a)}finally{o.aborted?await U:(d.set(null),(q=(e?j:k)())==null||q())}})()),h}),L=r(()=>!y()&&m()&&A()),M=r(()=>!y()&&!m()),O=r(()=>c()?f():G()),D=N(null);let H,I=b(),s=null;const B=_([m,w,O,D,g,d],([e,t,l,n,$,o])=>{const a=H!==t;H=t;const u=I!==e;if(I=e,t){c()==null&&c.set(!0);const C=n!=null&&o&&o.animation!=n;if(a||u||C){(u||n!=null)&&(s=null);const h=n??(s==null?void 0:s.animation)??(a&&!e?!1:l);o=K(e,h,t,$),s==null||s.resolve(o.promise),s=null}}else a&&(P(),o=null),(u||e&&(s==null?void 0:s.animation)!==n)&&(s=e&&n!=null?{animation:n,...W()}:null);return(s==null?void 0:s.promise)??(o==null?void 0:o.promise)});let E={};const V=async(e=!b(),t=O())=>{const l={};E=l;try{await R(()=>{try{return D.set(t),b.set(e),B()}finally{D.set(null)}})}finally{E!==l&&await U}},Q=T(J,te(x),ee(B));return{...F({visible$:m,element$:w,elementPresent$:A,transitioning$:y,shown$:L,hidden$:M}),patch:x,directives:{directive:Q},actions:{},api:{show:V.bind(null,!0),hide:V.bind(null,!1),toggle:V}}};export{ce as c};
