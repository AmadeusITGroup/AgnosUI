import{e as h,b as X,y as Y,c as d,f as Z,w as q,z as _,s as F,j as z,l as T,d as ee,A as te}from"./utils-32bfe757.js";import{t as C,a as $,f as se}from"./writables-69b35f47.js";import{a as N}from"./promise-f5ff916a.js";const R=new Promise(h),oe=async(m,p)=>{m.style.display=p==="show"?"":"none"},le={animation:!0,animationOnInit:!1,initDone:null,visible:!0,transition:oe,onShown:h,onHidden:h,onVisibleChange:h},ne={animation:C,animationOnInit:C,visible:C,transition:$,onShown:$,onHidden:$,onVisibleChange:$,initDone:se},de=m=>{const[{animation$:p,initDone$:v,visible$:u,transition$:U,onShown$:W,onHidden$:g,onVisibleChange$:k,animationOnInit$:G},S]=X(le,m,ne),{element$:w,directive:J}=Y(),x=d(()=>!!w()),f=Z(k,[u],([e])=>e),i=q(null),y=d(()=>!!i()),O=()=>{let e;return i.update(t=>(t==null||t.abort.abort(),e=t==null?void 0:t.context,null)),e},K=(e,t,n,l)=>z(()=>{const r=new AbortController,o=r.signal,a=O()??{},{promise:c,resolve:A}=N(),b={abort:r,animation:t,visible:e,context:a,element:n,transitionFn:l,promise:c};return i.set(b),A((async()=>{var j;try{await l(n,e?"show":"hide",t,o,a)}finally{o.aborted?await R:(i.set(null),(j=(e?W:g)())==null||j())}})()),b}),L=d(()=>!y()&&f()&&x()),M=d(()=>!y()&&!f()),P=d(()=>v()?p():G()),D=q(null);let H,I=u(),s=null;const B=_([f,w,P,D,U,i],([e,t,n,l,r,o])=>{const a=H!==t;H=t;const c=I!==e;if(I=e,t){v()==null&&v.set(!0);const A=l!=null&&o&&o.animation!=l;if(a||c||A){(c||l!=null)&&(s=null);const b=l??(s==null?void 0:s.animation)??(a&&!e?!1:n);o=K(e,b,t,r),s==null||s.resolve(o.promise),s=null}}else a&&(O(),o=null),(c||e&&(s==null?void 0:s.animation)!==l)&&(s=e&&l!=null?{animation:l,...N()}:null);return(s==null?void 0:s.promise)??(o==null?void 0:o.promise)});let E={};const V=async(e=!u(),t=P())=>{const n={};E=n;try{await z(()=>{try{return D.set(t),u.set(e),B()}finally{D.set(null)}})}finally{E!==n&&await R}},Q=T(J,te(S),ee(B));return{...F({visible$:f,element$:w,elementPresent$:x,transitioning$:y,shown$:L,hidden$:M}),patch:S,directives:{directive:Q},actions:{},api:{show:V.bind(null,!0),hide:V.bind(null,!1),toggle:V}}};export{de as c};
