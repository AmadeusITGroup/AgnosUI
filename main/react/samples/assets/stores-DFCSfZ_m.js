import{a as h,c as i,g as D,b as E,d as m,r as k,w as y,e as W,i as v,f as z}from"./func-BRtNsj1u.js";import{r as d}from"./index-BaC339Vy.js";const U=e=>({actions:e.actions,api:e.api,directives:e.directives,state$:e.state$,stores:e.stores}),V=Symbol();function N(e){return function(t){E(()=>{var n;for(const[r,s]of Object.entries(t??{}))(n=e[`${r}$`])==null||n.set(s)})}}function P(e,t){if(e===t)return null;let n=!1;const r={},s=new Set([...Object.keys(e),...Object.keys(t)]);for(const a of s){const c=t[a];e[a]!==c&&(r[a]=c,n=!0)}return n?r:null}function w(e,t=k(void 0),n={},r=y(void 0)){const{normalizeValue:s=v,equal:a=Object.is}=n,c=()=>e,o=(u,l=c)=>{const b=u===void 0?void 0:s(u);return b===V?(console.error("Not using invalid value",u),l()):b===void 0?l():b},f=i(()=>o(t()),{equal:a}),O=i(()=>o(r(),f),{equal:a});return m(O,u=>{if(u!==void 0){const l=s(u);if(l===V){console.error("Not setting invalid value",u);return}u=l}r.set(u)})}const S=e=>!!(e&&typeof e=="function"&&"subscribe"in e),A=e=>S(e)?e:k(e),I=e=>S(e)?e:y(e),R=(e,t)=>{const n={};if(t){const r=S(t);for(const s of e)n[s]=r?i(()=>t()[s]):A(t[s])}return n},F=(e,t,n)=>{const r={};for(const s of e){const a=t==null?void 0:t[s],c=n==null?void 0:n[s];r[s]=a&&c?i(()=>a()??c()):a||c}return r},$=(e,t,n)=>{const r={},s=Object.keys(e),a=R(s,t==null?void 0:t.config),c=t==null?void 0:t.props;for(const o of s){const f=c==null?void 0:c[o];r[`${o}$`]=w(e[o],a[o],n==null?void 0:n[o],I(f))}return r},M=(e,t,n)=>{const r=$(e,t,n);return[r,N(r)]},_=e=>{const t=[],n=[],r={};for(const s of Object.keys(e))if(s.endsWith("$")){const a=e[s];t.push(s.substring(0,s.length-1)),n.push(a),r[s]=h(a)}return{stores:r,state$:i(()=>{const s=n.map(D),a={};return t.forEach((c,o)=>{a[c]=s[o]}),a})}},B=(e,t,n=s=>s[0],r=(s,a)=>a===s)=>{let s=t[0]();return m(W(t,{derive(a){const c=n(a),o=!r(a[0],c);return o&&t[0].set(c),(o||!r(s,c))&&(s=c,e()(c)),c},equal:r}),t[0].set.bind(t[0]))},G=(e,t,n=v,r=z)=>m(i(()=>n(e()),{equal:r}),s=>{const a=n(s);r(e(),a)||(e.set(a),t()(a))});function H(e){const[t,n]=d.useState(()=>e());return d.useEffect(()=>e.subscribe(r=>{n(()=>r)}),[e]),t}const j=(e,t)=>!P(e,t),J=e=>{const t=d.useRef();return t.current||(t.current=y({...e},{equal:j})),d.useEffect(()=>{t.current.set({...e})},[e]),d.useMemo(()=>h(t.current),[t.current])};export{V as I,J as a,B as b,G as c,$ as d,P as f,F as m,R as n,_ as s,U as t,H as u,M as w};
