import{r as fe,j as n}from"./App-AO0jOhRY.js";import{S as Q}from"./slot-BNbuKlAZ.js";import{a as A,u as M}from"./directive-CEErjM5c-iSrC3_Et.js";import{c as ge}from"./clsx-B-dksMZM.js";import{u as he}from"./config-Drx5IJGH.js";import{f as o,x as be,w as ve,g as J,m as xe,B as $e,n as y,a as h,r as l,q as De,c as P}from"./dom-BB9jLllr-Cs0LnZpg.js";import{c as we,o as Ce,a as Fe,b as Ie}from"./floatingUI-rZqLsZ3-.js";import{c as je}from"./focustrack-cEjb3YrM.js";import{c as Se}from"./navManager-MQGcSt_A.js";import{w as ke,d as Ne,c as ye,s as Le,t as L}from"./stores-BWu8V2zY.js";import{e as Ae}from"./extendWidget-B0Yau8uj.js";const Pe={id:void 0,ariaLabel:"Select",open:!1,disabled:!1,items:[],filterText:"",loading:!1,selected:[],navSelector:s=>s.querySelectorAll(".au-select-badge,input"),itemIdFn:s=>""+s,onOpenChange:y,onFilterTextChange:y,onSelectedChange:y,allowedPlacements:["bottom-start","top-start","bottom-end","top-end"],className:"",menuClassName:"",menuItemClassName:"",badgeClassName:""};function Me(s){const[{id$:a,open$:u,filterText$:b,items$:f,itemIdFn$:v,onOpenChange$:w,onFilterTextChange$:C,onSelectedChange$:F,allowedPlacements$:I,navSelector$:j,className$:S,badgeClassName$:T,ariaLabel$:E,menuClassName$:B,...O},V]=ke(Pe,s),{selected$:k}=O,x=o(()=>a()??be()),R=Ne(b,C),{hasFocus$:X,directive:Y}=je(),d=ye(w,[u,X],([e,t])=>e&&t),N=o(()=>{const e=new Map,t=v();for(const i of k()){const c=t(i);e.set(c,{item:i,id:t(i),selected:!0})}return e}),Z=o(()=>[...N().values()]),g=function(){const e=ve(0);return J(e,t=>{const{length:i}=$();t!=null&&(i?t<0?t=i-1:t>=i&&(t=0):t=void 0),e.set(t)})}(),_=o(()=>{const e=new Map;if(d()){const t=N(),i=v();for(const c of f()){const p=i(c);e.set(p,{item:c,id:p,selected:t.has(p)})}}return e}),$=o(()=>d()?[..._().values()]:[]),H=o(()=>{const e=$(),t=g();return e.length&&t!=null?e[t]:void 0}),{directives:{floatingDirective:K,referenceDirective:ee},stores:{placement$:W}}=we({props:{computePositionOptions:J(o(()=>({middleware:[Ce(5),Fe({allowedPlacements:I()}),Ie()]})))}}),{directive:te,refreshElements:se,focusFirst:ie,focusLast:ae,focusLeft:q,focusRight:z}=Se(),ne=o(()=>({keys:{Home:ie,End:ae,ArrowLeft:q,ArrowRight:z},selector:j()})),U=(e,t)=>{const i=e.target;se(),r.api.unselect(t),i instanceof HTMLElement&&setTimeout(()=>{q({event:e,referenceElement:i})||z({event:e,referenceElement:i})}),e.preventDefault()},re=h(()=>({attributes:{role:l("combobox"),"aria-haspopup":l("listbox"),"aria-expanded":o(()=>`${d()}`),"aria-controls":o(()=>`${x()}-menu`)}})),oe=h(e=>({attributes:{tabindex:l(-1),class:T},classNames:{"au-select-badge":L},events:{keydown:t=>{let i=!1;switch(t.key){case"Backspace":case"Delete":{U(t,e().item),i=!0;break}}i&&t.preventDefault()}}})),ce=h(()=>({attributes:{role:l("listbox"),id:o(()=>`${x()}-menu`),"data-popper-placement":W,class:B},events:{mousedown:e=>e.preventDefault()}})),le=h(e=>({attributes:{role:l("option"),"aria-selected":o(()=>`${e().selected}`),style:l("cursor: pointer")},classNames:{"au-select-item":L,selected:o(()=>e().selected)},events:{click:()=>r.api.toggleItem(e().item)}})),ue=h(()=>({attributes:{id:x,type:l("text"),"aria-label":E,"aria-autocomplete":l("list"),autocorrect:l("off"),autocapitalize:l("none"),autocomplete:l("off")},classNames:{"au-select-input":L},events:{input:e=>{const t=e.target.value;De(()=>{d.set(t!=null&&t!==""),R.set(t)})},keydown:({ctrlKey:e,key:t,preventDefault:i})=>{let c=!0;switch(t){case"ArrowDown":{d()?e?r.api.highlightLast():r.api.highlightNext():(r.api.open(),r.api.highlightFirst());break}case"ArrowUp":e?r.api.highlightFirst():r.api.highlightPrevious();break;case"Enter":{const p=H();p&&r.api.toggleItem(p.item);break}case"Escape":d.set(!1);break;default:c=!1}c&&i()}}})),de=h(e=>({events:{click:t=>{U(t,e().item)}}})),r={...Le({id$:x,visibleItems$:$,highlighted$:H,open$:d,selectedContexts$:Z,filterText$:R,placement$:W,className$:S,badgeClassName$:T,ariaLabel$:E,menuClassName$:B,...O}),patch:V,api:{clear(){k.set([])},select(e){r.api.toggleItem(e,!0)},unselect(e){r.api.toggleItem(e,!1)},toggleItem(e,t){const i=v(),c=i(e),D=N().has(c);t==null&&(t=!D),!(t&&!_().has(c)||!t&&!D)&&k.update(m=>{var G;if(m=[...m],t&&!D)m.push(e);else if(!t&&D){const pe=m.findIndex(me=>i(me)===c);m.splice(pe,1)}return(G=F())==null||G(m),m})},clearText(){},highlight(e){const t=$().findIndex(i=>i.item===e);g.set(t===-1?void 0:t)},highlightFirst(){g.set(0)},highlightPrevious(){g.update(e=>e!=null?e-1:-1)},highlightNext(){g.update(e=>e!=null?e+1:1/0)},highlightLast(){g.set(-1)},open:()=>r.api.toggle(!0),close:()=>r.api.toggle(!1),toggle(e){d.update(t=>e??!t)}},directives:{hasFocusDirective:Y,floatingDirective:K,referenceDirective:ee,inputContainerDirective:xe($e(te,ne),re),badgeAttributesDirective:oe,menuAttributesDirective:ce,itemAttributesDirective:le,inputDirective:ue,badgeCloseButtonDirective:de}};return r}const Te={badgeLabel:({itemContext:s})=>s.item,itemLabel:({itemContext:s})=>s.item},Ee=Ae(Me,Te),Be=Ee;function Oe(s){return n.jsx(n.Fragment,{children:""+s.itemContext.item})}function Re(s){return n.jsx(n.Fragment,{children:""+s.itemContext.item})}function _e({itemContext:s,slotContext:a}){return n.jsx("div",{...M(a.directives.badgeAttributesDirective,s),children:n.jsx(Q,{slotContent:a.state.badgeLabel,props:{...a,itemContext:s}})})}function He({slotContext:s}){const a=[];for(const u of s.state.selectedContexts)a.push(n.jsx(_e,{itemContext:u,slotContext:s},u.id));return a.length?n.jsx(n.Fragment,{children:a}):null}function We({itemContext:s,slotContext:a}){const u=ge("dropdown-item","position-relative",{"text-bg-primary":s===a.state.highlighted});return n.jsx("li",{className:u,...M(a.directives.itemAttributesDirective,s),children:n.jsx(Q,{slotContent:a.state.itemLabel,props:{...a,itemContext:s}})})}function qe({slotContext:s}){const{directives:{hasFocusDirective:a,floatingDirective:u,menuAttributesDirective:b}}=s;return n.jsx("ul",{...A([P,"dropdown-menu show"],a,u,b),children:s.state.visibleItems.map(f=>n.jsx(We,{slotContext:s,itemContext:f},f.id))})}function tt(s){const a=he(Be,s,"select",{badgeLabel:Oe,itemLabel:Re});fe.useImperativeHandle(s.ref,()=>a.api,[a.api]);const{state:{id:u,visibleItems:b,filterText:f,open:v,className:w},directives:{hasFocusDirective:C,referenceDirective:F,inputContainerDirective:I,inputDirective:j}}=a,S=`${u}-menu`;return n.jsxs("div",{...A([P,`au-select dropdown border border-1 p-1 mb-3 d-block ${w}`],F),children:[n.jsxs("div",{...A([P,"d-flex align-items-center flex-wrap gap-1"],C,I),children:[n.jsx(He,{slotContext:a}),n.jsx("input",{type:"text",value:f,...M(j),onChange:()=>{}})]}),v&&b.length>0&&n.jsx(qe,{slotContext:a,menuId:S})]})}export{tt as S};
