import{j as n}from"./App-D2FAakDZ.js";import{f as de,d as c,p as ue,K as pe,F as me,w as ge,e as z,s as fe,j as he,N as ve,B as be,o as A,k as w,t as xe,c as P}from"./directive-3-8yr-ZK-C5h7Dwqe.js";import{c as $e,o as we,a as De,b as Ce}from"./floatingUI-BIINKrA-.js";import{c as Ie}from"./focustrack-BCVH7QM3.js";import{c as Fe}from"./navManager-DmYmZNH8.js";import{e as ye}from"./extendWidget-CY6dlHOY.js";import{u as je,S as U}from"./config-87LujZOd.js";import{a as M,u as q}from"./directive-Kqp31pwt-o0igtPiy.js";import{c as Ne}from"./index-D735YuCH.js";const Se={id:void 0,ariaLabel:"Select",open:!1,disabled:!1,items:[],filterText:"",loading:!1,selected:[],navSelector:s=>s.querySelectorAll(".au-select-badge,input"),itemIdFn:s=>""+s,onOpenChange:A,onFilterTextChange:A,onSelectedChange:A,allowedPlacements:["bottom-start","top-start","bottom-end","top-end"],className:"",menuClassName:"",menuItemClassName:"",badgeClassName:""};function ke(s){const[{id$:a,open$:r,filterText$:g,items$:p,itemIdFn$:h,onOpenChange$:D,onFilterTextChange$:C,onSelectedChange$:I,allowedPlacements$:F,navSelector$:y,className$:j,badgeClassName$:v,ariaLabel$:N,menuClassName$:b,...T},G]=de(Se,s),{selected$:S}=T,k=c(()=>a()??ue()),B=pe(g,C),{hasFocus$:J,directive:Q}=Ie(),d=me(D,[r,J],([e,t])=>e&&t),L=c(()=>{const e=new Map,t=h();for(const i of S()){const l=t(i);e.set(l,{item:i,id:t(i),selected:!0})}return e}),V=c(()=>[...L().values()]),f=function(){const e=ge(0);return z(e,t=>{const{length:i}=x();t!=null&&(i?t<0?t=i-1:t>=i&&(t=0):t=void 0),e.set(t)})}(),E=c(()=>{const e=new Map;if(d()){const t=L(),i=h();for(const l of p()){const u=i(l);e.set(u,{item:l,id:u,selected:t.has(u)})}}return e}),x=c(()=>d()?[...E().values()]:[]),K=c(()=>{const e=x(),t=f();return e.length&&t!=null?e[t]:void 0}),{directives:{floatingDirective:X,referenceDirective:Y},stores:{placement$:R}}=$e({props:{computePositionOptions:z(c(()=>({middleware:[we(5),De({allowedPlacements:F()}),Ce()]})))}}),{directive:Z,refreshElements:ee,focusFirst:te,focusLast:se,focusLeft:O,focusRight:W}=Fe(),ie=c(()=>({keys:{Home:te,End:se,ArrowLeft:O,ArrowRight:W},selector:y()})),_=(e,t)=>{const i=e.target;ee(),o.api.unselect(t),i instanceof HTMLElement&&setTimeout(()=>{O({event:e,referenceElement:i})||W({event:e,referenceElement:i})}),e.preventDefault()},ae=w(()=>({attributes:{role:"combobox","aria-haspopup":"listbox","aria-expanded":c(()=>`${d()}`),"aria-controls":c(()=>`${k()}-menu`)}})),ne=w(e=>({attributes:{tabindex:-1,class:v},classNames:{"au-select-badge":!0},events:{keydown:t=>o.actions.onBadgeKeydown(t,e().item)}})),oe=w(()=>({attributes:{role:"listbox",id:c(()=>`${k()}-menu`),"data-popper-placement":R,class:b},events:{mousedown:e=>e.preventDefault()}})),re=w(e=>({attributes:{role:"option","aria-selected":c(()=>`${e().selected}`),style:"cursor: pointer"},classNames:{"au-select-item":!0,selected:c(()=>e().selected)},events:{click:()=>o.api.toggleItem(e().item)}})),o={...fe({id$:k,visibleItems$:x,highlighted$:K,open$:d,selectedContexts$:V,filterText$:B,placement$:R,className$:j,badgeClassName$:v,ariaLabel$:N,menuClassName$:b,...T}),patch:G,api:{clear(){S.set([])},select(e){o.api.toggleItem(e,!0)},unselect(e){o.api.toggleItem(e,!1)},toggleItem(e,t){const i=h(),l=i(e),$=L().has(l);t==null&&(t=!$),!(t&&!E().has(l)||!t&&!$)&&S.update(m=>{var H;if(m=[...m],t&&!$)m.push(e);else if(!t&&$){const ce=m.findIndex(le=>i(le)===l);m.splice(ce,1)}return(H=I())==null||H(m),m})},clearText(){},highlight(e){const t=x().findIndex(i=>i.item===e);f.set(t===-1?void 0:t)},highlightFirst(){f.set(0)},highlightPrevious(){f.update(e=>e!=null?e-1:-1)},highlightNext(){f.update(e=>e!=null?e+1:1/0)},highlightLast(){f.set(-1)},open:()=>o.api.toggle(!0),close:()=>o.api.toggle(!1),toggle(e){d.update(t=>e??!t)}},directives:{hasFocusDirective:Q,floatingDirective:X,referenceDirective:Y,inputContainerDirective:he(ve(Z,ie),ae),badgeAttributesDirective:ne,menuAttributesDirective:oe,itemAttributesDirective:re},actions:{onInput({target:e}){const t=e.value;be(()=>{d.set(t!=null&&t!==""),B.set(t)})},onRemoveBadgeClick(e,t){_(e,t)},onInputKeydown(e){const{ctrlKey:t,key:i}=e;let l=!0;switch(i){case"ArrowDown":{d()?t?o.api.highlightLast():o.api.highlightNext():(o.api.open(),o.api.highlightFirst());break}case"ArrowUp":t?o.api.highlightFirst():o.api.highlightPrevious();break;case"Enter":{const u=K();u&&o.api.toggleItem(u.item);break}case"Escape":d.set(!1);break;default:l=!1}l&&e.preventDefault()},onBadgeKeydown(e,t){let i=!1;switch(e.key){case"Backspace":case"Delete":{_(e,t),i=!0;break}}i&&e.preventDefault()}}};return o}const Le={badgeLabel:({itemContext:s})=>s.item,itemLabel:({itemContext:s})=>s.item},Ae=ye(ke,Le,{}),Pe=Ae;function Me(s){return n.jsx(n.Fragment,{children:""+s.itemContext.item})}function Te(s){return n.jsx(n.Fragment,{children:""+s.itemContext.item})}function Be({itemContext:s,slotContext:a}){return n.jsx("div",{...q(a.widget.directives.badgeAttributesDirective,s),children:n.jsx(U,{slotContent:a.state.badgeLabel,props:{...a,itemContext:s}})})}function Ee({slotContext:s}){const a=[];for(const r of s.state.selectedContexts)a.push(n.jsx(Be,{itemContext:r,slotContext:s},r.id));return a.length?n.jsx(n.Fragment,{children:a}):null}function Ke({itemContext:s,slotContext:a}){const r=Ne("dropdown-item","position-relative",{"text-bg-primary":s===a.state.highlighted});return n.jsx("li",{className:r,...q(a.widget.directives.itemAttributesDirective,s),children:n.jsx(U,{slotContent:a.state.itemLabel,props:{...a,itemContext:s}})})}function Re({slotContext:s}){const{directives:{hasFocusDirective:a,floatingDirective:r,menuAttributesDirective:g}}=s.widget;return n.jsx("ul",{...M([P,"dropdown-menu show"],a,r,g),children:s.state.visibleItems.map(p=>n.jsx(Ke,{slotContext:s,itemContext:p},p.id))})}const Oe={badgeLabel:Me,itemLabel:Te};function Ve(s){const[a,r]=je(Pe,s,"select",Oe),g={state:a,widget:xe(r)},{id:p,ariaLabel:h,visibleItems:D,filterText:C,open:I,className:F}=a,y=`${p}-menu`,{directives:{hasFocusDirective:j,referenceDirective:v,inputContainerDirective:N}}=r;return n.jsxs("div",{...M([P,`au-select dropdown border border-1 p-1 mb-3 d-block ${F}`],v),children:[n.jsxs("div",{...M([P,"d-flex align-items-center flex-wrap gap-1"],j,N),children:[n.jsx(Ee,{slotContext:g}),n.jsx("input",{id:p,"aria-label":h,className:"au-select-input flex-grow-1 border-0",type:"text",value:C,"aria-autocomplete":"list",autoCorrect:"off",autoCapitalize:"none",autoComplete:"off",onInput:r.actions.onInput,onKeyDown:b=>r.actions.onInputKeydown(b.nativeEvent)})]}),I&&D.length>0&&n.jsx(Re,{slotContext:g,menuId:y})]})}export{Ve as S};
