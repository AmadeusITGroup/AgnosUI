import{j as n}from"./App-D-YoNqd_.js";import{w as de,c,i as ue,M as pe,H as me,a as ge,b as q,s as fe,e as he,q as ve,D as be,h as L,f as w,t as xe,k as M}from"./directive-DCYlDznf-D2hjAqcK.js";import{c as $e,o as we,a as De,b as Ie}from"./floatingUI-KLO_OhIO.js";import{c as Ce}from"./focustrack-WRGQ5Ee4.js";import{c as Fe}from"./navManager-2183gnhI.js";import{e as ye}from"./extendWidget-B-unuY20.js";import{u as je,S as z}from"./config-CDi6dcem.js";import{a as P,u as U}from"./directive-Kqp31pwt-CbH3w4Yc.js";import{c as Se}from"./index-CpkboaG9.js";const ke={id:void 0,ariaLabel:"Select",open:!1,disabled:!1,items:[],filterText:"",loading:!1,selected:[],navSelector:s=>s.querySelectorAll(".au-select-badge,input"),itemIdFn:s=>""+s,onOpenChange:L,onFilterTextChange:L,onSelectedChange:L,allowedPlacements:["bottom-start","top-start","bottom-end","top-end"],className:"",menuClassName:"",menuItemClassName:"",badgeClassName:""};function Ne(s){const[{id$:a,open$:r,filterText$:g,items$:p,itemIdFn$:h,onOpenChange$:D,onFilterTextChange$:I,onSelectedChange$:C,allowedPlacements$:F,navSelector$:y,className$:j,badgeClassName$:v,ariaLabel$:S,menuClassName$:b,...B},G]=de(ke,s),{selected$:k}=B,N=c(()=>a()??ue()),T=pe(g,I),{hasFocus$:J,directive:Q}=Ce(),d=me(D,[r,J],([e,t])=>e&&t),A=c(()=>{const e=new Map,t=h();for(const i of k()){const l=t(i);e.set(l,{item:i,id:t(i),selected:!0})}return e}),V=c(()=>[...A().values()]),f=function(){const e=ge(0);return q(e,t=>{const{length:i}=x();t!=null&&(i?t<0?t=i-1:t>=i&&(t=0):t=void 0),e.set(t)})}(),E=c(()=>{const e=new Map;if(d()){const t=A(),i=h();for(const l of p()){const u=i(l);e.set(u,{item:l,id:u,selected:t.has(u)})}}return e}),x=c(()=>d()?[...E().values()]:[]),K=c(()=>{const e=x(),t=f();return e.length&&t!=null?e[t]:void 0}),{directives:{floatingDirective:X,referenceDirective:Y},stores:{placement$:R}}=$e({props:{computePositionOptions:q(c(()=>({middleware:[we(5),De({allowedPlacements:F()}),Ie()]})))}}),{directive:Z,refreshElements:ee,focusFirst:te,focusLast:se,focusLeft:O,focusRight:W}=Fe(),ie=c(()=>({keys:{Home:te,End:se,ArrowLeft:O,ArrowRight:W},selector:y()})),H=(e,t)=>{const i=e.target;ee(),o.api.unselect(t),i instanceof HTMLElement&&setTimeout(()=>{O({event:e,referenceElement:i})||W({event:e,referenceElement:i})}),e.preventDefault()},ae=w(()=>({attributes:{role:"combobox","aria-haspopup":"listbox","aria-expanded":c(()=>`${d()}`),"aria-controls":c(()=>`${N()}-menu`)}})),ne=w(e=>({attributes:{tabindex:-1,class:v},classNames:{"au-select-badge":!0},events:{keydown:t=>o.actions.onBadgeKeydown(t,e().item)}})),oe=w(()=>({attributes:{role:"listbox",id:c(()=>`${N()}-menu`),"data-popper-placement":R,class:b},events:{mousedown:e=>e.preventDefault()}})),re=w(e=>({attributes:{role:"option","aria-selected":c(()=>`${e().selected}`),style:"cursor: pointer"},classNames:{"au-select-item":!0,selected:c(()=>e().selected)},events:{click:()=>o.api.toggleItem(e().item)}})),o={...fe({id$:N,visibleItems$:x,highlighted$:K,open$:d,selectedContexts$:V,filterText$:T,placement$:R,className$:j,badgeClassName$:v,ariaLabel$:S,menuClassName$:b,...B}),patch:G,api:{clear(){k.set([])},select(e){o.api.toggleItem(e,!0)},unselect(e){o.api.toggleItem(e,!1)},toggleItem(e,t){const i=h(),l=i(e),$=A().has(l);t==null&&(t=!$),!(t&&!E().has(l)||!t&&!$)&&k.update(m=>{var _;if(m=[...m],t&&!$)m.push(e);else if(!t&&$){const ce=m.findIndex(le=>i(le)===l);m.splice(ce,1)}return(_=C())==null||_(m),m})},clearText(){},highlight(e){const t=x().findIndex(i=>i.item===e);f.set(t===-1?void 0:t)},highlightFirst(){f.set(0)},highlightPrevious(){f.update(e=>e!=null?e-1:-1)},highlightNext(){f.update(e=>e!=null?e+1:1/0)},highlightLast(){f.set(-1)},open:()=>o.api.toggle(!0),close:()=>o.api.toggle(!1),toggle(e){d.update(t=>e??!t)}},directives:{hasFocusDirective:Q,floatingDirective:X,referenceDirective:Y,inputContainerDirective:he(ve(Z,ie),ae),badgeAttributesDirective:ne,menuAttributesDirective:oe,itemAttributesDirective:re},actions:{onInput({target:e}){const t=e.value;be(()=>{d.set(t!=null&&t!==""),T.set(t)})},onRemoveBadgeClick(e,t){H(e,t)},onInputKeydown(e){const{ctrlKey:t,key:i}=e;let l=!0;switch(i){case"ArrowDown":{d()?t?o.api.highlightLast():o.api.highlightNext():(o.api.open(),o.api.highlightFirst());break}case"ArrowUp":t?o.api.highlightFirst():o.api.highlightPrevious();break;case"Enter":{const u=K();u&&o.api.toggleItem(u.item);break}case"Escape":d.set(!1);break;default:l=!1}l&&e.preventDefault()},onBadgeKeydown(e,t){let i=!1;switch(e.key){case"Backspace":case"Delete":{H(e,t),i=!0;break}}i&&e.preventDefault()}}};return o}const Ae={slotBadgeLabel:({itemContext:s})=>s.item,slotItem:({itemContext:s})=>s.item},Le=ye(Ne,Ae,{}),Me=Le;function Pe(s){return n.jsx(n.Fragment,{children:""+s.itemContext.item})}function Be(s){return n.jsx(n.Fragment,{children:""+s.itemContext.item})}function Te({itemContext:s,slotContext:a}){return n.jsx("div",{...U(a.widget.directives.badgeAttributesDirective,s),children:n.jsx(z,{slotContent:a.state.slotBadgeLabel,props:{...a,itemContext:s}})})}function Ee({slotContext:s}){const a=[];for(const r of s.state.selectedContexts)a.push(n.jsx(Te,{itemContext:r,slotContext:s},r.id));return a.length?n.jsx(n.Fragment,{children:a}):null}function Ke({itemContext:s,slotContext:a}){const r=Se("dropdown-item","position-relative",{"text-bg-primary":s===a.state.highlighted});return n.jsx("li",{className:r,...U(a.widget.directives.itemAttributesDirective,s),children:n.jsx(z,{slotContent:a.state.slotItem,props:{...a,itemContext:s}})})}function Re({slotContext:s}){const{directives:{hasFocusDirective:a,floatingDirective:r,menuAttributesDirective:g}}=s.widget;return n.jsx("ul",{...P([M,"dropdown-menu show"],a,r,g),children:s.state.visibleItems.map(p=>n.jsx(Ke,{slotContext:s,itemContext:p},p.id))})}const Oe={slotBadgeLabel:Pe,slotItem:Be};function Ve(s){const[a,r]=je(Me,s,"select",Oe),g={state:a,widget:xe(r)},{id:p,ariaLabel:h,visibleItems:D,filterText:I,open:C,className:F}=a,y=`${p}-menu`,{directives:{hasFocusDirective:j,referenceDirective:v,inputContainerDirective:S}}=r;return n.jsxs("div",{...P([M,`au-select dropdown border border-1 p-1 mb-3 d-block ${F}`],v),children:[n.jsxs("div",{...P([M,"d-flex align-items-center flex-wrap gap-1"],j,S),children:[n.jsx(Ee,{slotContext:g}),n.jsx("input",{id:p,"aria-label":h,className:"au-select-input flex-grow-1 border-0",type:"text",value:I,"aria-autocomplete":"list",autoCorrect:"off",autoCapitalize:"none",autoComplete:"off",onInput:r.actions.onInput,onKeyDown:b=>r.actions.onInputKeydown(b.nativeEvent)})]}),C&&D.length>0&&n.jsx(Re,{slotContext:g,menuId:y})]})}export{Ve as S};
