const Y=(t,e)=>Object.is(t,e)&&(!t||typeof t!="object")&&typeof t!="function",R=[];let A=!1;const g=t=>{const e=!A;A=!0;let s=!0,n,r;try{n=t()}finally{if(e){for(;R.length>0;){const i=R.shift();try{i.notify()}catch(u){s&&(s=!1,r=u)}}A=!1}}if(s)return n;throw r},T=t=>{try{if(t.skipMarkDirty=!0,t.producer.updateValue(),t.producer.flags&16)throw new Error("assert failed: store still dirty after updating it")}finally{t.skipMarkDirty=!1}},v=()=>{},E=(t,e)=>{const s=t?t[e]:null;return typeof s=="function"?s.bind(t):v},O={next:v,pause:v,resume:v},fe=t=>({next:typeof t=="function"?t.bind(null):E(t,"next"),pause:E(t,"pause"),resume:E(t,"resume")});class he{constructor(e,s){this.dirtyCount=1,this.subscriber=fe(s),this.link=e.registerConsumer(e.newLink(this)),this.notify(!0)}unsubscribe(){this.subscriber!==O&&(this.subscriber=O,this.link.producer.unregisterConsumer(this.link))}markDirty(){this.dirtyCount++,R.push(this),this.dirtyCount===1&&this.subscriber.pause()}notify(e=!1){if(this.dirtyCount--,this.dirtyCount===0&&this.subscriber!==O){const s=this.link,n=s.producer;if(T(s),n.isLinkUpToDate(s)&&!e)this.subscriber.resume();else{const r=n.updateLink(s);this.subscriber.next(r)}}}}let p=null;const y=t=>{const e=p;return p=t,e},M=t=>{let e;const s=y(null);try{e=t()}finally{y(s)}return e};let w=!1;const m=()=>{if(w)throw new Error("Reading or writing a signal is forbidden during the notification phase.")};let N=0;class Z{constructor(e){this.value=e,this.flags=0,this.version=0,this.equalFn=Y,this.equalCache=null,this.consumerLinks=[]}newLink(e){return{version:-1,value:void 0,producer:this,indexInProducer:0,consumer:e,skipMarkDirty:!1}}isLinkUpToDate(e){if(e.version===this.version)return!0;if(e.version===this.version-1||e.version<0)return!1;let s=this.equalCache;s||(s={},this.equalCache=s);let n=s[e.version];return n===void 0&&(n=this.equal(e.value,this.value),s[e.version]=n),n}updateLink(e){return e.value=this.value,e.version=this.version,this.readValue()}registerConsumer(e){const s=this.consumerLinks,n=s.length;return e.indexInProducer=n,s[n]=e,e}unregisterConsumer(e){const s=this.consumerLinks,n=e.indexInProducer;if(s[n]!==e)throw new Error("assert failed: invalid indexInProducer");const r=s.pop();e===r?n===0&&this.checkUnused():(s[n]=r,r.indexInProducer=n)}checkUnused(){}updateValue(){}equal(e,s){const n=this.equalFn;return n(e,s)}increaseEpoch(){N++,this.markConsumersDirty()}set(e){m(),this.equal(this.value,e)||g(()=>{this.value=e,this.version++,this.equalCache=null,this.increaseEpoch()})}update(e){this.set(e(this.value))}markConsumersDirty(){const e=w;w=!0;try{const s=this.consumerLinks;for(let n=0,r=s.length;n<r;n++){const i=s[n];i.skipMarkDirty||i.consumer.markDirty()}}finally{w=e}}get(){return m(),p?p.addProducer(this):this.readValue()}readValue(){return this.value}subscribe(e){m();const s=new he(this,e),n=()=>s.unsubscribe();return n.unsubscribe=n,n}}let C=null,I=!1;const pe=()=>{if(I)throw new Error("assert failed: recursive flushUnused call");I=!0;try{const t=C;if(t){C=null;for(let e=0,s=t.length;e<s;e++){const n=t[e];n.flags&=-5,n.checkUnused()}}}finally{I=!1}};class x extends Z{constructor(){super(...arguments),this.extraUsages=0}updateValue(){if(!(this.flags&2)){if(!this.extraUsages&&!this.consumerLinks.length)throw new Error("assert failed: untracked producer usage");this.flags|=2,M(()=>this.startUse())}}checkUnused(){const e=this.flags;e&2&&!this.extraUsages&&!this.consumerLinks.length&&(I||e&1?(this.flags&=-3,M(()=>this.endUse())):e&4||(this.flags|=4,C||(C=[],queueMicrotask(pe)),C.push(this)))}get(){if(m(),p)return p.addProducer(this);this.extraUsages++;try{if(this.updateValue(),this.flags&16)throw new Error("assert failed: store still dirty after updating it");return this.readValue()}finally{--this.extraUsages===0&&this.checkUnused()}}}const _=()=>{};_.unsubscribe=_;const $=t=>{if(!t)return _;if(t.unsubscribe===t)return t;const e=typeof t=="function"?()=>t():()=>t.unsubscribe();return e.unsubscribe=e,e};class be extends x{constructor(e){super(void 0),this.subscribable=e,this.subscriber=this.createSubscriber(),this.unsubscribe=null,this.flags=1}createSubscriber(){const e=s=>this.set(s);return e.next=e,e.pause=()=>{this.markConsumersDirty()},e}startUse(){this.unsubscribe=$(this.subscribable.subscribe(this.subscriber))}endUse(){const e=this.unsubscribe;e&&(this.unsubscribe=null,e())}}const ee=typeof Symbol=="function"&&Symbol.observable||"@@observable",ge=function(){return this},te=Symbol(),H=new WeakMap,P=t=>{const e=t[te];if(e)return e;let s=H.get(t);if(!s){let n=t;"subscribe"in n||(n=n[ee]()),s=new be(n),H.set(t,s)}return s},S=(t,e)=>{const s=t.get.bind(t);return e&&Object.assign(s,e),s.get=s,s.subscribe=t.subscribe.bind(t),s[ee]=ge,s[te]=t,s},Q=1e3,k=Symbol("UNSET"),L=Symbol("ERRORED"),G=t=>t===k||t===L;class se extends x{constructor(){super(...arguments),this.flags=16}equal(e,s){return G(e)||G(s)?!1:super.equal(e,s)}markDirty(){this.flags&16||(this.flags|=16,this.markConsumersDirty())}readValue(){const e=this.value;if(e===L)throw this.error;if(e===k)throw new Error("assert failed: computed value is not set");return e}updateValue(){if(this.flags&8)throw new Error("recursive computed");if(super.updateValue(),!(this.flags&16))return;this.flags|=8;const e=y(null);try{let s=0;do{do if(s++,this.flags&=-17,this.areProducersUpToDate())return;while(this.flags&16&&s<Q);this.recompute()}while(this.flags&16&&s<Q);this.flags&16&&(this.flags&=-17,this.error=new Error("reached maximum number of store changes in one shot"),this.set(L))}finally{y(e),this.flags&=-9}}}class ve extends se{constructor(e){super(k),this.computeFn=e,this.producerIndex=0,this.producerLinks=[],this.epoch=-1}increaseEpoch(){}updateValue(){this.flags&2&&this.epoch===N||(super.updateValue(),this.epoch=N)}get(){return!p&&!w&&this.epoch===N&&(!(this.flags&1)||this.flags&2)?this.readValue():super.get()}addProducer(e){const s=this.producerLinks,n=this.producerIndex;let r=s[n];return(r==null?void 0:r.producer)!==e&&(r&&s.push(r),r=e.registerConsumer(e.newLink(this))),s[n]=r,this.producerIndex=n+1,T(r),e.flags&1&&(this.flags|=1),e.updateLink(r)}startUse(){const e=this.producerLinks;for(let s=0,n=e.length;s<n;s++){const r=e[s];r.producer.registerConsumer(r)}this.flags|=16}endUse(){const e=this.producerLinks;for(let s=0,n=e.length;s<n;s++){const r=e[s];r.producer.unregisterConsumer(r)}}areProducersUpToDate(){if(this.value===k)return!1;const e=this.producerLinks;for(let s=0,n=e.length;s<n;s++){const r=e[s],i=r.producer;if(T(r),!i.isLinkUpToDate(r))return!1}return!0}recompute(){let e;const s=y(this);try{this.producerIndex=0,this.flags&=-2;const i=this.computeFn;e=i(),this.error=null}catch(i){e=L,this.error=i}finally{y(s)}const n=this.producerLinks,r=this.producerIndex;if(r<n.length)for(let i=0,u=n.length-r;i<u;i++){const o=n.pop();o.producer.unregisterConsumer(o)}this.set(e)}}class me{constructor(e){this.value=e,this.flags=0}newLink(e){return{producer:this}}registerConsumer(e){return e}unregisterConsumer(e){}updateValue(){}isLinkUpToDate(e){return!0}updateLink(e){return this.value}get(){return m(),this.value}subscribe(e){var s;return m(),typeof e=="function"?e(this.value):(s=e==null?void 0:e.next)==null||s.call(e,this.value),_}}class ne extends se{constructor(e,s){super(s),this.producerLinks=null,this.cleanUpFn=null,this.flags=17;const n=Array.isArray(e);this.arrayMode=n,this.producers=(n?e:[e]).map(P)}callCleanUpFn(){const e=this.cleanUpFn;e&&(this.cleanUpFn=null,e())}startUse(){this.producerLinks=this.producers.map(e=>e.registerConsumer(e.newLink(this))),this.flags|=16}endUse(){this.callCleanUpFn();const e=this.producerLinks;if(this.producerLinks=null,e)for(let s=0,n=e.length;s<n;s++){const r=e[s];r.producer.unregisterConsumer(r)}}areProducersUpToDate(){const e=this.producerLinks;let s=this.value!==k;for(let n=0,r=e.length;n<r;n++){const i=e[n],u=i.producer;T(i),u.isLinkUpToDate(i)||(s=!1)}return s}recompute(){try{this.callCleanUpFn();const e=this.producerLinks.map(s=>s.producer.updateLink(s));this.cleanUpFn=$(this.derive(this.arrayMode?e:e[0]))}catch(e){this.error=e,this.set(L)}}}class ye extends ne{constructor(e,s,n){super(e,k),this.deriveFn=n}derive(e){const s=this.deriveFn;this.set(s(e))}}const re=t=>{const e=t.set.bind(t);return e.set=e,e.update=t.update.bind(t),e};class ke extends ne{constructor(e,s,n){super(e,s),this.deriveFn=n,this.setFn=re(this)}derive(e){const s=this.deriveFn;return s(e,this.setFn)}}class Ue extends x{constructor(e,s){super(e),this.onUseFn=s,this.cleanUpFn=null,this.flags=1}startUse(){this.cleanUpFn=$(this.onUseFn())}endUse(){const e=this.cleanUpFn;e&&(this.cleanUpFn=null,e())}}function D(t,e){return S(P(t),e)}const J=function(t){this.set(t(M(()=>this.get())))};function j(t,e){return D(t,typeof e=="function"?{set:e,update:J}:{...e,set:(e==null?void 0:e.set)??v,update:(e==null?void 0:e.update)??(e!=null&&e.set?J:v)})}const we=t=>P(t).get(),ie=(t,e)=>{const s=new Ue(t,()=>e(n)),n=re(s);return s},q=(t,e)=>{if(e){const{equal:s,notEqual:n}=e;s?t.equalFn=s:n&&(t.equalFn=(r,i)=>!n(r,i))}return t};function W(t,e){typeof e=="function"&&(e={onUse:e});const s=e==null?void 0:e.onUse;return S(s?q(ie(t,s),e):new me(t))}function F(t,e){typeof e=="function"&&(e={onUse:e});const s=e==null?void 0:e.onUse,n=q(s?ie(t,s):new Z(t),e),r=S(n);return r.set=n.set.bind(n),r.update=n.update.bind(n),r}function Ce(t){return t.length<=1}function Le(t,e,s){typeof e=="function"&&(e={derive:e});const{derive:n,...r}=e,i=Ce(n)?ye:ke;return S(q(new i(t,s,n),r))}function d(t,e){return S(q(new ve(t),e))}const K=Symbol(),Se=()=>{},ue=t=>t;function oe(t){var e,s,n="";if(typeof t=="string"||typeof t=="number")n+=t;else if(typeof t=="object")if(Array.isArray(t)){var r=t.length;for(e=0;e<r;e++)t[e]&&(s=oe(t[e]))&&(n&&(n+=" "),n+=s)}else for(s in t)t[s]&&(n&&(n+=" "),n+=s);return n}function De(){for(var t,e,s=0,n="",r=arguments.length;s<r;s++)(t=arguments[s])&&(e=oe(t))&&(n&&(n+=" "),n+=e);return n}const z=t=>{var e;const s=((e=t==null?void 0:t.ownerDocument)==null?void 0:e.defaultView)??window;return t instanceof s.HTMLElement},ce=t=>(e,s)=>{if(z(e))return t(e,s)},We=(t,e)=>s=>{let n=!0,r;const i=e.subscribe(u=>{var o;n?(n=!1,r=t(s,u)):(o=r==null?void 0:r.update)==null||o.call(r,u)});return{destroy(){var u;(u=r==null?void 0:r.destroy)==null||u.call(r),i()}}};W(void 0);const ze=(t,e=!0)=>()=>{const s=t.subscribe(Se);return{destroy:async()=>{e&&await Promise.resolve(),s()}}},ae={equal:Object.is},Fe=()=>{const t=F([],ae);return D(t,{register:e=>{let s=!1;return t.update(n=>[...n,e]),()=>{s||(s=!0,t.update(n=>{const r=n.indexOf(e);if(r>-1){const i=[...n];return i.splice(r,1),i}return n}))}}})},Ne=()=>{const t=Fe();return{elements$:D(t),directive:e=>({destroy:t.register(e)})}},Be=()=>{const{directive:t,elements$:e}=Ne();return{directive:ce(t),elements$:e}},Ie=()=>{const t=F(null,ae);return{element$:D(t),directive:e=>{let s=!1;return t.update(n=>n?(console.error("The directive cannot be used on multiple elements.",n,e),n):(s=!0,e)),s?{destroy(){t.update(n=>e===n?null:n)}}:void 0}}},He=()=>{const{directive:t,element$:e}=Ie();return{directive:ce(t),element$:e}},Qe=(...t)=>(e,s)=>{const n=g(()=>t.map(r=>r(e,s)));return{update(r){g(()=>n.forEach(i=>{var u;return(u=i==null?void 0:i.update)==null?void 0:u.call(i,r)}))},destroy(){g(()=>n.reverse().forEach(r=>{var i;return(i=r==null?void 0:r.destroy)==null?void 0:i.call(r)}))}}},Ge=(t,e)=>{const s=[],n=r=>g(()=>{r.forEach((u,o)=>{var l,a,c,f;const[h,U]=Array.isArray(u)?u:[u,void 0],b=s[o];if(b){if(b.directive===h){b.arg!==U&&((a=(l=b.instance)==null?void 0:l.update)==null||a.call(l,U),b.arg=U);return}(f=(c=b.instance)==null?void 0:c.destroy)==null||f.call(c)}const de=h(t,U);s[o]={directive:h,instance:de,arg:U}}),s.splice(r.length).reverse().forEach(({instance:u})=>{var o;return(o=u==null?void 0:u.destroy)==null?void 0:o.call(u)})});return n(e),{update:n,destroy:()=>n([])}},Ve=t=>(e,s)=>{const n=[],r=F(s),{events:i,attributes:u,styles:o,classNames:l}=t(r);if(z(e))for(const[a,c]of Object.entries(i??{}))typeof c=="function"?n.push(X(e,a,c)):n.push(X(e,a,c.handler,c.options));for(const[a,c]of Object.entries(u??{}))c!=null&&n.push(Ee(e,a,V(c)));for(const[a,c]of Object.entries(o??{}))c&&n.push(Oe(e,a,V(c)));for(const[a,c]of Object.entries(l??{}))n.push(Re(e,a,V(c)));return{update:a=>r.set(a),destroy:()=>n.forEach(a=>a())}},Je=Ve(t=>({attributes:{class:d(()=>De(t()))}})),Ke=t=>{const e=t.length;if(e===0)return null;let s=t[0];for(let n=1;n<e&&s;n++){const r=t[n];for(;s&&s!==r;){const i=s.compareDocumentPosition(r);if(i&Node.DOCUMENT_POSITION_CONTAINED_BY)break;if(i&Node.DOCUMENT_POSITION_CONTAINS){s=r;break}else if(i&Node.DOCUMENT_POSITION_DISCONNECTED)return null;s=s.parentElement}}return s},Xe=(t=document.body)=>{z(t)&&t.getBoundingClientRect()},Ye=(t,e)=>{e&&e.length>0&&t.classList.add(...e)},Ze=(t,e)=>{e&&e.length>0&&t.classList.remove(...e)};function X(t,e,s,n){return t.addEventListener(e,s,n),function(){t.removeEventListener(e,s,n)}}let Te=0;const _e=()=>`auId-${Te++}`,le=t=>t!=null&&t!==!1;function qe(t,e){let s=new Set;return e.subscribe(n=>{const r=new Set(`${n??""}`.split(" "));r.delete("");const i=t.classList;for(const u of s)r.has(u)||i.remove(u);r.size>0&&i.add(...r),s=r})}function Ae(t,e,s){return s.subscribe(n=>{le(n)?t.setAttribute(e,""+(n===!0?e:n)):t.removeAttribute(e)})}function Ee(t,e,s){return e==="class"?qe(t,s):Ae(t,e,s)}function Oe(t,e,s){return s.subscribe(n=>{const r=t.style;r[e]=""+(le(n)?n:"")})}function Re(t,e,s){const n=s.subscribe(r=>{t.classList.toggle(e,r)});return()=>{n(),t.classList.remove(e)}}function Me(t){return function(e){g(()=>{var s;for(const[n,r]of Object.entries(e))(s=t[`${n}$`])==null||s.set(r)})}}function et(t,e){if(t===e)return null;let s=!1;const n={},r=new Set([...Object.keys(t),...Object.keys(e)]);for(const i of r){const u=e[i];t[i]!==u&&(n[i]=u,s=!0)}return s?n:null}function xe(t,e=W(void 0),s={},n=F(void 0)){const{normalizeValue:r=ue,equal:i=Object.is}=s,u=()=>t,o=(c,f=u)=>{const h=c===void 0?void 0:r(c);return h===K?(console.error("Not using invalid value",c),f()):h===void 0?f():h},l=d(()=>o(e()),{equal:i}),a=d(()=>o(n(),l),{equal:i});return j(a,c=>{if(c!==void 0){const f=r(c);if(f===K){console.error("Not setting invalid value",c);return}c=f}n.set(c)})}const B=t=>!!(t&&typeof t=="function"&&"subscribe"in t),V=t=>B(t)?t:W(t),$e=t=>B(t)?t:F(t),Pe=(t,e)=>{const s={};if(e){const n=B(e);for(const r of t)s[r]=n?d(()=>e()[r]):V(e[r])}return s},tt=(t,e,s)=>{const n={};for(const r of t){const i=e==null?void 0:e[r],u=s==null?void 0:s[r];n[r]=i&&u?d(()=>i()??u()):i||u}return n},je=(t,e,s)=>{const n={},r=Object.keys(t),i=Pe(r,e==null?void 0:e.config),u=e==null?void 0:e.props;for(const o of r){const l=u==null?void 0:u[o];n[`${o}$`]=xe(t[o],i[o],s==null?void 0:s[o],$e(l))}return n},st=(t,e,s)=>{const n=je(t,e,s);return[n,Me(n)]},nt=t=>{const e=[],s=[],n={};for(const[r,i]of Object.entries(t))r.endsWith("$")&&(e.push(r.substring(0,r.length-1)),s.push(i),n[r]=D(i));return{stores:n,state$:d(()=>{const r=s.map(we),i={};return e.forEach((u,o)=>{i[u]=r[o]}),i})}},rt=(t,e,s=r=>r[0],n=(r,i)=>i===r)=>{let r=e[0]();return j(Le(e,{derive(i){const u=s(i),o=!n(i[0],u);return o&&e[0].set(u),(o||!n(r,u))&&(r=u,t()(u)),u},equal:n}),e[0].set.bind(e[0]))},it=(t,e,s=ue,n=Y)=>j(d(()=>s(t()),{equal:n}),r=>{const i=s(r);n(t(),i)||(t.set(i),e()(i))});function ut(t){const e=d(()=>_e());return d(()=>t()||e())}export{et as A,D as B,Ie as C,rt as D,Le as E,Y as F,it as G,He as H,K as I,Be as J,We as K,Ke as L,_e as M,Ve as a,ce as b,Je as c,X as d,Ge as e,F as f,ue as g,d as h,ut as i,j,Fe as k,tt as l,Qe as m,Se as n,Pe as o,ze as p,z as q,W as r,nt as s,Ze as t,Ye as u,Xe as v,st as w,je as x,B as y,g as z};
