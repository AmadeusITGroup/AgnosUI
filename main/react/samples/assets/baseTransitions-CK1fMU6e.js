import{y as U,b as c,w as q,u as X,m as Y,q as B,j as Z,n as b}from"./dom-BhJG5nY--CcHiBM3Q.js";import{d as _,c as m,b as A}from"./writables-e0tyaQpe-DZY09TAT.js";import{p as E}from"./promise-XSP94FjG-BKuDJuiM.js";import{w as F,c as T,s as nn}from"./stores-BiJoFc-J.js";const j=new Promise(b),en=($,h)=>{$.style.display=h==="show"?"":"none"},tn={animated:!0,animatedOnInit:!1,initDone:null,visible:!0,transition:en,onShown:b,onHidden:b,onVisibleChange:b},sn={animated:A,animatedOnInit:A,visible:A,transition:m,onShown:m,onHidden:m,onVisibleChange:m,initDone:_},cn=$=>{const[{animated$:h,initDone$:w,visible$:d,transition$:N,onShown$:R,onHidden$:W,onVisibleChange$:k,animatedOnInit$:z},G]=F(tn,$,sn),{element$:v,directive:J}=U(),y=c(()=>!!v()),u=T(k,[d],([n])=>n),l=q(null),x=()=>{let n;return l.update(e=>(e?.abort.abort(),n=e?.context,null)),n},K=(n,e,o,t)=>B(()=>{const p=new AbortController,i=p.signal,a=x()??{},{promise:r,resolve:S}=E(),f={abort:p,animated:e,visible:n,context:a,element:o,transitionFn:t,promise:r};return l.set(f),S((async()=>{try{await t(o,n?"show":"hide",e,i,a)}finally{i.aborted?await j:(l.set(null),(n?R:W)()?.())}})()),f}),O=c(()=>w()?h():z()),g=q(null);let P,H=d(),s=null;const D=X([u,v,O,g,N,l],([n,e,o,t,p,i])=>{const a=P!==e;P=e;const r=H!==n;if(H=n,e){w()==null&&w.set(!0);const S=t!=null&&i&&i.animated!=t;if(a||r||S){(r||t!=null)&&(s=null);const f=t??s?.animated??(a&&!n?!1:o);i=K(n,f,e,p),s?.resolve(i.promise),s=null}}else a&&(x(),i=null),(r||n&&s?.animated!==t)&&(s=n&&t!=null?{animated:t,...E()}:null);return s?.promise??i?.promise});let I={};const V=async(n=!d(),e=O())=>{const o={};I=o;try{await B(()=>{try{return g.set(e),d.set(n),D()}finally{g.set(null)}})}finally{I!==o&&await j}},C=c(()=>(y()&&D(),!!l())),L=c(()=>!C()&&u()&&y()),M=c(()=>!C()&&!u()),Q=Y(J,Z(D));return{...nn({visible$:u,element$:v,elementPresent$:y,transitioning$:C,shown$:L,hidden$:M}),patch:G,directives:{directive:Q},api:{show:V.bind(null,!0),hide:V.bind(null,!1),toggle:V}}};export{cn as c};
