var ie=(t,e,s)=>{if(!e.has(t))throw TypeError("Cannot "+s)};var o=(t,e,s)=>(ie(t,e,"read from private field"),s?s.call(t):e.get(t)),l=(t,e,s)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,s)},a=(t,e,s,r)=>(ie(t,e,"write to private field"),r?r.call(t,s):e.set(t,s),s);var ve=(t,e,s,r)=>({set _(n){a(t,e,n,s)},get _(){return o(t,e,r)}}),f=(t,e,s)=>(ie(t,e,"access private method"),s);import{r as S}from"./index-ffc26b19.js";const ot=t=>({actions:t.actions,api:t.api,directives:t.directives,state$:t.state$,stores:t.stores}),pe=Symbol();var ye;const se=typeof Symbol=="function"&&Symbol.observable||"@@observable",ae=Symbol(),$=()=>{},H=()=>{};H.unsubscribe=H;const ue=(t,e)=>{const s=t?t[e]:null;return typeof s=="function"?s.bind(t):$},xe=t=>({next:typeof t=="function"?t.bind(null):ue(t,"next"),pause:ue(t,"pause"),resume:ue(t,"resume"),_value:void 0,_valueIndex:0,_paused:!1}),ge=function(){return this},le=t=>{if(!t)return H;if(t.unsubscribe===t)return t;const e=typeof t=="function"?()=>t():()=>t.unsubscribe();return e.unsubscribe=e,e},ce=new WeakSet,Pe=t=>{let e=t.subscribe;return ce.has(e)||(e=(...s)=>le(t.subscribe(...s)),ce.add(e)),e},re=t=>{const e="subscribe"in t?t:t[se]();return Pe(e)},$e=t=>{let e;return t(s=>e=s)(),e};function g(t,e){const s=re(t),r=Object.assign(()=>ke(r),e,{subscribe:s,[se]:ge});return r}const p=Symbol(),Ie=Symbol();let oe=!1;const T=new Set,Ce=1e3,fe=t=>{if(t>Ce)throw new Error("reached maximum number of store changes in one shot")},U=t=>{const e=!oe;e&&(oe=!0);try{return t()}finally{if(e)try{const s=new Map;for(const r of T){const n=s.get(r)??0;fe(n),s.set(r,n+1),T.delete(r),r[Ie]()}}finally{T.clear(),oe=!1}}},_e=t=>$e(re(t));let C=_e;const ke=t=>C(t),Se=t=>({[t]:!0,[t-1]:!1,0:!1}),W=Symbol();var m,A,x,_,q,R,F,J,we,K,qe,j,B;class de{constructor(e){l(this,J);l(this,K);l(this,j);l(this,m,void 0);l(this,A,void 0);l(this,x,void 0);l(this,_,void 0);l(this,q,void 0);l(this,R,void 0);l(this,F,void 0);a(this,m,new Set),a(this,A,null),a(this,x,!1),a(this,_,1),a(this,R,Se(1)),a(this,F,new WeakMap),this[ye]=!1,a(this,q,e)}[(ye=W,Ie)](){const e=o(this,_);for(const s of[...o(this,m)]){if(o(this,x)||o(this,_)!==e)return;s._valueIndex!==0&&f(this,j,B).call(this,s)}}[p](){}equal(e,s){return!this.notEqual(e,s)}notEqual(e,s){return!Object.is(e,s)||e&&typeof e=="object"||typeof e=="function"}pauseSubscribers(){if(!o(this,x)){a(this,x,!0),T.delete(this);for(const e of[...o(this,m)])e._valueIndex===0||e._paused||(e._paused=!0,e.pause())}}resumeSubscribers(){o(this,x)&&(a(this,x,!1),U(()=>{T.add(this)}))}set(e){const s=this[W];if(s||!this.equal(o(this,q),e)){const r=o(this,_)+1;a(this,_,r),a(this,q,e),a(this,R,Se(r)),s&&delete o(this,R)[r-1],this.pauseSubscribers()}this.resumeSubscribers()}update(e){this.set(e(o(this,q)))}onUse(){}subscribe(e){const s=xe(e),r=e==null?void 0:e[ae];if(r){const i=o(this,F).get(r);i&&(s._value=i._value,s._valueIndex=i._valueIndex)}o(this,m).add(s),U(()=>{o(this,m).size==1?f(this,J,we).call(this):this[p]()}),f(this,j,B).call(this,s);const n=()=>{const i=o(this,m).delete(s);s.next=$,s.pause=$,s.resume=$,i&&(o(this,F).set(n,s),o(this,m).size===0&&f(this,K,qe).call(this))};return n[p]=()=>{this[p](),f(this,j,B).call(this,s)},n.unsubscribe=n,n}[se](){return this}}m=new WeakMap,A=new WeakMap,x=new WeakMap,_=new WeakMap,q=new WeakMap,R=new WeakMap,F=new WeakMap,J=new WeakSet,we=function(){a(this,A,le(this.onUse()))},K=new WeakSet,qe=function(){const e=o(this,A);e&&(a(this,A,null),e())},j=new WeakSet,B=function(e){const s=o(this,R),r=o(this,_),n=o(this,q);let i=s[e._valueIndex];i==null&&(i=!!this.equal(e._value,n),s[e._valueIndex]=i),e._valueIndex=r,i?!o(this,x)&&e._paused&&(e._paused=!1,e.resume()):(e._value=n,e._paused=!1,e.next(n))};function ze(t){const e=s=>(s!=null&&s[ae]||xe(s).next(t),H);return ce.add(e),Object.assign(()=>t,{subscribe:e,[se]:ge})}class Ee extends de{constructor(e){super(e)}set(e){super.set(e)}update(e){super.update(e)}}const ne=(t,e)=>{const{onUse:s,equal:r,notEqual:n}=e;return s&&(t.onUse=function(){const i=u=>this.set(u);return i.set=i,i.update=u=>this.update(u),s(i)}),r&&(t.equal=function(i,u){return r(i,u)}),n&&(t.notEqual=function(i,u){return n(i,u)}),t};function he(t,e={}){return typeof e=="function"&&(e={onUse:e}),e.onUse?g(ne(new Ee(t),e)):ze(t)}function X(t,e={}){typeof e=="function"&&(e={onUse:e});const s=ne(new Ee(t),e);return g(s,{set:s.set.bind(s),update:s.update.bind(s)})}function Fe(t){return t.length<=1}const je=t=>t();var L,G,y;class me extends de{constructor(s,r){super(r);l(this,L,void 0);l(this,G,void 0);l(this,y,0);const n=Array.isArray(s);a(this,L,n),a(this,G,(n?[...s]:[s]).map(re))}resumeSubscribers(){o(this,y)||super.resumeSubscribers()}onUse(){let s=!1,r=0;const n=o(this,L),i=o(this,G),u=new Array(i.length);let c=null;const h=()=>{const d=c;d&&(c=null,d())},I=(d=!1)=>{d&&(s=!0),s&&!o(this,y)&&(r&&(r=0,h(),c=le(this.derive(n?u:u[0]))),this.resumeSubscribers())},b=i.map((d,D)=>{const w=Re=>{u[D]=Re,r|=1<<D,a(this,y,o(this,y)&~(1<<D)),I()};return w.next=w,w.pause=()=>{a(this,y,o(this,y)|1<<D),this.pauseSubscribers()},w.resume=()=>{a(this,y,o(this,y)&~(1<<D)),I()},d(w)}),V=(d,D)=>{var w;o(this,y)&1<<D&&((w=d[p])==null||w.call(d))};return this[p]=()=>{let d=0;for(;o(this,y)&&(fe(++d),s=!1,b.forEach(V),!o(this,y));)I(!0)},I(!0),this[p](),()=>{this[p]=$,h(),b.forEach(je)}}}L=new WeakMap,G=new WeakMap,y=new WeakMap;function Ne(t,e,s){typeof e=="function"&&(e={derive:e});const{derive:r,...n}=e,i=Fe(r)?class extends me{constructor(u,c){super(u,c),this[W]=!0}derive(u){this.set(r(u)),this[W]=!1}}:class extends me{derive(u){const c=h=>this.set(h);return c.set=c,c.update=h=>this.update(h),r(u,c)}};return g(ne(new i(t,s),{...n,onUse:void 0}))}const We=t=>{const e=C;try{return C=_e,t()}finally{C=e}},Me=({unsubscribe:t})=>t(),Te=({resubscribe:t})=>t();var N,k,E,v,Y,Z,Oe,ee,Ue,P,M,O,z,te,Ve;class Qe extends de{constructor(){super(void 0);l(this,Z);l(this,ee);l(this,P);l(this,O);l(this,te);l(this,N,!1);l(this,k,!1);l(this,E,0);l(this,v,new Map);l(this,Y,s=>We(()=>f(this,ee,Ue).call(this,s)));this[W]=!0}resumeSubscribers(){f(this,O,z).call(this)||super.resumeSubscribers()}[p](){var r;if(o(this,N))throw new Error("recursive computed");let s=0;for(;f(this,O,z).call(this);){fe(++s),a(this,k,!0);try{for(const[,{pending:n,unsubscribe:i}]of o(this,v))n&&((r=i[p])==null||r.call(i))}finally{a(this,k,!1)}if(f(this,O,z).call(this))break;f(this,P,M).call(this)}}onUse(){return f(this,P,M).call(this,!0),this[p](),()=>o(this,v).forEach(Me)}}N=new WeakMap,k=new WeakMap,E=new WeakMap,v=new WeakMap,Y=new WeakMap,Z=new WeakSet,Oe=function(s){const r={versionIndex:o(this,E),unsubscribe:$,resubscribe:$,pending:!1,usedValueIndex:0,value:void 0,valueIndex:0},n=i=>{r.value=i,r.valueIndex++,r.pending=!1,!o(this,k)&&!f(this,O,z).call(this)&&U(()=>f(this,P,M).call(this))};return n.next=n,n.pause=()=>{r.pending=!0,this.pauseSubscribers()},n.resume=()=>{r.pending=!1,!o(this,k)&&!f(this,O,z).call(this)&&U(()=>f(this,P,M).call(this))},r.resubscribe=()=>{r.unsubscribe=s(n),n[ae]=r.unsubscribe},r.resubscribe(),r},ee=new WeakSet,Ue=function(s){var n,i;let r=o(this,v).get(s);return r?(r.versionIndex=o(this,E),(i=(n=r.unsubscribe)[p])==null||i.call(n)):(r=f(this,Z,Oe).call(this,re(s)),o(this,v).set(s,r)),r.usedValueIndex=r.valueIndex,r.value},P=new WeakSet,M=function(s=!1){a(this,N,!0),a(this,k,!0);try{if(o(this,E)>0&&(s&&o(this,v).forEach(Te),!f(this,te,Ve).call(this))){this.resumeSubscribers();return}ve(this,E)._++;const r=o(this,E),n=C;let i;try{C=o(this,Y),i=this.compute()}finally{C=n}this.set(i),this[W]=!1;for(const[u,c]of o(this,v))c.versionIndex!==r&&(o(this,v).delete(u),c.unsubscribe())}finally{a(this,k,!1),a(this,N,!1)}},O=new WeakSet,z=function(){for(const[,{pending:s}]of o(this,v))if(s)return!0;return!1},te=new WeakSet,Ve=function(){for(const[,{valueIndex:s,usedValueIndex:r}]of o(this,v))if(s!=r)return!0;return!1};function Q(t,e={}){const s=class extends Qe{compute(){return t()}};return g(ne(new s,{...e,onUse:void 0}))}const Le=()=>{},Ge=t=>t;function Xe(t){return function(e){U(()=>{var s;for(const[r,n]of Object.entries(e??{}))(s=t[`${r}$`])==null||s.set(n)})}}function De(t,e){if(t===e)return null;let s=!1;const r={},n=new Set([...Object.keys(t),...Object.keys(e)]);for(const i of n){const u=e[i];t[i]!==u&&(r[i]=u,s=!0)}return s?r:null}const Be=function(t){this.set(t(this()))};function He(t,e=he(void 0),s={},r=X(void 0)){const{normalizeValue:n=Ge,equal:i=Object.is}=s,u=()=>t,c=(b,V=u)=>{const d=b===void 0?void 0:n(b);return d===pe?(console.error("Not using invalid value",b),V()):d===void 0?V():d},h=Q(()=>c(e()),{equal:i}),I=Q(()=>c(r(),h),{equal:i});return g(I,{set(b){if(b!==void 0){const V=n(b);if(V===pe){console.error("Not setting invalid value",b);return}b=V}r.set(b)},update:Be})}const be=t=>!!(t&&typeof t=="function"&&"subscribe"in t),Je=t=>be(t)?t:he(t),Ke=t=>be(t)?t:X(t),Ye=(t,e)=>{const s={};if(e){const r=be(e);for(const n of t)s[n]=r?Q(()=>e()[n]):Je(e[n])}return s},ct=(t,e,s)=>{const r={};for(const n of t){const i=e==null?void 0:e[n],u=s==null?void 0:s[n];r[n]=i&&u?Q(()=>i()??u()):i||u}return r},Ze=(t,e,s)=>{const r={},n=Object.keys(t),i=Ye(n,e==null?void 0:e.config),u=e==null?void 0:e.props;for(const c of n){const h=u==null?void 0:u[c];r[`${c}$`]=He(t[c],i[c],s==null?void 0:s[c],Ke(h))}return r},at=(t,e,s)=>{const r=Ze(t,e,s);return[r,Xe(r)]},lt=t=>{const e=[],s=[],r={};for(const n of Object.keys(t))if(n.endsWith("$")){const i=t[n];e.push(n.substring(0,n.length-1)),s.push(i),r[n]=g(i)}return{stores:r,state$:Q(()=>{const n=s.map(ke),i={};return e.forEach((u,c)=>{i[u]=n[c]}),i})}},ft=(t,e,s=n=>n[0],r=(n,i)=>i===n)=>{let n=e[0]();return Ne(e,{derive(i){const u=s(i),c=!r(i[0],u);return c&&e[0].set(u),(c||!r(n,u))&&(n=u,t()(u)),u},equal:r})},et=(t,e)=>s=>{let r=!0,n;const i=e.subscribe(u=>{var c;r?(r=!1,n=t(s,u)):(c=n==null?void 0:n.update)==null||c.call(n,u)});return{destroy(){var u;(u=n==null?void 0:n.destroy)==null||u.call(n),i()}}},tt=he(void 0),dt=t=>et(t,tt),ht=(t,e=!0)=>()=>{const s=t.subscribe(Le);return{destroy:async()=>{e&&await 0,s()}}},bt=t=>(e,s)=>(t(s),{update:t}),Ae={equal:Object.is},st=()=>{const t=X([],Ae);return g(t,{register:e=>{let s=!1;return t.update(r=>[...r,e]),()=>{s||(s=!0,t.update(r=>{const n=r.indexOf(e);if(n>-1){const i=[...r];return i.splice(n,1),i}return r}))}}})},vt=()=>{const t=st();return{elements$:g(t),directive:e=>({destroy:t.register(e)})}},pt=()=>{const t=X(null,Ae);return{element$:g(t),directive:e=>{let s=!1;return t.update(r=>r?(console.error("The directive cannot be used on multiple elements.",r,e),r):(s=!0,e)),s?{destroy(){t.update(r=>e===r?null:r)}}:void 0}}},yt=(...t)=>(e,s)=>{const r=U(()=>t.map(n=>n(e,s)));return{update(n){U(()=>r.forEach(i=>{var u;return(u=i==null?void 0:i.update)==null?void 0:u.call(i,n)}))},destroy(){U(()=>r.reverse().forEach(n=>{var i;return(i=n==null?void 0:n.destroy)==null?void 0:i.call(n)}))}}};function St(t,e={},...s){const r=S.useRef(void 0);r.current||(r.current=t(...s),r.current.patch(e));const n=r.current,i=S.useRef(e);return S.useEffect(()=>{const c=De(i.current,e);i.current=e,c&&n.patch(c)},[e]),[rt(n.state$),n]}function rt(t){const[e,s]=S.useState(()=>t());return S.useEffect(()=>t.subscribe(r=>{s(()=>r)}),[t]),e}function mt(t,e){var i,u;const s=S.useRef(),r=S.useRef(),n=S.useCallback(c=>{var h,I;(I=(h=s.current)==null?void 0:h.destroy)==null||I.call(h),s.current=void 0,c&&(s.current=t(c,r.current))},[t]);return r.current=e,(u=(i=s.current)==null?void 0:i.update)==null||u.call(i,e),n}const nt=(t,e)=>!De(t,e),xt=t=>{const e=S.useRef();return e.current||(e.current=X({...t},{equal:nt})),S.useEffect(()=>{e.current.set({...t})},[t]),S.useMemo(()=>g(e.current),[e.current])};export{bt as A,pe as I,Q as a,ht as b,pt as c,Ne as d,rt as e,X as f,ct as g,Le as h,ft as i,he as j,dt as k,Ze as l,yt as m,Ye as n,U as o,vt as p,et as q,st as r,lt as s,ot as t,mt as u,g as v,at as w,Ge as x,xt as y,St as z};
