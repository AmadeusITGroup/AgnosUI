import{n as R,w as x,b as i,m as U,a as h,e as V,z as j,r as u}from"./dom-gfxqXJpK-CN0vfJPb.js";import{c as B}from"./navManager-DPMP00fL.js";import{w as G,s as J,t as K}from"./stores-CrOGt1RN.js";import{c as f,t as Q,a as W}from"./writables-CgpOQ4hA-a53iZWzs.js";const X={className:"",nodes:[],onExpandToggle:R,navSelector:o=>o.querySelectorAll("button"),ariaLabelToggleFn:o=>`Toggle ${o}`},Y={className:W,nodes:Q,onExpandToggle:f,navSelector:f,ariaLabelToggleFn:f};function re(o){const[{nodes$:w,onExpandToggle$:T,navSelector$:D,ariaLabelToggleFn$:y,...A},I]=G(X,o,Y),p=new Map,L={get(e){return e.isExpanded}},c=x({}),N=i(()=>(m(),c(),L)),{elementsInDomOrder$:_,directive:$,refreshElements:k,focusIndex:S,focusPrevious:F,focusNext:M,focusFirst:P,focusLast:z}=B(),H=i(()=>({keys:{ArrowUp:F,ArrowDown:M,Home:P,End:z},selector:D()})),g=(e,t,a)=>{var r;const s={...e,ariaLabel:e.ariaLabel??e.label,level:t,children:[],isExpanded:(r=e.children)!=null&&r.length?e.isExpanded??!1:void 0};return p.set(s,{parent:a}),e.children&&(s.children=e.children.map(n=>g(n,t+1,s))),s},m=i(()=>(p.clear(),w().map(e=>g(e,0,void 0)))),v=x(m().find(e=>e.isExpanded!==void 0)),l=e=>{const t=p.get(e);return t||console.error(`Node ${e.label} doesn't exist in the map`),t},O=V((e,t)=>{let a;const r=()=>{a&&a.htmlElement===e&&(a.htmlElement=void 0),a=void 0},s=n=>{r(),a=l(n.item),a&&(a.htmlElement&&console.warn("The tree item directive should be used once per element"),a.htmlElement=e)};return s(t),{update:s,destroy:r}}),b=e=>{var t;if(e){const a=(t=l(e))==null?void 0:t.htmlElement;if(a){const r=_().indexOf(a);S(r,0)}}},q=h(e=>({events:{focus:()=>{const{item:t}=e();v.set(t)},click:()=>{const{item:t}=e();d(t)},keydown:t=>{var a,r;const{key:s}=t,{item:n}=e(),E=n.isExpanded;switch(k(),s){case"Enter":case" ":d(n);break;case"ArrowLeft":E?d(n):b((a=l(n))==null?void 0:a.parent);break;case"ArrowRight":E?b((r=n.children)==null?void 0:r[0]):d(n);break;default:return}t.preventDefault(),t.stopPropagation()}},attributes:{"aria-label":i(()=>{const{item:t}=e();return y()(t.ariaLabel)}),tabindex:i(()=>{const{item:t}=e();return t===v()?"0":"-1"}),type:u("button")},classNames:{"au-tree-expand-icon":K,"au-tree-expand-icon-expanded":i(()=>{c();const{item:t}=e();return t.isExpanded??!1})}})),d=e=>{l(e)===void 0||e.isExpanded===void 0||(e.isExpanded=!e.isExpanded,c.set({}),T()(e))};return{...J({normalizedNodes$:m,expandedMap$:N,...A}),patch:I,api:{},directives:{navigationDirective:j($,H),itemToggleDirective:U(O,q),itemAttributesDirective:h(e=>({attributes:{role:u("treeitem"),"aria-selected":u("false"),"aria-expanded":i(()=>{var t;const{item:a}=e();return c(),(t=a.isExpanded)==null?void 0:t.toString()})}}))}}}export{re as c};
