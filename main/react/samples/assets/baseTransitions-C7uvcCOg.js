import{n as $,w as Q,D as X,f as d,E as Y,e as q,F as Z,s as F,B as G,o as T,q as ee,G as ne}from"./directive-CKEccryv-BXYvEkQs.js";import{t as C,a as f,c as te}from"./writables-DoU_XYTX-CmGvgT4E.js";import{p as N}from"./promise-CY2U8bTP-D7Q2lx8N.js";const R=new Promise($),ie=(b,h)=>{b.style.display=h==="show"?"":"none"},oe={animated:!0,animatedOnInit:!1,initDone:null,visible:!0,transition:ie,onShown:$,onHidden:$,onVisibleChange:$},se={animated:C,animatedOnInit:C,visible:C,transition:f,onShown:f,onHidden:f,onVisibleChange:f,initDone:te},de=b=>{const[{animated$:h,initDone$:m,visible$:c,transition$:U,onShown$:W,onHidden$:_,onVisibleChange$:j,animatedOnInit$:k},S]=Q(oe,b,se),{element$:w,directive:z}=X(),A=d(()=>!!w()),u=Y(j,[c],([e])=>e),a=q(null),y=d(()=>!!a()),x=()=>{let e;return a.update(n=>(n==null||n.abort.abort(),e=n==null?void 0:n.context,null)),e},J=(e,n,s,i)=>G(()=>{const p=new AbortController,o=p.signal,l=x()??{},{promise:r,resolve:V}=N(),v={abort:p,animated:n,visible:e,context:l,element:s,transitionFn:i,promise:r};return a.set(v),V((async()=>{var I;try{await i(s,e?"show":"hide",n,o,l)}finally{o.aborted?await R:(a.set(null),(I=(e?W:_)())==null||I())}})()),v}),K=d(()=>!y()&&u()&&A()),L=d(()=>!y()&&!u()),O=d(()=>m()?h():k()),D=q(null);let P,B=c(),t=null;const E=Z([u,w,O,D,U,a],([e,n,s,i,p,o])=>{const l=P!==n;P=n;const r=B!==e;if(B=e,n){m()==null&&m.set(!0);const V=i!=null&&o&&o.animated!=i;if(l||r||V){(r||i!=null)&&(t=null);const v=i??(t==null?void 0:t.animated)??(l&&!e?!1:s);o=J(e,v,n,p),t==null||t.resolve(o.promise),t=null}}else l&&(x(),o=null),(r||e&&(t==null?void 0:t.animated)!==i)&&(t=e&&i!=null?{animated:i,...N()}:null);return(t==null?void 0:t.promise)??(o==null?void 0:o.promise)});let H={};const g=async(e=!c(),n=O())=>{const s={};H=s;try{await G(()=>{try{return D.set(n),c.set(e),E()}finally{D.set(null)}})}finally{H!==s&&await R}},M=T(z,ne(e=>{e&&S(e)}),ee(E));return{...F({visible$:u,element$:w,elementPresent$:A,transitioning$:y,shown$:K,hidden$:L}),patch:S,directives:{directive:M},api:{show:g.bind(null,!0),hide:g.bind(null,!1),toggle:g}}};export{de as c};
