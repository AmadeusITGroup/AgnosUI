import{r as me,j as r}from"./App-Dy53TPcb.js";import{S as J}from"./slot-BckPQ7DD.js";import{a as P,u as T}from"./directive-Ds3K8r_f-Chp5sF2s.js";import{c as ge}from"./clsx-B-dksMZM.js";import{u as fe}from"./config-DPeVDdbW.js";import{b as c,y as he,w as be,d as G,m as ve,a as h,g as xe,r as u,e as $e,n as L,c as M}from"./dom-q8JF3QN8-DA_38J3x.js";import{c as De,o as we,a as Ce,b as Fe}from"./floatingUI-DifMgxp6.js";import{c as Ie}from"./focustrack-D8Mhve8x.js";import{c as je}from"./navManager-BRQFdAlK.js";import{w as ye,b as Se,d as ke,s as Ne,t as A}from"./stores-DDsfCC7o.js";import{c as Le}from"./widget-BhSpaX1o.js";import{e as Ae}from"./extendWidget-p6D3ic5a.js";const Pe={id:void 0,ariaLabel:"Select",open:!1,disabled:!1,items:[],filterText:"",loading:!1,selected:[],navSelector:s=>s.querySelectorAll(".au-select-badge,input"),itemIdFn:s=>""+s,onOpenChange:L,onFilterTextChange:L,onSelectedChange:L,allowedPlacements:["bottom-start","top-start","bottom-end","top-end"],className:"",menuClassName:"",menuItemClassName:"",badgeClassName:""},Me=Le("select",s=>{const[{id$:a,open$:n,filterText$:b,items$:g,itemIdFn$:v,onOpenChange$:C,onFilterTextChange$:F,onSelectedChange$:I,allowedPlacements$:j,navSelector$:y,className$:S,badgeClassName$:x,ariaLabel$:E,menuClassName$:B,...O},Q]=ye(Pe,s),{selected$:k}=O,$=c(()=>a()??he()),R=Se(b,F),{hasFocus$:V,directive:X}=Ie(),d=ke(C,[n,V],([e,t])=>e&&t),N=c(()=>{const e=new Map,t=v();for(const i of k()){const l=t(i);e.set(l,{item:i,id:t(i),selected:!0})}return e}),Y=c(()=>[...N().values()]),f=(function(){const e=be(0);return G(e,t=>{const{length:i}=D();t!=null&&(i?t<0?t=i-1:t>=i&&(t=0):t=void 0),e.set(t)})})(),H=c(()=>{const e=new Map;if(d()){const t=N(),i=v();for(const l of g()){const p=i(l);e.set(p,{item:l,id:p,selected:t.has(p)})}}return e}),D=c(()=>d()?[...H().values()]:[]),W=c(()=>{const e=D(),t=f();return e.length&&t!=null?e[t]:void 0}),{directives:{floatingDirective:Z,referenceDirective:K},stores:{placement$:_}}=De({props:{computePositionOptions:G(c(()=>({middleware:[we(5),Ce({allowedPlacements:j()}),Fe()]})))}}),{directive:ee,refreshElements:te,focusFirst:se,focusLast:ie,focusLeft:z,focusRight:U}=je(),ae=c(()=>({keys:{Home:se,End:ie,ArrowLeft:z,ArrowRight:U},selector:y()})),q=(e,t)=>{const i=e.target;te(),o.api.unselect(t),i instanceof HTMLElement&&setTimeout(()=>{z({event:e,referenceElement:i})||U({event:e,referenceElement:i})}),e.preventDefault()},re=h(()=>({attributes:{role:u("combobox"),"aria-haspopup":u("listbox"),"aria-expanded":c(()=>`${d()}`),"aria-controls":c(()=>`${$()}-menu`)}})),ne=h(e=>({attributes:{tabindex:u(-1),class:x},classNames:{"au-select-badge":A},events:{keydown:t=>{let i=!1;switch(t.key){case"Backspace":case"Delete":{q(t,e().item),i=!0;break}}i&&t.preventDefault()}}})),oe=h(()=>({attributes:{role:u("listbox"),id:c(()=>`${$()}-menu`),"data-popper-placement":_,class:B},events:{mousedown:e=>e.preventDefault()}})),ce=h(e=>({attributes:{role:u("option"),"aria-selected":c(()=>`${e().selected}`),style:u("cursor: pointer")},classNames:{"au-select-item":A,selected:c(()=>e().selected)},events:{click:()=>o.api.toggleItem(e().item)}})),le=h(()=>({attributes:{id:$,type:u("text"),"aria-label":E,"aria-autocomplete":u("list"),autocorrect:u("off"),autocapitalize:u("none"),autocomplete:u("off")},classNames:{"au-select-input":A},events:{input:e=>{const t=e.target.value;$e(()=>{d.set(t!=null&&t!==""),R.set(t)})},keydown:({ctrlKey:e,key:t,preventDefault:i})=>{let l=!0;switch(t){case"ArrowDown":{d()?e?o.api.highlightLast():o.api.highlightNext():(o.api.open(),o.api.highlightFirst());break}case"ArrowUp":e?o.api.highlightFirst():o.api.highlightPrevious();break;case"Enter":{const p=W();p&&o.api.toggleItem(p.item);break}case"Escape":d.set(!1);break;default:l=!1}l&&i()}}})),ue=h(e=>({events:{click:t=>{q(t,e().item)}}})),o={...Ne({id$:$,visibleItems$:D,highlighted$:W,open$:d,selectedContexts$:Y,filterText$:R,placement$:_,className$:S,badgeClassName$:x,ariaLabel$:E,menuClassName$:B,...O}),patch:Q,api:{clear(){k.set([])},select(e){o.api.toggleItem(e,!0)},unselect(e){o.api.toggleItem(e,!1)},toggleItem(e,t){const i=v(),l=i(e),w=N().has(l);t==null&&(t=!w),!(t&&!H().has(l)||!t&&!w)&&k.update(m=>{if(m=[...m],t&&!w)m.push(e);else if(!t&&w){const de=m.findIndex(pe=>i(pe)===l);m.splice(de,1)}return I()?.(m),m})},clearText(){},highlight(e){const t=D().findIndex(i=>i.item===e);f.set(t===-1?void 0:t)},highlightFirst(){f.set(0)},highlightPrevious(){f.update(e=>e!=null?e-1:-1)},highlightNext(){f.update(e=>e!=null?e+1:1/0)},highlightLast(){f.set(-1)},open:()=>o.api.toggle(!0),close:()=>o.api.toggle(!1),toggle(e){d.update(t=>e??!t)}},directives:{hasFocusDirective:X,floatingDirective:Z,referenceDirective:K,inputContainerDirective:ve(xe(ee,ae),re),badgeAttributesDirective:ne,menuAttributesDirective:oe,itemAttributesDirective:ce,inputDirective:le,badgeCloseButtonDirective:ue}};return o}),Te={badgeLabel:({itemContext:s})=>s.item,itemLabel:({itemContext:s})=>s.item},Ee=Ae(Me,Te),Be=Ee;function Oe(s){return r.jsx(r.Fragment,{children:""+s.itemContext.item})}function Re(s){return r.jsx(r.Fragment,{children:""+s.itemContext.item})}function He({itemContext:s,slotContext:a}){return r.jsx("div",{...T(a.directives.badgeAttributesDirective,s),children:r.jsx(J,{slotContent:a.state.badgeLabel,props:{...a,itemContext:s}})})}function We({slotContext:s}){const a=[];for(const n of s.state.selectedContexts)a.push(r.jsx(He,{itemContext:n,slotContext:s},n.id));return a.length?r.jsx(r.Fragment,{children:a}):null}function _e({itemContext:s,slotContext:a}){const n=ge("dropdown-item","position-relative",{"text-bg-primary":s===a.state.highlighted});return r.jsx("li",{className:n,...T(a.directives.itemAttributesDirective,s),children:r.jsx(J,{slotContent:a.state.itemLabel,props:{...a,itemContext:s}})})}function ze({slotContext:s}){const{directives:{hasFocusDirective:a,floatingDirective:n,menuAttributesDirective:b}}=s;return r.jsx("ul",{...P([M,"dropdown-menu show"],a,n,b),children:s.state.visibleItems.map(g=>r.jsx(_e,{slotContext:s,itemContext:g},g.id))})}function st({ref:s,...a}){const n=fe(Be,a,{badgeLabel:Oe,itemLabel:Re});me.useImperativeHandle(s,()=>n.api,[n.api]);const{state:{id:b,visibleItems:g,filterText:v,open:C,className:F},directives:{hasFocusDirective:I,referenceDirective:j,inputContainerDirective:y,inputDirective:S}}=n,x=`${b}-menu`;return r.jsxs("div",{...P([M,`au-select dropdown border border-1 p-1 mb-3 d-block ${F}`],j),children:[r.jsxs("div",{...P([M,"d-flex align-items-center flex-wrap gap-1"],I,y),children:[r.jsx(We,{slotContext:n}),r.jsx("input",{type:"text",value:v,...T(S),onChange:()=>{}})]}),C&&g.length>0&&r.jsx(ze,{slotContext:n,menuId:x})]})}export{st as S};
