import{o as b,f as Q,E as X,d as c,F as Y,w as j,G as Z,s as F,B as q,j as T,l as nn,H as en}from"./directive-3-8yr-ZK-C5h7Dwqe.js";import{t as C,b as f,c as tn}from"./writables-DoU_XYTX-8sqxFTfY.js";import{p as G}from"./promise-CY2U8bTP-2vXpUa_S.js";const N=new Promise(b),sn=async($,h)=>{$.style.display=h==="show"?"":"none"},on={animated:!0,animatedOnInit:!1,initDone:null,visible:!0,transition:sn,onShown:b,onHidden:b,onVisibleChange:b},ln={animated:C,animatedOnInit:C,visible:C,transition:f,onShown:f,onHidden:f,onVisibleChange:f,initDone:tn},dn=$=>{const[{animated$:h,initDone$:m,visible$:d,transition$:R,onShown$:U,onHidden$:W,onVisibleChange$:_,animatedOnInit$:k},S]=Q(on,$,ln),{element$:w,directive:z}=X(),A=c(()=>!!w()),u=Y(_,[d],([n])=>n),a=j(null),y=c(()=>!!a()),x=()=>{let n;return a.update(e=>(e==null||e.abort.abort(),n=e==null?void 0:e.context,null)),n},J=(n,e,o,i)=>q(()=>{const p=new AbortController,s=p.signal,l=x()??{},{promise:r,resolve:V}=G(),v={abort:p,animated:e,visible:n,context:l,element:o,transitionFn:i,promise:r};return a.set(v),V((async()=>{var I;try{await i(o,n?"show":"hide",e,s,l)}finally{s.aborted?await N:(a.set(null),(I=(n?U:W)())==null||I())}})()),v}),K=c(()=>!y()&&u()&&A()),L=c(()=>!y()&&!u()),H=c(()=>m()?h():k()),g=j(null);let O,P=d(),t=null;const B=Z([u,w,H,g,R,a],([n,e,o,i,p,s])=>{const l=O!==e;O=e;const r=P!==n;if(P=n,e){m()==null&&m.set(!0);const V=i!=null&&s&&s.animated!=i;if(l||r||V){(r||i!=null)&&(t=null);const v=i??(t==null?void 0:t.animated)??(l&&!n?!1:o);s=J(n,v,e,p),t==null||t.resolve(s.promise),t=null}}else l&&(x(),s=null),(r||n&&(t==null?void 0:t.animated)!==i)&&(t=n&&i!=null?{animated:i,...G()}:null);return(t==null?void 0:t.promise)??(s==null?void 0:s.promise)});let E={};const D=async(n=!d(),e=H())=>{const o={};E=o;try{await q(()=>{try{return g.set(e),d.set(n),B()}finally{g.set(null)}})}finally{E!==o&&await N}},M=T(z,en(S),nn(B));return{...F({visible$:u,element$:w,elementPresent$:A,transitioning$:y,shown$:K,hidden$:L}),patch:S,directives:{directive:M},actions:{},api:{show:D.bind(null,!0),hide:D.bind(null,!1),toggle:D}}};export{dn as c};
