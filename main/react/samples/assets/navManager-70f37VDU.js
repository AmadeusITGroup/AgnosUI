import{w as S,c as N}from"./func-DcknktoK.js";import{r as k}from"./directive-Xeo8_x0_.js";import{c as x}from"./dom-2S7XI5EU.js";const C=t=>{let s=t;for(;s;){const o=getComputedStyle(s);if(s.inert||s.hidden||o.display==="none"||o.visibility==="hidden")return!0;s=s.parentElement}return!1},h=t=>{var o;if(t.disabled)return!1;const s=(o=t.parentElement)==null?void 0:o.closest("fieldset");return s?h(s):!0},L=t=>t.isContentEditable||!!t.hasAttribute("tabindex"),D={INPUT:t=>t.type!=="hidden"&&h(t),SELECT:h,TEXTAREA:h,BUTTON:h,A:t=>!!t.href||L(t)},$=t=>document.contains(t)&&!C(t)&&(D[t.tagName]??L)(t),P=(t,s)=>{if(t===s)return 0;const o=t.compareDocumentPosition(s);if(o&Node.DOCUMENT_POSITION_FOLLOWING)return-1;if(o&Node.DOCUMENT_POSITION_PRECEDING)return 1;throw new Error("failed to compare elements")},E=t=>getComputedStyle(t).direction,K=new Set(["text","search","url","tel","password"]),R=t=>t instanceof HTMLInputElement&&K.has(t.type),M=t=>{let s=t.key;return t.shiftKey&&(s=`Shift+${s}`),t.altKey&&(s=`Alt+${s}`),t.ctrlKey&&(s=`Ctrl+${s}`),t.metaKey&&(s=`Meta+${s}`),s},U=t=>{const{target:s,key:o}=t;if(R(s)&&(o==="ArrowLeft"||o==="ArrowRight"||o==="Home"||o==="End")){let i;if(o==="ArrowLeft"||o==="ArrowRight"){const a=E(s);i=o===(a==="ltr"?"ArrowLeft":"ArrowRight")}else i=o==="Home";const l=s.selectionStart===s.selectionEnd?s.selectionStart:null;if(i&&l!==0||!i&&l!==s.value.length)return!0}return!1},_=t=>[t],z=()=>{const t=k(),s=S({}),o=(e=!0)=>{s.set({}),e&&(l(),a())},i=N(()=>{s();const e=[];for(const r of t())e.push(...r());return e}),l=N(()=>x(i()),{equal:Object.is}),a=N(()=>[...i()].sort(P)),f=()=>{const e=l();return e?E(e):"ltr"},m=(e,r)=>(e&&(r==null||r.preventDefault()),e),p=(e,r=0)=>{const c=a();for(;e>=0&&e<c.length;){const n=c[e];if($(n)){if(n.focus(),r!=0&&R(n)){const u=f()!==E(n),d=r>0!==u?0:n.value.length;n.setSelectionRange(d,d,d===0?"forward":"backward")}return n}if(r===0)break;e+=r}return null},T=e=>({event:r,referenceElement:c=(r==null?void 0:r.target)??document.activeElement}={})=>{const n=c?a().indexOf(c):-1;return n>-1?m(p(n+e,e),r):null},F=(e,r)=>{const c=u=>{var O;if(U(u))return;const d=M(u),A=(O=r.keys)==null?void 0:O[d];A&&(o(!1),A({event:u,directiveElement:e,navManager:b,context:r.context}))};e.addEventListener("keydown",c);const n=t.register(()=>((r==null?void 0:r.selector)??_)(e));return{update(u){r=u},destroy(){e.removeEventListener("keydown",c),n()}}},y=T(-1),g=T(1),w=({event:e}={})=>m(p(0,1),e),I=({event:e}={})=>m(p(a().length-1,-1),e),b={elementsInDomOrder$:a,directive:F,focusIndex:p,focusPrevious:y,focusNext:g,focusFirst:w,focusFirstLeft:(...e)=>(f()==="rtl"?I:w)(...e),focusFirstRight:(...e)=>(f()==="rtl"?w:I)(...e),focusLast:I,focusLeft:(...e)=>(f()==="rtl"?g:y)(...e),focusRight:(...e)=>(f()==="rtl"?y:g)(...e),refreshElements:o};return b};export{z as c};
