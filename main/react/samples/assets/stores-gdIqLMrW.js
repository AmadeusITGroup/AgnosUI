import{a as V,c as d,b as v,g as O,e as $,d as D,r as h,w as m,i as E}from"./func-B0ufEirG.js";import{r as l}from"./index-Z3YCqocd.js";const U=e=>({actions:e.actions,api:e.api,directives:e.directives,state$:e.state$,stores:e.stores}),S=Symbol();function W(e){return function(t){v(()=>{var r;for(const[n,s]of Object.entries(t??{}))(r=e[`${n}$`])==null||r.set(s)})}}function z(e,t){if(e===t)return null;let r=!1;const n={},s=new Set([...Object.keys(e),...Object.keys(t)]);for(const a of s){const c=t[a];e[a]!==c&&(n[a]=c,r=!0)}return r?n:null}function N(e,t=h(void 0),r={},n=m(void 0)){const{normalizeValue:s=E,equal:a=Object.is}=r,c=()=>e,o=(u,i=c)=>{const b=u===void 0?void 0:s(u);return b===S?(console.error("Not using invalid value",u),i()):b===void 0?i():b},f=d(()=>o(t()),{equal:a}),k=d(()=>o(n(),f),{equal:a});return D(k,u=>{if(u!==void 0){const i=s(u);if(i===S){console.error("Not setting invalid value",u);return}u=i}n.set(u)})}const y=e=>!!(e&&typeof e=="function"&&"subscribe"in e),w=e=>y(e)?e:h(e),A=e=>y(e)?e:m(e),I=(e,t)=>{const r={};if(t){const n=y(t);for(const s of e)r[s]=n?d(()=>t()[s]):w(t[s])}return r},q=(e,t,r)=>{const n={};for(const s of e){const a=t==null?void 0:t[s],c=r==null?void 0:r[s];n[s]=a&&c?d(()=>a()??c()):a||c}return n},P=(e,t,r)=>{const n={},s=Object.keys(e),a=I(s,t==null?void 0:t.config),c=t==null?void 0:t.props;for(const o of s){const f=c==null?void 0:c[o];n[`${o}$`]=N(e[o],a[o],r==null?void 0:r[o],A(f))}return n},F=(e,t,r)=>{const n=P(e,t,r);return[n,W(n)]},M=e=>{const t=[],r=[],n={};for(const s of Object.keys(e))if(s.endsWith("$")){const a=e[s];t.push(s.substring(0,s.length-1)),r.push(a),n[s]=V(a)}return{stores:n,state$:d(()=>{const s=r.map(O),a={};return t.forEach((c,o)=>{a[c]=s[o]}),a})}},_=(e,t,r=s=>s[0],n=(s,a)=>a===s)=>{let s=t[0]();return $(t,{derive(a){const c=r(a),o=!n(a[0],c);return o&&t[0].set(c),(o||!n(s,c))&&(s=c,e()(c)),c},equal:n})};function B(e){const[t,r]=l.useState(()=>e());return l.useEffect(()=>e.subscribe(n=>{r(()=>n)}),[e]),t}const R=(e,t)=>!z(e,t),G=e=>{const t=l.useRef();return t.current||(t.current=m({...e},{equal:R})),l.useEffect(()=>{t.current.set({...e})},[e]),l.useMemo(()=>V(t.current),[t.current])};export{S as I,P as a,G as b,_ as c,z as f,q as m,I as n,M as s,U as t,B as u,F as w};
