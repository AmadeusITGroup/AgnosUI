import{j as o}from"./index-scbH94GR.js";import{c as f,w as Z,d as O,b as ee,n as L}from"./func-DcknktoK.js";import{c as te,o as se,a as ne,b as oe}from"./floatingUI-Emw2PQsu.js";import{c as ie}from"./focustrack-IKO7Xl-S.js";import{c as ae}from"./navManager-yuviOQ3e.js";import{a as re,u as le,g as W}from"./directive-KFRspyuV.js";import{g as ce}from"./dom-HY1qC9Vk.js";import{w as de,c as ue,b as pe,s as fe,t as me}from"./stores-RzfDPeS7.js";import{u as ge}from"./config-WR1wYZSw.js";import{S as H}from"./slot-15FAYYFd.js";const he=s=>""+s,be={id:void 0,ariaLabel:"Select",open:!1,disabled:!1,items:[],filterText:"",loading:!1,selected:[],navSelector:s=>s.querySelectorAll(".au-select-badge,input"),itemIdFn:he,onOpenChange:L,onFilterTextChange:L,onSelectedChange:L,allowedPlacements:["bottom-start","top-start","bottom-end","top-end"],className:"",menuClassName:"",menuItemClassName:"",badgeClassName:"",slotBadgeLabel:({itemContext:s})=>s.item,slotItem:({itemContext:s})=>s.item};function ve(s){const[{id$:a,open$:i,filterText$:u,items$:l,itemIdFn$:m,onOpenChange$:g,onFilterTextChange$:j,onSelectedChange$:w,allowedPlacements$:S,navSelector$:N,...C},I]=de(be,s),{selected$:v}=C,$=f(()=>a()??ce()),D=ue(u,j),{hasFocus$:k,directive:M}=ie(),d=pe(g,[i,k],([e,t])=>e&&t),x=f(()=>{const e=new Map,t=m();for(const n of v()){const c=t(n);e.set(c,{item:n,id:t(n),selected:!0})}return e}),B=f(()=>[...x().values()]),b=function(){const e=Z(0);return O(e,t=>{const{length:n}=F();t!=null&&(n?t<0?t=n-1:t>=n&&(t=0):t=void 0),e.set(t)})}(),P=f(()=>{const e=new Map;if(d()){const t=x(),n=m();for(const c of l()){const p=n(c);e.set(p,{item:c,id:p,selected:t.has(p)})}}return e}),F=f(()=>d()?[...P().values()]:[]),T=f(()=>{const e=F(),t=b();return e.length&&t!=null?e[t]:void 0}),{directives:{floatingDirective:_,referenceDirective:z},stores:{placement$:U}}=te({props:{computePositionOptions:O(f(()=>({middleware:[se(5),ne({allowedPlacements:S()}),oe()]})))}}),{directive:q,refreshElements:G,focusFirst:J,focusLast:Q,focusLeft:E,focusRight:K}=ae(),V=f(()=>({keys:{Home:J,End:Q,ArrowLeft:E,ArrowRight:K},selector:N()})),R=(e,t)=>{const n=e.target;G(),r.api.unselect(t),n instanceof HTMLElement&&setTimeout(()=>{E({event:e,referenceElement:n})||K({event:e,referenceElement:n})}),e.preventDefault()},r={...fe({id$:$,visibleItems$:F,highlighted$:T,open$:d,selectedContexts$:B,filterText$:D,placement$:U,...C}),patch:I,api:{clear(){v.set([])},select(e){r.api.toggleItem(e,!0)},unselect(e){r.api.toggleItem(e,!1)},toggleItem(e,t){const n=m(),c=n(e),y=x().has(c);t==null&&(t=!y),!(t&&!P().has(c)||!t&&!y)&&v.update(h=>{var A;if(h=[...h],t&&!y)h.push(e);else if(!t&&y){const X=h.findIndex(Y=>n(Y)===c);h.splice(X,1)}return(A=w())==null||A(h),h})},clearText(){},highlight(e){const t=F().findIndex(n=>n.item===e);b.set(t===-1?void 0:t)},highlightFirst(){b.set(0)},highlightPrevious(){b.update(e=>e!=null?e-1:-1)},highlightNext(){b.update(e=>e!=null?e+1:1/0)},highlightLast(){b.set(-1)},open:()=>r.api.toggle(!0),close:()=>r.api.toggle(!1),toggle(e){d.update(t=>e??!t)}},directives:{hasFocusDirective:M,floatingDirective:_,referenceDirective:z,inputContainerDirective:re(q,V)},actions:{onInput({target:e}){const t=e.value;ee(()=>{d.set(t!=null&&t!==""),D.set(t)})},onRemoveBadgeClick(e,t){R(e,t)},onInputKeydown(e){const{ctrlKey:t,key:n}=e;let c=!0;switch(n){case"ArrowDown":{d()?t?r.api.highlightLast():r.api.highlightNext():(r.api.open(),r.api.highlightFirst());break}case"ArrowUp":t?r.api.highlightFirst():r.api.highlightPrevious();break;case"Enter":{const p=T();p&&r.api.toggleItem(p.item);break}case"Escape":d.set(!1);break;default:c=!1}c&&e.preventDefault()},onBadgeKeydown(e,t){let n=!1;switch(e.key){case"Backspace":case"Delete":{R(e,t),n=!0;break}}n&&e.preventDefault()}}};return r}const xe=ve;function we(s){s.preventDefault()}function Ce(s){return o.jsx(o.Fragment,{children:""+s.itemContext.item})}function Ie(s){return o.jsx(o.Fragment,{children:""+s.itemContext.item})}function $e({itemContext:s,slotContext:a}){const i=a.state;return o.jsx("div",{tabIndex:-1,className:`au-select-badge me-1 ${i.badgeClassName}`,onKeyDown:u=>a.widget.actions.onBadgeKeydown(u.nativeEvent,s.item),children:o.jsx(H,{slotContent:i.slotBadgeLabel,props:{...a,itemContext:s}})},s.id)}function De({slotContext:s}){const a=[];for(const i of s.state.selectedContexts)a.push(o.jsx($e,{itemContext:i,slotContext:s},i.id));return a.length?o.jsx(o.Fragment,{children:a}):null}function Fe({slotContext:s}){const{widget:a,state:i}=s,u=i.highlighted;return o.jsx(o.Fragment,{children:i.visibleItems.map(l=>{const{id:m}=l,g=["au-select-item dropdown-item position-relative"];return l===u&&g.push("text-bg-primary"),l.selected&&g.push("selected"),o.jsx("li",{role:"option","aria-selected":l.selected,className:g.join(" "),onClick:()=>a.api.toggleItem(l.item),style:{cursor:"pointer"},children:o.jsx(H,{slotContent:i.slotItem,props:{...s,itemContext:l}})},m)})})}const ye={slotBadgeLabel:Ce,slotItem:Ie};function Ke(s){const[a,i]=ge(xe,s,"select",ye),u={state:a,widget:me(i)},{id:l,ariaLabel:m,visibleItems:g,filterText:j,open:w,className:S,menuClassName:N,placement:C}=a,I=`${l}-menu`,{directives:{floatingDirective:v,hasFocusDirective:$,referenceDirective:D,inputContainerDirective:k}}=i,M=le(D),d=W([$,k]),x=W([$,v]);return o.jsxs("div",{ref:M,className:`au-select dropdown border border-1 p-1 mb-3 d-block ${S}`,children:[o.jsxs("div",{ref:d,role:"combobox",className:"d-flex align-items-center flex-wrap","aria-controls":I,"aria-haspopup":"listbox","aria-expanded":w,children:[o.jsx(De,{slotContext:u}),o.jsx("input",{id:l,"aria-label":m,className:"au-select-input flex-grow-1 border-0",type:"text",value:j,"aria-autocomplete":"list",autoCorrect:"off",autoCapitalize:"none",autoComplete:"off",onInput:i.actions.onInput,onKeyDown:B=>i.actions.onInputKeydown(B.nativeEvent)})]}),w&&g.length>0&&o.jsx("ul",{ref:x,role:"listbox",id:I,className:`dropdown-menu show ${N}`,"data-popper-placement":C,onMouseDown:we,children:o.jsx(Fe,{slotContext:u})})]})}export{Ke as S};
