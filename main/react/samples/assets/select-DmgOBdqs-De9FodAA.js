import{j as n}from"./App-DroHCvem.js";import{u as de,S as U}from"./config-Co15skZS.js";import{a as P,u as q}from"./directive-Kqp31pwt-DhkfBRbP.js";import{c as ue}from"./index-CAv_E4zL.js";import{f as pe,d as c,p as me,K as ge,F as fe,w as he,e as z,s as ve,j as be,N as xe,B as we,o as A,k as $,t as $e,c as M}from"./directive-3-8yr-ZK-C5h7Dwqe.js";import{c as De,o as Ce,a as Ie,b as Fe}from"./floatingUI-ey9K2Nxt.js";import{c as ye}from"./focustrack-BCVH7QM3.js";import{c as je}from"./navManager-DmYmZNH8.js";import{e as Ne}from"./extendWidget-CY6dlHOY.js";const Se={id:void 0,ariaLabel:"Select",open:!1,disabled:!1,items:[],filterText:"",loading:!1,selected:[],navSelector:s=>s.querySelectorAll(".au-select-badge,input"),itemIdFn:s=>""+s,onOpenChange:A,onFilterTextChange:A,onSelectedChange:A,allowedPlacements:["bottom-start","top-start","bottom-end","top-end"],className:"",menuClassName:"",menuItemClassName:"",badgeClassName:""};function ke(s){const[{id$:a,open$:r,filterText$:g,items$:p,itemIdFn$:h,onOpenChange$:D,onFilterTextChange$:C,onSelectedChange$:I,allowedPlacements$:F,navSelector$:y,className$:j,badgeClassName$:v,ariaLabel$:N,menuClassName$:b,...T},G]=pe(Se,s),{selected$:S}=T,k=c(()=>a()??me()),B=ge(g,C),{hasFocus$:J,directive:Q}=ye(),d=fe(D,[r,J],([e,t])=>e&&t),L=c(()=>{const e=new Map,t=h();for(const i of S()){const l=t(i);e.set(l,{item:i,id:t(i),selected:!0})}return e}),V=c(()=>[...L().values()]),f=function(){const e=he(0);return z(e,t=>{const{length:i}=x();t!=null&&(i?t<0?t=i-1:t>=i&&(t=0):t=void 0),e.set(t)})}(),E=c(()=>{const e=new Map;if(d()){const t=L(),i=h();for(const l of p()){const u=i(l);e.set(u,{item:l,id:u,selected:t.has(u)})}}return e}),x=c(()=>d()?[...E().values()]:[]),K=c(()=>{const e=x(),t=f();return e.length&&t!=null?e[t]:void 0}),{directives:{floatingDirective:X,referenceDirective:Y},stores:{placement$:R}}=De({props:{computePositionOptions:z(c(()=>({middleware:[Ce(5),Ie({allowedPlacements:F()}),Fe()]})))}}),{directive:Z,refreshElements:ee,focusFirst:te,focusLast:se,focusLeft:O,focusRight:W}=je(),ie=c(()=>({keys:{Home:te,End:se,ArrowLeft:O,ArrowRight:W},selector:y()})),_=(e,t)=>{const i=e.target;ee(),o.api.unselect(t),i instanceof HTMLElement&&setTimeout(()=>{O({event:e,referenceElement:i})||W({event:e,referenceElement:i})}),e.preventDefault()},ae=$(()=>({attributes:{role:"combobox","aria-haspopup":"listbox","aria-expanded":c(()=>`${d()}`),"aria-controls":c(()=>`${k()}-menu`)}})),ne=$(e=>({attributes:{tabindex:-1,class:v},classNames:{"au-select-badge":!0},events:{keydown:t=>o.actions.onBadgeKeydown(t,e().item)}})),oe=$(()=>({attributes:{role:"listbox",id:c(()=>`${k()}-menu`),"data-popper-placement":R,class:b},events:{mousedown:e=>e.preventDefault()}})),re=$(e=>({attributes:{role:"option","aria-selected":c(()=>`${e().selected}`),style:"cursor: pointer"},classNames:{"au-select-item":!0,selected:c(()=>e().selected)},events:{click:()=>o.api.toggleItem(e().item)}})),o={...ve({id$:k,visibleItems$:x,highlighted$:K,open$:d,selectedContexts$:V,filterText$:B,placement$:R,className$:j,badgeClassName$:v,ariaLabel$:N,menuClassName$:b,...T}),patch:G,api:{clear(){S.set([])},select(e){o.api.toggleItem(e,!0)},unselect(e){o.api.toggleItem(e,!1)},toggleItem(e,t){const i=h(),l=i(e),w=L().has(l);t==null&&(t=!w),!(t&&!E().has(l)||!t&&!w)&&S.update(m=>{var H;if(m=[...m],t&&!w)m.push(e);else if(!t&&w){const ce=m.findIndex(le=>i(le)===l);m.splice(ce,1)}return(H=I())==null||H(m),m})},clearText(){},highlight(e){const t=x().findIndex(i=>i.item===e);f.set(t===-1?void 0:t)},highlightFirst(){f.set(0)},highlightPrevious(){f.update(e=>e!=null?e-1:-1)},highlightNext(){f.update(e=>e!=null?e+1:1/0)},highlightLast(){f.set(-1)},open:()=>o.api.toggle(!0),close:()=>o.api.toggle(!1),toggle(e){d.update(t=>e??!t)}},directives:{hasFocusDirective:Q,floatingDirective:X,referenceDirective:Y,inputContainerDirective:be(xe(Z,ie),ae),badgeAttributesDirective:ne,menuAttributesDirective:oe,itemAttributesDirective:re},actions:{onInput({target:e}){const t=e.value;we(()=>{d.set(t!=null&&t!==""),B.set(t)})},onRemoveBadgeClick(e,t){_(e,t)},onInputKeydown(e){const{ctrlKey:t,key:i}=e;let l=!0;switch(i){case"ArrowDown":{d()?t?o.api.highlightLast():o.api.highlightNext():(o.api.open(),o.api.highlightFirst());break}case"ArrowUp":t?o.api.highlightFirst():o.api.highlightPrevious();break;case"Enter":{const u=K();u&&o.api.toggleItem(u.item);break}case"Escape":d.set(!1);break;default:l=!1}l&&e.preventDefault()},onBadgeKeydown(e,t){let i=!1;switch(e.key){case"Backspace":case"Delete":{_(e,t),i=!0;break}}i&&e.preventDefault()}}};return o}const Le={badgeLabel:({itemContext:s})=>s.item,itemLabel:({itemContext:s})=>s.item},Ae=Ne(ke,Le,{}),Pe=Ae;function Me(s){return n.jsx(n.Fragment,{children:""+s.itemContext.item})}function Te(s){return n.jsx(n.Fragment,{children:""+s.itemContext.item})}function Be({itemContext:s,slotContext:a}){return n.jsx("div",{...q(a.widget.directives.badgeAttributesDirective,s),children:n.jsx(U,{slotContent:a.state.badgeLabel,props:{...a,itemContext:s}})})}function Ee({slotContext:s}){const a=[];for(const r of s.state.selectedContexts)a.push(n.jsx(Be,{itemContext:r,slotContext:s},r.id));return a.length?n.jsx(n.Fragment,{children:a}):null}function Ke({itemContext:s,slotContext:a}){const r=ue("dropdown-item","position-relative",{"text-bg-primary":s===a.state.highlighted});return n.jsx("li",{className:r,...q(a.widget.directives.itemAttributesDirective,s),children:n.jsx(U,{slotContent:a.state.itemLabel,props:{...a,itemContext:s}})})}function Re({slotContext:s}){const{directives:{hasFocusDirective:a,floatingDirective:r,menuAttributesDirective:g}}=s.widget;return n.jsx("ul",{...P([M,"dropdown-menu show"],a,r,g),children:s.state.visibleItems.map(p=>n.jsx(Ke,{slotContext:s,itemContext:p},p.id))})}const Oe={badgeLabel:Me,itemLabel:Te};function Ve(s){const[a,r]=de(Pe,s,"select",Oe),g={state:a,widget:$e(r)},{id:p,ariaLabel:h,visibleItems:D,filterText:C,open:I,className:F}=a,y=`${p}-menu`,{directives:{hasFocusDirective:j,referenceDirective:v,inputContainerDirective:N}}=r;return n.jsxs("div",{...P([M,`au-select dropdown border border-1 p-1 mb-3 d-block ${F}`],v),children:[n.jsxs("div",{...P([M,"d-flex align-items-center flex-wrap gap-1"],j,N),children:[n.jsx(Ee,{slotContext:g}),n.jsx("input",{id:p,"aria-label":h,className:"au-select-input flex-grow-1 border-0",type:"text",value:C,"aria-autocomplete":"list",autoCorrect:"off",autoCapitalize:"none",autoComplete:"off",onInput:r.actions.onInput,onKeyDown:b=>r.actions.onInputKeydown(b.nativeEvent)})]}),I&&D.length>0&&n.jsx(Re,{slotContext:g,menuId:y})]})}export{Ve as S};
