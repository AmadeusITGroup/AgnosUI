import{j as o}from"./index-OUqRjMdI.js";import{c as m,w as Y,d as R,n as M}from"./func-B0ufEirG.js";import{c as Z,o as ee,a as te,b as ne}from"./floatingUI-zKOwYtev.js";import{c as se}from"./focustrack-qykdsjdl.js";import{c as oe}from"./navManager-jQL9ntKp.js";import{a as ie,u as ae,g as A}from"./directive-94uXunAa.js";import{w as re,b as O,s as le,t as ce}from"./stores-ae3sjr2N.js";import{u as de}from"./config-7S2TRWPR.js";import{S as W}from"./slot-DUWkMZ23.js";const ue=n=>""+n,fe={id:void 0,ariaLabel:"Select",open:!1,disabled:!1,items:[],filterText:"",loading:!1,selected:[],navSelector:n=>n.querySelectorAll(".au-select-badge,input"),itemIdFn:ue,onOpenChange:M,onFilterTextChange:M,onSelectedChange:M,allowedPlacements:["bottom-start","top-start","bottom-end","top-end"],className:"",menuClassName:"",menuItemClassName:"",badgeClassName:"",slotBadgeLabel:({itemContext:n})=>n.item,slotItem:({itemContext:n})=>n.item};function pe(n){const[{open$:i,filterText$:a,items$:d,itemIdFn$:l,onOpenChange$:x,onFilterTextChange$:p,onSelectedChange$:j,allowedPlacements$:w,navSelector$:y,...C},I]=re(fe,n),{selected$:v}=C,$=O(p,[a]),{hasFocus$:S,directive:N}=se(),h=O(x,[i,S],([e,t])=>e&&t),b=m(()=>{const e=new Map,t=l();for(const s of v()){const c=t(s);e.set(c,{item:s,id:t(s),selected:!0})}return e}),k=m(()=>[...b().values()]),u=function(){const e=Y(0);return R(e,t=>{const{length:s}=D();t!=null&&(s?t<0?t=s-1:t>=s&&(t=0):t=void 0),e.set(t)})}(),B=m(()=>{const e=new Map;if(h()){const t=b(),s=l();for(const c of d()){const f=s(c);e.set(f,{item:c,id:f,selected:t.has(f)})}}return e}),D=m(()=>h()?[...B().values()]:[]),L=m(()=>{const e=D(),t=u();return e.length&&t!=null?e[t]:void 0}),{directives:{floatingDirective:H,referenceDirective:z},stores:{placement$:U}}=Z({props:{computePositionOptions:R(m(()=>({middleware:[ee(5),te({allowedPlacements:w()}),ne()]})))}}),{directive:_,refreshElements:q,focusFirst:G,focusLast:J,focusLeft:T,focusRight:E}=oe(),Q=m(()=>({keys:{Home:G,End:J,ArrowLeft:T,ArrowRight:E},selector:y()})),P=(e,t)=>{const s=e.target;q(),r.api.unselect(t),s instanceof HTMLElement&&setTimeout(()=>{T({event:e,referenceElement:s})||E({event:e,referenceElement:s})}),e.preventDefault()},r={...le({visibleItems$:D,highlighted$:L,open$:h,selectedContexts$:k,filterText$:$,placement$:U,...C}),patch:I,api:{clear(){v.set([])},select(e){r.api.toggleItem(e,!0)},unselect(e){r.api.toggleItem(e,!1)},toggleItem(e,t){const s=l(),c=s(e),F=b().has(c);t==null&&(t=!F),!(t&&!B().has(c)||!t&&!F)&&v.update(g=>{var K;if(g=[...g],t&&!F)g.push(e);else if(!t&&F){const V=g.findIndex(X=>s(X)===c);g.splice(V,1)}return(K=j())==null||K(g),g})},clearText(){},highlight(e){const t=D().findIndex(s=>s.item===e);u.set(t===-1?void 0:t)},highlightFirst(){u.set(0)},highlightPrevious(){u.update(e=>e!=null?e-1:-1)},highlightNext(){u.update(e=>e!=null?e+1:1/0)},highlightLast(){u.set(-1)},open:()=>r.api.toggle(!0),close:()=>r.api.toggle(!1),toggle(e){i.update(t=>e??!t)}},directives:{hasFocusDirective:N,floatingDirective:H,referenceDirective:z,inputContainerDirective:ie(_,Q)},actions:{onInput({target:e}){const t=e.value;I({open:t!=null&&t!=="",filterText:t})},onRemoveBadgeClick(e,t){P(e,t)},onInputKeydown(e){const{ctrlKey:t,key:s}=e;let c=!0;switch(s){case"ArrowDown":{h()?t?r.api.highlightLast():r.api.highlightNext():(r.api.open(),r.api.highlightFirst());break}case"ArrowUp":t?r.api.highlightFirst():r.api.highlightPrevious();break;case"Enter":{const f=L();f&&r.api.toggleItem(f.item);break}case"Escape":i.set(!1);break;default:c=!1}c&&e.preventDefault()},onBadgeKeydown(e,t){let s=!1;switch(e.key){case"Backspace":case"Delete":{P(e,t),s=!0;break}}s&&e.preventDefault()}}};return r}const ge=pe;function me(n){n.preventDefault()}function he(n){return o.jsx(o.Fragment,{children:""+n.itemContext.item})}function xe(n){return o.jsx(o.Fragment,{children:""+n.itemContext.item})}function ve({itemContext:n,slotContext:i}){const a=i.state;return o.jsx("div",{tabIndex:-1,className:`au-select-badge me-1 ${a.badgeClassName}`,onKeyDown:d=>i.widget.actions.onBadgeKeydown(d.nativeEvent,n.item),children:o.jsx(W,{slotContent:a.slotBadgeLabel,props:{...i,itemContext:n}})},n.id)}function be({slotContext:n}){const i=[];for(const a of n.state.selectedContexts)i.push(o.jsx(ve,{itemContext:a,slotContext:n},a.id));return i.length?o.jsx(o.Fragment,{children:i}):null}function we({slotContext:n}){const{widget:i,state:a}=n,d=a.highlighted;return o.jsx(o.Fragment,{children:a.visibleItems.map(l=>{const{id:x}=l,p=["au-select-item dropdown-item position-relative"];return l===d&&p.push("bg-primary text-light"),l.selected&&p.push("selected"),o.jsx("li",{className:p.join(" "),onClick:()=>i.api.toggleItem(l.item),children:o.jsx(W,{slotContent:a.slotItem,props:{...n,itemContext:l}})},x)})})}const Ce={slotBadgeLabel:he,slotItem:xe};function Me(n){const[i,a]=de(ge,n,"select",Ce),d={state:i,widget:ce(a)},{id:l,ariaLabel:x,visibleItems:p,filterText:j,open:w,className:y,menuClassName:C,placement:I}=i,{directives:{floatingDirective:v,hasFocusDirective:$,referenceDirective:S,inputContainerDirective:N}}=a,h=ae(S),b=A([$,N]),k=A([$,v]);return o.jsxs("div",{ref:h,className:`au-select dropdown border border-1 p-1 mb-3 d-block ${y}`,children:[o.jsxs("div",{ref:b,role:"combobox",className:"d-flex align-items-center flex-wrap","aria-haspopup":"listbox","aria-expanded":w,children:[o.jsx(be,{slotContext:d}),o.jsx("input",{id:l,"aria-label":x,className:"au-select-input flex-grow-1 border-0",type:"text",value:j,"aria-autocomplete":"list",autoCorrect:"off",autoCapitalize:"none",autoComplete:"off",onInput:a.actions.onInput,onKeyDown:u=>a.actions.onInputKeydown(u.nativeEvent)})]}),w&&p.length>0&&o.jsx("ul",{ref:k,className:`dropdown-menu show ${C}`,"data-popper-placement":I,onMouseDown:me,children:o.jsx(we,{slotContext:d})})]})}export{Me as S};
