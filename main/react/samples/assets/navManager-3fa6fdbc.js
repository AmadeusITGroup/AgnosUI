import{r as S,f as k,a as I}from"./utils-54fce9d2.js";import{c as R}from"./dom-cc7faf10.js";const C=t=>{let e=t;for(;e;){const o=getComputedStyle(e);if(e.inert||e.hidden||o.display==="none"||o.visibility==="hidden")return!0;e=e.parentElement}return!1},f=t=>{var o;if(t.disabled)return!1;const e=(o=t.parentElement)==null?void 0:o.closest("fieldset");return e?f(e):!0},A=t=>t.isContentEditable||!!t.hasAttribute("tabindex"),D={INPUT:t=>t.type!=="hidden"&&f(t),SELECT:f,TEXTAREA:f,BUTTON:f,A:t=>!!t.href||A(t)},$=t=>!C(t)&&(D[t.tagName]??A)(t),F=(t,e)=>{if(t===e)return 0;const o=t.compareDocumentPosition(e);if(o&Node.DOCUMENT_POSITION_FOLLOWING)return-1;if(o&Node.DOCUMENT_POSITION_PRECEDING)return 1;throw new Error("failed to compare elements")},w=t=>getComputedStyle(t).direction,P=new Set(["text","search","url","tel","password"]),O=t=>t instanceof HTMLInputElement&&P.has(t.type),x=t=>{let e=t.key;return t.shiftKey&&(e=`Shift+${e}`),t.altKey&&(e=`Alt+${e}`),t.ctrlKey&&(e=`Ctrl+${e}`),t.metaKey&&(e=`Meta+${e}`),e},K=t=>{const{target:e,key:o}=t;if(O(e)&&(o==="ArrowLeft"||o==="ArrowRight"||o==="Home"||o==="End")){let a;if(o==="ArrowLeft"||o==="ArrowRight"){const u=w(e);a=o===(u==="ltr"?"ArrowLeft":"ArrowRight")}else a=o==="Home";const d=e.selectionStart===e.selectionEnd?e.selectionStart:null;if(a&&d!==0||!a&&d!==e.value.length)return!0}return!1},M=t=>[t],q=()=>{const t=S(),e=k({}),o=()=>e.set({}),a=I(()=>{e();const s=[];for(const r of t())s.push(...r());return s}),d=I(()=>R(a()),{equal:Object.is}),u=I(()=>[...a()].sort(F)),p=()=>{const s=d();return s?w(s):"ltr"},y=(s,r)=>(s&&(r==null||r.preventDefault()),s),h=(s,r=0)=>{const c=u();for(;s>=0&&s<c.length;){const n=c[s];if($(n)){if(n.focus(),r!=0&&O(n)){const i=p()!==w(n),l=r>0!==i?0:n.value.length;n.setSelectionRange(l,l,l===0?"forward":"backward")}return n}if(r===0)break;s+=r}return null},N=s=>({event:r,referenceElement:c=(r==null?void 0:r.target)??document.activeElement}={})=>{const n=c?u().indexOf(c):-1;return n>-1?y(h(n+s,s),r):null},L=(s,r)=>{const c=i=>{var b;if(K(i))return;const l=x(i),T=(b=r.keys)==null?void 0:b[l];T&&(o(),T({event:i,directiveElement:s,navManager:E}))};s.addEventListener("keydown",c);const n=t.register(()=>((r==null?void 0:r.selector)??M)(s));return{update(i){r=i},destroy(){s.removeEventListener("keydown",c),n()}}},m=N(-1),g=N(1),E={elementsInDomOrder$:u,directive:L,focusIndex:h,focusPrevious:m,focusNext:g,focusFirst:({event:s}={})=>y(h(0,1),s),focusLast:({event:s}={})=>y(h(u().length-1,-1),s),focusLeft:(...s)=>(p()==="rtl"?g:m)(...s),focusRight:(...s)=>(p()==="rtl"?m:g)(...s),refreshElements:o};return E};export{q as c};
