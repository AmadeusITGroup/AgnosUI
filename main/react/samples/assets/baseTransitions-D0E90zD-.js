import{o as b,f as Q,E as X,d,F as Y,w as j,G as Z,s as F,B as q,j as T,l as ee,H as ne}from"./directive-CKEccryv--USZPHTu.js";import{t as C,b as f,c as te}from"./writables-DoU_XYTX-CgVcPKwT.js";import{p as G}from"./promise-CY2U8bTP-ZGoDVMe4.js";const N=new Promise(b),ie=($,h)=>{$.style.display=h==="show"?"":"none"},oe={animated:!0,animatedOnInit:!1,initDone:null,visible:!0,transition:ie,onShown:b,onHidden:b,onVisibleChange:b},se={animated:C,animatedOnInit:C,visible:C,transition:f,onShown:f,onHidden:f,onVisibleChange:f,initDone:te},de=$=>{const[{animated$:h,initDone$:m,visible$:c,transition$:R,onShown$:U,onHidden$:W,onVisibleChange$:_,animatedOnInit$:k},S]=Q(oe,$,se),{element$:w,directive:z}=X(),A=d(()=>!!w()),u=Y(_,[c],([e])=>e),a=j(null),y=d(()=>!!a()),x=()=>{let e;return a.update(n=>(n==null||n.abort.abort(),e=n==null?void 0:n.context,null)),e},J=(e,n,s,i)=>q(()=>{const p=new AbortController,o=p.signal,l=x()??{},{promise:r,resolve:V}=G(),v={abort:p,animated:n,visible:e,context:l,element:s,transitionFn:i,promise:r};return a.set(v),V((async()=>{var I;try{await i(s,e?"show":"hide",n,o,l)}finally{o.aborted?await N:(a.set(null),(I=(e?U:W)())==null||I())}})()),v}),K=d(()=>!y()&&u()&&A()),L=d(()=>!y()&&!u()),H=d(()=>m()?h():k()),g=j(null);let O,P=c(),t=null;const B=Z([u,w,H,g,R,a],([e,n,s,i,p,o])=>{const l=O!==n;O=n;const r=P!==e;if(P=e,n){m()==null&&m.set(!0);const V=i!=null&&o&&o.animated!=i;if(l||r||V){(r||i!=null)&&(t=null);const v=i??(t==null?void 0:t.animated)??(l&&!e?!1:s);o=J(e,v,n,p),t==null||t.resolve(o.promise),t=null}}else l&&(x(),o=null),(r||e&&(t==null?void 0:t.animated)!==i)&&(t=e&&i!=null?{animated:i,...G()}:null);return(t==null?void 0:t.promise)??(o==null?void 0:o.promise)});let E={};const D=async(e=!c(),n=H())=>{const s={};E=s;try{await q(()=>{try{return g.set(n),c.set(e),B()}finally{g.set(null)}})}finally{E!==s&&await N}},M=T(z,ne(e=>{e&&S(e)}),ee(B));return{...F({visible$:u,element$:w,elementPresent$:A,transitioning$:y,shown$:K,hidden$:L}),patch:S,directives:{directive:M},actions:{},api:{show:D.bind(null,!0),hide:D.bind(null,!1),toggle:D}}};export{de as c};
