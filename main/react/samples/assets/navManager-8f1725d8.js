import{h as D,w as S,c as m}from"./utils-4a34c49d.js";const k=t=>{const e=t.length;if(e===0)return null;let r=t[0];for(let c=1;c<e&&r;c++){const a=t[c];for(;r&&r!==a;){const i=r.compareDocumentPosition(a);if(i&Node.DOCUMENT_POSITION_CONTAINED_BY)break;if(i&Node.DOCUMENT_POSITION_CONTAINS){r=a;break}else if(i&Node.DOCUMENT_POSITION_DISCONNECTED)return null;r=r.parentElement}}return r},L=t=>{let e=t;for(;e;){const r=getComputedStyle(e);if(e.inert||e.hidden||r.display==="none"||r.visibility==="hidden")return!0;e=e.parentElement}return!1},d=t=>{var r;if(t.disabled)return!1;const e=(r=t.parentElement)==null?void 0:r.closest("fieldset");return e?d(e):!0},b=t=>t.isContentEditable||!!t.hasAttribute("tabindex"),P={INPUT:t=>t.type!=="hidden"&&d(t),SELECT:d,TEXTAREA:d,BUTTON:d,A:t=>!!t.href||b(t)},_=t=>!L(t)&&(P[t.tagName]??b)(t),R=(t,e)=>{if(t===e)return 0;const r=t.compareDocumentPosition(e);if(r&Node.DOCUMENT_POSITION_FOLLOWING)return-1;if(r&Node.DOCUMENT_POSITION_PRECEDING)return 1;throw new Error("failed to compare elements")},y=t=>getComputedStyle(t).direction,M=new Set(["text","search","url","tel","password"]),A=t=>t instanceof HTMLInputElement&&M.has(t.type),$=t=>{let e=t.key;return t.shiftKey&&(e=`Shift+${e}`),t.altKey&&(e=`Alt+${e}`),t.ctrlKey&&(e=`Ctrl+${e}`),t.metaKey&&(e=`Meta+${e}`),e},F=t=>{const{target:e,key:r}=t;if(A(e)&&(r==="ArrowLeft"||r==="ArrowRight"||r==="Home"||r==="End")){let c;if(r==="ArrowLeft"||r==="ArrowRight"){const i=y(e);c=r===(i==="ltr"?"ArrowLeft":"ArrowRight")}else c=r==="Home";const a=e.selectionStart===e.selectionEnd?e.selectionStart:null;if(c&&a!==0||!c&&a!==e.value.length)return!0}return!1},x=t=>[t],j=()=>{const t=D(),e=S({}),r=()=>e.set({}),c=m(()=>{e();const s=[];for(const o of t())s.push(...o());return s}),a=m(()=>k(c()),{equal:Object.is}),i=m(()=>[...c()].sort(R)),h=()=>{const s=a();return s?y(s):"ltr"},p=(s,o)=>(s&&(o==null||o.preventDefault()),s),N=(s,o=0)=>{const u=i();for(;s>=0&&s<u.length;){const n=u[s];if(_(n)){if(n.focus(),o!=0&&A(n)){const l=h()!==y(n),f=o>0!==l?0:n.value.length;n.setSelectionRange(f,f,f===0?"forward":"backward")}return n}if(o===0)break;s+=o}return null},T=s=>({event:o,referenceElement:u=(o==null?void 0:o.target)??document.activeElement}={})=>{const n=u?i().indexOf(u):-1;return n>-1?p(N(n+s,s),o):null},C=(s,o)=>{const u=l=>{var w;if(F(l))return;const f=$(l),E=(w=o.keys)==null?void 0:w[f];E&&(r(),E({event:l,directiveElement:s,navManager:g}))};s.addEventListener("keydown",u);const n=t.register(()=>((o==null?void 0:o.selector)??x)(s));return{update(l){o=l},destroy(){s.removeEventListener("keydown",u),n()}}},I=T(-1),O=T(1),g={elementsInDomOrder$:i,directive:C,focusIndex:N,focusPrevious:I,focusNext:O,focusFirst:({event:s}={})=>p(N(0,1),s),focusLast:({event:s}={})=>p(N(i().length-1,-1),s),focusLeft:(...s)=>(h()==="rtl"?O:I)(...s),focusRight:(...s)=>(h()==="rtl"?I:O)(...s),refreshElements:r};return g};export{j as c};
