import{r as pe,j as n}from"./App-CbxyQil0.js";import{S as G}from"./slot-B-n0hzfG.js";import{a as y,u as A}from"./directive-CEErjM5c-w-h4c8PC.js";import{c as me}from"./clsx-B-dksMZM.js";import{u as ge}from"./config-CrvFEMU-.js";import{w as fe,g as o,p as he,G as ve,D as be,f as xe,h as q,s as De,m as $e,K as we,n as N,a as f,z as Ce,c as L}from"./directive-DrDJkTS5-BSYQXut0.js";import{c as Fe,o as Ie,a as je,b as Se}from"./floatingUI-BEz_ZppW.js";import{c as ke}from"./focustrack-DT67vecf.js";import{c as Ne}from"./navManager-BZKRLFTo.js";import{e as ye}from"./extendWidget-DxTj0ayL.js";const Le={id:void 0,ariaLabel:"Select",open:!1,disabled:!1,items:[],filterText:"",loading:!1,selected:[],navSelector:s=>s.querySelectorAll(".au-select-badge,input"),itemIdFn:s=>""+s,onOpenChange:N,onFilterTextChange:N,onSelectedChange:N,allowedPlacements:["bottom-start","top-start","bottom-end","top-end"],className:"",menuClassName:"",menuItemClassName:"",badgeClassName:""};function Ae(s){const[{id$:a,open$:l,filterText$:h,items$:m,itemIdFn$:v,onOpenChange$:$,onFilterTextChange$:w,onSelectedChange$:C,allowedPlacements$:F,navSelector$:I,className$:j,badgeClassName$:P,ariaLabel$:M,menuClassName$:T,...E},J]=fe(Le,s),{selected$:S}=E,b=o(()=>a()??he()),B=ve(h,w),{hasFocus$:K,directive:Q}=ke(),u=be($,[l,K],([e,t])=>e&&t),k=o(()=>{const e=new Map,t=v();for(const i of S()){const c=t(i);e.set(c,{item:i,id:t(i),selected:!0})}return e}),V=o(()=>[...k().values()]),g=function(){const e=xe(0);return q(e,t=>{const{length:i}=x();t!=null&&(i?t<0?t=i-1:t>=i&&(t=0):t=void 0),e.set(t)})}(),O=o(()=>{const e=new Map;if(u()){const t=k(),i=v();for(const c of m()){const d=i(c);e.set(d,{item:c,id:d,selected:t.has(d)})}}return e}),x=o(()=>u()?[...O().values()]:[]),R=o(()=>{const e=x(),t=g();return e.length&&t!=null?e[t]:void 0}),{directives:{floatingDirective:X,referenceDirective:Y},stores:{placement$:_}}=Fe({props:{computePositionOptions:q(o(()=>({middleware:[Ie(5),je({allowedPlacements:F()}),Se()]})))}}),{directive:Z,refreshElements:ee,focusFirst:te,focusLast:se,focusLeft:H,focusRight:W}=Ne(),ie=o(()=>({keys:{Home:te,End:se,ArrowLeft:H,ArrowRight:W},selector:I()})),z=(e,t)=>{const i=e.target;ee(),r.api.unselect(t),i instanceof HTMLElement&&setTimeout(()=>{H({event:e,referenceElement:i})||W({event:e,referenceElement:i})}),e.preventDefault()},ae=f(()=>({attributes:{role:"combobox","aria-haspopup":"listbox","aria-expanded":o(()=>`${u()}`),"aria-controls":o(()=>`${b()}-menu`)}})),ne=f(e=>({attributes:{tabindex:-1,class:P},classNames:{"au-select-badge":!0},events:{keydown:t=>{let i=!1;switch(t.key){case"Backspace":case"Delete":{z(t,e().item),i=!0;break}}i&&t.preventDefault()}}})),re=f(()=>({attributes:{role:"listbox",id:o(()=>`${b()}-menu`),"data-popper-placement":_,class:T},events:{mousedown:e=>e.preventDefault()}})),oe=f(e=>({attributes:{role:"option","aria-selected":o(()=>`${e().selected}`),style:"cursor: pointer"},classNames:{"au-select-item":!0,selected:o(()=>e().selected)},events:{click:()=>r.api.toggleItem(e().item)}})),ce=f(()=>({attributes:{id:b(),type:"text","aria-label":M(),"aria-autocomplete":"list",autocorrect:"off",autocapitalize:"none",autocomplete:"off"},classNames:{"au-select-input":!0},events:{input:e=>{const t=e.target.value;Ce(()=>{u.set(t!=null&&t!==""),B.set(t)})},keydown:({ctrlKey:e,key:t,preventDefault:i})=>{let c=!0;switch(t){case"ArrowDown":{u()?e?r.api.highlightLast():r.api.highlightNext():(r.api.open(),r.api.highlightFirst());break}case"ArrowUp":e?r.api.highlightFirst():r.api.highlightPrevious();break;case"Enter":{const d=R();d&&r.api.toggleItem(d.item);break}case"Escape":u.set(!1);break;default:c=!1}c&&i()}}})),le=f(e=>({events:{click:t=>{z(t,e().item)}}})),r={...De({id$:b,visibleItems$:x,highlighted$:R,open$:u,selectedContexts$:V,filterText$:B,placement$:_,className$:j,badgeClassName$:P,ariaLabel$:M,menuClassName$:T,...E}),patch:J,api:{clear(){S.set([])},select(e){r.api.toggleItem(e,!0)},unselect(e){r.api.toggleItem(e,!1)},toggleItem(e,t){const i=v(),c=i(e),D=k().has(c);t==null&&(t=!D),!(t&&!O().has(c)||!t&&!D)&&S.update(p=>{var U;if(p=[...p],t&&!D)p.push(e);else if(!t&&D){const ue=p.findIndex(de=>i(de)===c);p.splice(ue,1)}return(U=C())==null||U(p),p})},clearText(){},highlight(e){const t=x().findIndex(i=>i.item===e);g.set(t===-1?void 0:t)},highlightFirst(){g.set(0)},highlightPrevious(){g.update(e=>e!=null?e-1:-1)},highlightNext(){g.update(e=>e!=null?e+1:1/0)},highlightLast(){g.set(-1)},open:()=>r.api.toggle(!0),close:()=>r.api.toggle(!1),toggle(e){u.update(t=>e??!t)}},directives:{hasFocusDirective:Q,floatingDirective:X,referenceDirective:Y,inputContainerDirective:$e(we(Z,ie),ae),badgeAttributesDirective:ne,menuAttributesDirective:re,itemAttributesDirective:oe,inputDirective:ce,badgeCloseButtonDirective:le}};return r}const Pe={badgeLabel:({itemContext:s})=>s.item,itemLabel:({itemContext:s})=>s.item},Me=ye(Ae,Pe),Te=Me;function Ee(s){return n.jsx(n.Fragment,{children:""+s.itemContext.item})}function Be(s){return n.jsx(n.Fragment,{children:""+s.itemContext.item})}function Oe({itemContext:s,slotContext:a}){return n.jsx("div",{...A(a.directives.badgeAttributesDirective,s),children:n.jsx(G,{slotContent:a.state.badgeLabel,props:{...a,itemContext:s}})})}function Re({slotContext:s}){const a=[];for(const l of s.state.selectedContexts)a.push(n.jsx(Oe,{itemContext:l,slotContext:s},l.id));return a.length?n.jsx(n.Fragment,{children:a}):null}function _e({itemContext:s,slotContext:a}){const l=me("dropdown-item","position-relative",{"text-bg-primary":s===a.state.highlighted});return n.jsx("li",{className:l,...A(a.directives.itemAttributesDirective,s),children:n.jsx(G,{slotContent:a.state.itemLabel,props:{...a,itemContext:s}})})}function He({slotContext:s}){const{directives:{hasFocusDirective:a,floatingDirective:l,menuAttributesDirective:h}}=s;return n.jsx("ul",{...y([L,"dropdown-menu show"],a,l,h),children:s.state.visibleItems.map(m=>n.jsx(_e,{slotContext:s,itemContext:m},m.id))})}function Ye(s){const a=ge(Te,s,"select",{badgeLabel:Ee,itemLabel:Be});pe.useImperativeHandle(s.ref,()=>a.api,[a.api]);const{state:{id:l,visibleItems:h,filterText:m,open:v,className:$},directives:{hasFocusDirective:w,referenceDirective:C,inputContainerDirective:F,inputDirective:I}}=a,j=`${l}-menu`;return n.jsxs("div",{...y([L,`au-select dropdown border border-1 p-1 mb-3 d-block ${$}`],C),children:[n.jsxs("div",{...y([L,"d-flex align-items-center flex-wrap gap-1"],w,F),children:[n.jsx(Re,{slotContext:a}),n.jsx("input",{type:"text",value:m,...A(I),onChange:()=>{}})]}),v&&h.length>0&&n.jsx(He,{slotContext:a,menuId:j})]})}export{Ye as S};
